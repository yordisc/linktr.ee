import{r as R,j as m}from"./index-8fFcgtCJ.js";const c={CANVAS_WIDTH:360,CANVAS_HEIGHT:640,LANE_COUNT:3,PLAYER_WIDTH:50,PLAYER_HEIGHT:80,PLAYER_HITBOX_PADDING:20,GRAVITY:.6,JUMP_FORCE:12,LANE_SWITCH_SPEED:.25,INITIAL_SPEED:8,DASH_MULTIPLIER:2.5,DASH_DURATION:60,DASH_COOLDOWN:180,SLIDE_DURATION:60,SLIDE_COOLDOWN:60,DIET_PEPSI_DURATION:240,STUN_DURATION:180,SPAWN_RATE_INITIAL:90,SPAWN_RATE_MIN:25,INITIAL_LIVES:3,CANS_FOR_LIFE:100},X=c.CANVAS_WIDTH/c.LANE_COUNT,V=X,W=[X*.5,X*1.5,X*2.5];let J=null;const pe=()=>{if(!J){const e=window.AudioContext||window.webkitAudioContext;if(!e)throw new Error("Web Audio API no soportada");J=new e}return J},ce=e=>{const a=pe();a.state==="suspended"&&a.resume();const l=a.createOscillator(),o=a.createGain(),i=a.currentTime;switch(l.connect(o),o.connect(a.destination),e){case"JUMP":l.type="sine",l.frequency.setValueAtTime(150,i),l.frequency.linearRampToValueAtTime(300,i+.1),l.frequency.exponentialRampToValueAtTime(50,i+.3),o.gain.setValueAtTime(.3,i),o.gain.exponentialRampToValueAtTime(.01,i+.3),l.start(i),l.stop(i+.3);break;case"SLIDE":l.type="triangle",l.frequency.setValueAtTime(200,i),l.frequency.exponentialRampToValueAtTime(50,i+.4),o.gain.setValueAtTime(.2,i),o.gain.linearRampToValueAtTime(0,i+.4),l.start(i),l.stop(i+.4);break;case"COLLECT":l.type="sine",l.frequency.setValueAtTime(1200,i),l.frequency.setValueAtTime(1800,i+.08),o.gain.setValueAtTime(.1,i),o.gain.exponentialRampToValueAtTime(.01,i+.3),l.start(i),l.stop(i+.3);break;case"POWERUP":l.type="square",l.frequency.setValueAtTime(220,i),l.frequency.setValueAtTime(440,i+.1),l.frequency.setValueAtTime(880,i+.2),o.gain.setValueAtTime(.1,i),o.gain.linearRampToValueAtTime(0,i+.4),l.start(i),l.stop(i+.4);break;case"BREAK":l.type="sawtooth",l.frequency.setValueAtTime(100,i),l.frequency.exponentialRampToValueAtTime(10,i+.1),o.gain.setValueAtTime(.3,i),o.gain.exponentialRampToValueAtTime(.01,i+.1),l.start(i),l.stop(i+.1);break;case"CRASH_SPLAT":l.type="sawtooth",l.frequency.setValueAtTime(50,i),l.frequency.linearRampToValueAtTime(20,i+.1),o.gain.setValueAtTime(.5,i),o.gain.exponentialRampToValueAtTime(.01,i+.4),l.start(i),l.stop(i+.4);break;case"CRASH_FALL":l.type="sine",l.frequency.setValueAtTime(800,i),l.frequency.exponentialRampToValueAtTime(50,i+1.5),o.gain.setValueAtTime(.2,i),o.gain.linearRampToValueAtTime(0,i+1.5),l.start(i),l.stop(i+1.5);break;case"CRASH_SPIN":l.type="triangle",l.frequency.setValueAtTime(300,i),l.frequency.linearRampToValueAtTime(600,i+.2),l.frequency.linearRampToValueAtTime(100,i+.8),o.gain.setValueAtTime(.3,i),o.gain.exponentialRampToValueAtTime(.01,i+.8),l.start(i),l.stop(i+.8);break}},he=()=>({play:R.useCallback(a=>{try{ce(a)}catch(l){console.warn("Audio error:",l)}},[])}),ge=()=>{const{play:e}=he(),a=W?.[1],l=R.useRef({lane:1,x:a,y:0,state:"RUNNING",isJumping:!1,jumpVelocity:0,isSliding:!1,slideTimer:0,isDashing:!1,dashTimer:0,isHit:!1,hitTimer:0,isConfused:!1,confusionTimer:0,frame:0,cooldowns:{slide:0,dash:0}}),o=R.useCallback(()=>{const s=l.current;if(s.state==="CRASHED")return;const t=s.isConfused?1:-1,d=s.lane+t;d>=0&&d<=2&&(s.lane=d)},[]),i=R.useCallback(()=>{const s=l.current;if(s.state==="CRASHED")return;const t=s.isConfused?-1:1,d=s.lane+t;d>=0&&d<=2&&(s.lane=d)},[]),n=R.useCallback(()=>{const s=l.current;s.state!=="CRASHED"&&!s.isJumping&&!s.isSliding&&(s.isJumping=!0,s.jumpVelocity=c.JUMP_FORCE,s.state="RUNNING",e("JUMP"))},[e]),r=R.useCallback(()=>{const s=l.current;s.state!=="CRASHED"&&!s.isJumping&&!s.isSliding&&s.cooldowns.slide<=0&&(s.isSliding=!0,s.slideTimer=c.SLIDE_DURATION,s.cooldowns.slide=c.SLIDE_COOLDOWN+s.slideTimer,s.state="RUNNING",e("SLIDE"))},[e]),u=R.useCallback(()=>{const s=l.current;s.state!=="CRASHED"&&!s.isDashing&&s.cooldowns.dash<=0&&(s.isDashing=!0,s.dashTimer=c.DASH_DURATION,s.cooldowns.dash=c.DASH_COOLDOWN+s.dashTimer,s.isJumping=!1,s.y=0,s.isSliding=!1,s.state="RUNNING",e("POWERUP"))},[e]),f=R.useCallback(()=>{const s=l.current;s.frame++;const t=W?.[s.lane]??120*s.lane+60,d=c.LANE_SWITCH_SPEED;s.x+=(t-s.x)*d,s.isJumping&&(s.y+=s.jumpVelocity,s.jumpVelocity-=c.GRAVITY,s.y<=0&&(s.y=0,s.isJumping=!1,s.jumpVelocity=0,!s.isSliding&&!s.isDashing&&s.state!=="CRASHED"&&(s.state="RUNNING"))),s.isSliding&&(s.slideTimer--,s.slideTimer<=0&&(s.isSliding=!1,s.state!=="CRASHED"&&(s.state="RUNNING"))),s.isDashing&&(s.dashTimer--,s.dashTimer<=0&&(s.isDashing=!1,s.state!=="CRASHED"&&(s.state="RUNNING"))),s.isHit&&(s.hitTimer--,s.hitTimer<=0&&(s.isHit=!1,s.state==="CRASHED"&&(s.state="RUNNING"))),s.isConfused&&(s.confusionTimer--,s.confusionTimer<=0&&(s.isConfused=!1)),s.cooldowns.slide>0&&s.cooldowns.slide--,s.cooldowns.dash>0&&s.cooldowns.dash--},[]);return{playerRef:l,updatePlayer:f,actions:{moveLeft:o,moveRight:i,jump:n,slide:r,dash:u}}},Ce=()=>{const e=R.useRef([]),a=R.useRef(0),l=R.useRef(0),o=R.useCallback(()=>{e.current=[],a.current=0,l.current=0},[]),i=()=>{const r=Math.floor(Math.random()*3),u=`ent-${l.current++}`,f=Math.random()>.35;let s,t,d=50,S=50,T=W[r],p=0,h=!1;if(f){s="OBSTACLE";const b=Math.random();if(b<.2)t="CONE";else if(b<.4)t="BARRIER",d=70;else if(b<.55){t="TREE",d=V*1.8,S=80;const C=r===2?-V/2:V/2;T+=C}else if(b<.7)t="TRUCK_H",d=V*2.5,S=90,T=W[1];else if(b<.85){t="CAR",p=8,h=!0,S=90,d=45;const C=Math.random()>.5?0:2;T=W[C]}else t="HOLE",d=60}else s="COLLECTIBLE",t=Math.random()>.9?"CAN_DIET":"CAN_NORMAL",d=35,S=55;const g={id:u,type:s,variant:t,lane:r,x:T,y:-200,width:d,height:S,speedY:p,warning:h,warningTimer:h?60:0};e.current.push(g)},n=R.useCallback((r,u)=>{a.current++;const f=Math.max(c.SPAWN_RATE_MIN,c.SPAWN_RATE_INITIAL-u*5);a.current>=f&&(i(),a.current=0),e.current=e.current.filter(s=>s.warning&&s.warningTimer&&s.warningTimer>0?(s.warningTimer--,!0):(s.y+=r+(s.speedY||0),s.y<c.CANVAS_HEIGHT+100))},[]);return{entitiesRef:e,updateEntities:n,resetSpawner:o}},Ae=()=>{const[e,a]=R.useState(0),[l,o]=R.useState(0),[i,n]=R.useState(c.INITIAL_LIVES),[r,u]=R.useState(0),[f,s]=R.useState(1),t=R.useRef(0),d=R.useRef(0),S=R.useRef(0),T=R.useRef(c.INITIAL_LIVES);R.useEffect(()=>{const C=localStorage.getItem("pepsiman_highscore");C&&o(parseInt(C,10))},[]);const p=R.useCallback(()=>{a(0),n(c.INITIAL_LIVES),u(0),s(1),t.current=0,d.current=0,S.current=0,T.current=c.INITIAL_LIVES},[]),h=R.useCallback(C=>{S.current+=C*.1;const A=Math.floor(S.current/1e3)+1;if(A!==f&&s(A),C>0){const L=1+A*.1,y=C*.1*L;t.current+=y}const I=Math.floor(t.current+d.current);I>e&&a(I)},[f,e]),g=R.useCallback(C=>{const A=C==="CAN_DIET"?500:100;d.current+=A;const I=Math.floor(t.current+d.current);a(I),u(L=>{const y=L+1;return y>=c.CANS_FOR_LIFE?(T.current+=1,n(T.current),0):y})},[]),b=R.useCallback((C=1)=>{T.current-=C;const A=Math.max(0,T.current);if(n(A),A<=0){const I=Math.floor(t.current+d.current);return I>l&&(o(I),localStorage.setItem("pepsiman_highscore",I.toString())),!0}return!1},[l]);return{score:e,highScore:l,lives:i,cans:r,level:f,breakdown:{running:Math.floor(t.current),bonus:d.current},resetScore:p,updateDistance:h,collectCan:g,takeDamage:b}},Pe=()=>({checkCollision:R.useCallback((a,l)=>{const o=c.CANVAS_HEIGHT-c.PLAYER_HEIGHT-20,i=a.x-c.PLAYER_WIDTH/2+c.PLAYER_HITBOX_PADDING,n=a.x+c.PLAYER_WIDTH/2-c.PLAYER_HITBOX_PADDING,r=o+c.PLAYER_HITBOX_PADDING,u=o+c.PLAYER_HEIGHT-c.PLAYER_HITBOX_PADDING,f=l.x-l.width/2,s=l.x+l.width/2,t=l.y,d=l.y+l.height,S=i<s&&n>f,T=r<d&&u>t;return!S||!T||["HOLE","CAR","CAR_DOWN","MOTO","BOX","WORKER","BARREL","CONE","BARRIER"].includes(l.variant)&&a.isJumping&&a.y>5||l.variant==="TRUCK_H"&&a.isSliding||l.variant==="FLYING"&&!a.isJumping?!1:(["BOX","BARREL","CONE","FLYING"].includes(l.variant)&&(a.isDashing||a.isSliding&&(l.variant==="BARREL"||l.variant==="BOX")),!0)},[])}),Ee=e=>{const{checkCollision:a}=Pe(),{playerRef:l,entitiesRef:o,dietTimerRef:i,stunTimerRef:n,speedRef:r,setStatus:u,play:f,collectCan:s,takeDamage:t}=e;return{resolveCollisions:R.useCallback(()=>{const S=l.current;for(let T=o.current.length-1;T>=0;T--){const p=o.current[T];if(a(S,p)){if(p.type==="COLLECTIBLE"){const h=p.variant;s(h),h==="CAN_DIET"?(f("POWERUP"),i.current=c.DIET_PEPSI_DURATION):f("COLLECT"),o.current.splice(T,1)}else if(!S.isHit){const h=["BOX","BARREL","CONE"].includes(p.variant);if((S.isDashing||S.isSliding&&["BOX","BARREL","CONE"].includes(p.variant))&&h)f("BREAK"),o.current.splice(T,1);else{p.variant==="HOLE"?(f("CRASH_FALL"),S.crashType="FALL"):["CAR","MOTO","CAR_DOWN"].includes(p.variant)?(f("CRASH_SPIN"),S.crashType="SPIN"):p.variant==="FLYING"?(f("CRASH_SPLAT"),S.crashType="FACEPLANT"):h?(f("CRASH_SPIN"),S.crashType="TRIP"):(f("CRASH_SPLAT"),S.crashType="SPLAT"),S.isHit=!0,S.hitTimer=300,S.state="CRASHED",n.current=c.STUN_DURATION,p.variant==="BARREL"&&(S.isConfused=!0,S.confusionTimer=600);let b=1;if(["TRUCK_V","TRUCK_H","TRUCK_DOWN"].includes(p.variant)&&(b=2),p.variant==="HOLE"&&(b=999),t(b))return u("GAME_OVER"),!0;o.current.splice(T,1),r.current=Math.max(c.INITIAL_SPEED,r.current-2)}}}}return!1},[a,s,t,o,l,f,u,i,n,r])}},oe=1e3/60,Ie=()=>{const{playerRef:e,updatePlayer:a,actions:l}=ge(),{moveLeft:o,moveRight:i,jump:n,slide:r,dash:u}=l,{entitiesRef:f,updateEntities:s,resetSpawner:t}=Ce(),{play:d}=he(),{score:S,highScore:T,lives:p,cans:h,level:g,breakdown:b,resetScore:C,updateDistance:A,collectCan:I,takeDamage:L}=Ae(),[y,k]=R.useState("MENU"),v=R.useRef(0),N=R.useRef(0),O=R.useRef(c.INITIAL_SPEED),M=R.useRef(0),G=R.useRef(0),be=R.useMemo(()=>({moveLeft:o,moveRight:i,jump:n,slide:r,dash:u}),[o,i,n,r,u]),{resolveCollisions:ee}=Ee({playerRef:e,entitiesRef:f,dietTimerRef:M,stunTimerRef:G,speedRef:O,setStatus:k,play:d,collectCan:I,takeDamage:L}),Y=R.useCallback(P=>{if(y!=="PLAYING")return;N.current||(N.current=P);const ae=P-N.current;if(ae>oe){N.current=P-ae%oe;let _=O.current+g*.5;if(G.current>0?(_=0,G.current--,G.current<=0&&e.current.state==="CRASHED"&&(e.current.state="RUNNING",e.current.isHit=!1)):(e.current.isDashing&&(_*=c.DASH_MULTIPLIER),M.current>0&&(_+=5,M.current--)),a(),_>0&&(s(_,g),A(_)),ee())return}v.current=requestAnimationFrame(Y)},[y,g,a,s,A,ee,e]),le=R.useRef(Y);R.useEffect(()=>{le.current=Y},[Y]);const w=R.useCallback(P=>{le.current(P)},[]);R.useEffect(()=>(y==="PLAYING"&&(v.current=requestAnimationFrame(w)),()=>cancelAnimationFrame(v.current)),[y,w]);const Te=R.useCallback(()=>{C(),t(),O.current=c.INITIAL_SPEED,M.current=0,G.current=0;const P=e.current;P.lane=1,P.x=180,P.y=0,P.state="RUNNING",P.isHit=!1,P.isJumping=!1,P.isSliding=!1,P.isDashing=!1,P.isConfused=!1,P.slideTimer=0,P.dashTimer=0,P.hitTimer=0,k("PLAYING"),N.current=0,v.current&&cancelAnimationFrame(v.current),v.current=requestAnimationFrame(w)},[C,t,e,w]),Re=R.useCallback(()=>{y==="PLAYING"?(k("PAUSED"),cancelAnimationFrame(v.current)):y==="PAUSED"&&(k("PLAYING"),N.current=0,v.current=requestAnimationFrame(w))},[y,w]);return R.useEffect(()=>()=>{v.current&&cancelAnimationFrame(v.current)},[]),{status:y,startGame:Te,pauseGame:Re,player:e.current,entitiesRef:f,stats:{score:S,highScore:T,lives:p,cans:h,level:g,breakdown:b},actions:be}},ye=(e,a)=>{const l=R.useRef(0),o=R.useRef(!1),i=R.useRef(null);R.useEffect(()=>{const n=u=>{if(e==="PLAYING")switch(u.key){case"ArrowLeft":case"a":a.moveLeft();break;case"ArrowRight":case"d":a.moveRight();break;case"ArrowUp":case"w":a.dash();break;case"ArrowDown":case"s":a.slide();break;case" ":case"Shift":!u.repeat&&l.current===0&&(u.preventDefault(),l.current=Date.now(),o.current=!1,i.current=setTimeout(()=>{l.current!==0&&(o.current=!0,a.slide())},250));break}},r=u=>{if(u.key===" "||u.key==="Shift"){i.current&&(clearTimeout(i.current),i.current=null);const f=Date.now()-l.current;l.current=0,f<250&&!o.current&&a.jump(),o.current=!1}};return window.addEventListener("keydown",n),window.addEventListener("keyup",r),()=>{window.removeEventListener("keydown",n),window.removeEventListener("keyup",r),i.current&&clearTimeout(i.current)}},[e,a])},E={},B={PEPSI_BLUE:"#004B93",PEPSI_RED:"#C9002B",SILVER:"#E0E0E0",ASPHALT:"#2D2D2D"},Q=(e,a)=>{const l=document.createElement("canvas");return l.width=e,l.height=a,{canvas:l,ctx:l.getContext("2d")}},ie=e=>{const{canvas:o,ctx:i}=Q(30,50),n=e==="diet"?B.SILVER:B.PEPSI_BLUE,r=i.createLinearGradient(0,0,30,0);r.addColorStop(0,"rgba(0,0,0,0.3)"),r.addColorStop(.2,n),r.addColorStop(.5,e==="diet"?"#FFFFFF":"#0072CE"),r.addColorStop(.8,n),r.addColorStop(1,"rgba(0,0,0,0.3)"),i.fillStyle=r,i.fillRect(0,0,30,50),i.fillStyle="#999",i.fillRect(0,0,30,3),i.fillRect(0,47,30,3);const u=30/2,f=50/2,s=8;return i.beginPath(),i.arc(u,f,s,0,Math.PI*2),i.fillStyle="#FFF",i.fill(),i.beginPath(),i.arc(u,f,s-2,0,Math.PI*2),i.fillStyle=B.PEPSI_RED,i.fill(),i.beginPath(),i.arc(u,f,s-2,0,Math.PI,!1),i.fillStyle=B.PEPSI_BLUE,i.fill(),o},ve=()=>{const{canvas:a,ctx:l}=Q(200,200);l.fillStyle=B.ASPHALT,l.fillRect(0,0,200,200);for(let o=0;o<400;o++){const i=Math.random()*200,n=Math.random()*200,r=Math.random()*2;l.fillStyle=Math.random()>.5?"#383838":"#222",l.fillRect(i,n,r,r)}return a},Fe=()=>{const{canvas:a,ctx:l}=Q(50,50);return l.fillStyle="#FBC02D",l.fillRect(0,0,50,50),l.fillStyle="#000",l.beginPath(),l.moveTo(0,50),l.lineTo(50,0),l.lineTo(50,10),l.lineTo(10,50),l.fill(),l.beginPath(),l.moveTo(0,10),l.lineTo(10,0),l.lineTo(0,0),l.fill(),a},Ne=()=>{E.CAN_NORMAL||(console.log("ðŸŽ¨ Generando texturas en memoria..."),E.CAN_NORMAL=ie("normal"),E.CAN_DIET=ie("diet"),E.ASPHALT=ve(),E.STRIPES=Fe())},se=(e,a,l,o,i,n)=>{e.fillStyle=n,e.fillRect(a,l,o,i),e.beginPath(),e.moveTo(a-5,l),e.lineTo(a+o/2,l-20),e.lineTo(a+o+5,l),e.fillStyle="#5D4037",e.fill(),e.fillStyle="#81D4FA",e.fillRect(a+10,l+10,15,15),e.fillStyle="#3E2723",e.fillRect(a+o-20,l+20,15,i-20)},Le=(e,a,l,o)=>{const i=Date.now(),n=i*o*.1,r=e.createLinearGradient(0,0,0,l);r.addColorStop(0,"#42A5F5"),r.addColorStop(1,"#90CAF9"),e.fillStyle=r,e.fillRect(0,0,a,l);const u=20,f=a-u*2;e.fillStyle="#4CAF50",e.fillRect(0,0,a,l);const s=300,t=i*o*.08%s;for(let b=-s;b<l+s;b+=s)se(e,5,b+t,40,40,"#E0E0E0"),se(e,a-45,b+t+150,40,40,"#FFE082");if(E.ASPHALT){const b=e.createPattern(E.ASPHALT,"repeat");if(b){const C=new DOMMatrix;C.translateSelf(0,n%256),b.setTransform(C),e.fillStyle=b,e.fillRect(u,0,f,l)}}else e.fillStyle="#333",e.fillRect(u,0,f,l);const d=50,S=10,T=n%(d*2);for(let b=-d*2;b<l+d;b+=d){const C=Math.floor((b+T)/d)%2===0;e.fillStyle=C?"#D32F2F":"#EEEEEE",e.fillRect(u,b+T,S,d),e.fillRect(a-u-S,b+T,S,d)}e.lineWidth=4,e.strokeStyle="#FFFFFF",e.setLineDash([40,40]),e.lineDashOffset=-n;const p=f/3;e.beginPath(),e.moveTo(u+p,0),e.lineTo(u+p,l),e.stroke(),e.beginPath(),e.moveTo(u+p*2,0),e.lineTo(u+p*2,l),e.stroke(),e.setLineDash([]);const h=e.createLinearGradient(u,0,u+15,0);h.addColorStop(0,"rgba(0,0,0,0.3)"),h.addColorStop(1,"rgba(0,0,0,0)"),e.fillStyle=h,e.fillRect(u,0,15,l);const g=e.createLinearGradient(a-u-15,0,a-u,0);g.addColorStop(0,"rgba(0,0,0,0)"),g.addColorStop(1,"rgba(0,0,0,0.3)"),e.fillStyle=g,e.fillRect(a-u-15,0,15,l)},ne=(e,a,l,o,i)=>{e.fillStyle="#1a1a1a",e.fillRect(a,l,o,i);for(let n=l+10;n<l+i;n+=30)for(let r=a+5;r<a+o-5;r+=20)Math.random()>.7?(e.fillStyle="#FF5722",e.fillRect(r,n,10,20)):(e.fillStyle="#000",e.fillRect(r,n,10,20))},ke=(e,a,l,o)=>{const i=Date.now(),n=i*o*.1,r=e.createLinearGradient(0,0,0,l);r.addColorStop(0,"#B71C1C"),r.addColorStop(.5,"#E65100"),r.addColorStop(1,"#3E2723"),e.fillStyle=r,e.fillRect(0,0,a,l);const u=15,f=a-u*2;e.fillStyle="#3E2723",e.fillRect(0,0,a,l);const s=400,t=i*o*.05%s;for(let h=-s;h<l+s;h+=s)ne(e,-20,h+t,40,120),ne(e,a-30,h+t+200,50,150);if(E.ASPHALT){const h=e.createPattern(E.ASPHALT,"repeat");if(h){const g=new DOMMatrix;g.translateSelf(0,n%256),h.setTransform(g),e.fillStyle=h,e.fillRect(u,0,f,l)}}e.fillStyle="rgba(183, 28, 28, 0.2)",e.fillRect(u,0,f,l);const d=60,S=n%(d*2);for(let h=-d*2;h<l+d;h+=d){const g=Math.floor((h+S)/d)%2===0;e.fillStyle=g?"#3E2723":"#5D4037",e.fillRect(0,h+S,15,d),e.fillRect(a-15,h+S,15,d)}e.lineWidth=3,e.strokeStyle="#FFC107",e.setLineDash([30,80]),e.lineDashOffset=-n;const T=f/3;[T+u,T*2+u].forEach(h=>{e.beginPath(),e.moveTo(h,0),e.lineTo(h,l),e.stroke()}),e.setLineDash([]),e.fillStyle="rgba(0, 0, 0, 0.1)";const p=i*.1%l;for(let h=0;h<5;h++){const g=Math.sin(i*.001+h)*a/2+a/2,b=(p+h*150)%l;e.beginPath(),e.arc(g,l-b,20+h*5,0,Math.PI*2),e.fill()}},De=(e,a,l,o)=>{const i=Date.now(),n=i*o*.15;e.fillStyle="#1a1a1a",e.fillRect(0,0,a,l);const r=10,u=a-r*2,f=e.createLinearGradient(0,0,a,0);f.addColorStop(0,"#000000"),f.addColorStop(.2,"#263238"),f.addColorStop(.5,"#37474F"),f.addColorStop(.8,"#263238"),f.addColorStop(1,"#000000"),e.fillStyle=f,e.fillRect(0,0,a,l);const s=40,t=n%(s*2),d=20;for(let A=-s*2;A<l+s;A+=s){const I=Math.floor((A+t)/s)%2===0;e.fillStyle=I?"#FFEB3B":"#000000",e.fillRect(r,A+t,d,s),e.fillRect(a-r-d,A+t,d,s)}const S=15,T=100,p=n%T;e.fillStyle="#424242",e.fillRect(0,0,S,l),e.fillRect(a-S,0,S,l),e.fillStyle="#212121";for(let A=-T;A<l+T;A+=T)e.fillRect(0,A+p,S+5,20),e.fillRect(a-S-5,A+p,S+5,20);e.lineWidth=3,e.strokeStyle="rgba(0, 255, 255, 0.3)",e.setLineDash([80,80]),e.lineDashOffset=-n;const h=u/3,g=r+d;e.beginPath(),e.moveTo(g+h,0),e.lineTo(g+h,l),e.stroke(),e.beginPath(),e.moveTo(g+h*2,0),e.lineTo(g+h*2,l),e.stroke(),e.setLineDash([]);const b=400,C=i*o*.2%b;e.fillStyle="rgba(255, 255, 255, 0.05)";for(let A=-b;A<l+b;A+=b)e.fillRect(0,A+C,a,30)},re=(e,a,l,o)=>{e.fillStyle="#2E7D32",e.fillRect(a,l,10*o,40*o),e.fillRect(a-10*o,l+10*o,10*o,5*o),e.fillRect(a-10*o,l-5*o,5*o,20*o),e.fillRect(a+10*o,l+15*o,10*o,5*o),e.fillRect(a+15*o,l+5*o,5*o,15*o)},te=(e,a,l,o)=>{e.fillStyle="#8D6E63",e.beginPath(),e.arc(a,l,o,0,Math.PI*2),e.fill(),e.fillStyle="rgba(0,0,0,0.1)",e.beginPath(),e.arc(a+2,l+2,o*.8,0,Math.PI*2),e.fill()},Me=(e,a,l,o)=>{const i=Date.now(),n=i*o*.1,r=e.createLinearGradient(0,0,0,l);r.addColorStop(0,"#0288D1"),r.addColorStop(1,"#B3E5FC"),e.fillStyle=r,e.fillRect(0,0,a,l);const u=i*o*.02%a;e.fillStyle="#E65100",e.beginPath(),e.moveTo(0,l);for(let b=-1;b<2;b++){const C=b*a-u;e.lineTo(C+100,l-150),e.lineTo(C+200,l-80),e.lineTo(C+250,l-120),e.lineTo(C+350,l-120),e.lineTo(C+400,l)}e.lineTo(a,l),e.fill();const f=20,s=a-f*2;e.fillStyle="#FF9800",e.fillRect(0,0,a,l);const t=400,d=i*o*.08%t;for(let b=-t;b<l+t;b+=t)re(e,15,b+d,.8),te(e,40,b+d+200,8),re(e,a-25,b+d+150,1),te(e,a-45,b+d-50,12);if(E.ASPHALT){const b=e.createPattern(E.ASPHALT,"repeat");if(b){const C=new DOMMatrix;C.translateSelf(0,n%256),b.setTransform(C),e.fillStyle=b,e.fillRect(f,0,s,l)}}else e.fillStyle="#5D4037",e.fillRect(f,0,s,l);e.fillStyle="rgba(255, 152, 0, 0.15)",e.fillRect(f,0,s,l);const S=80,T=8,p=n%(S*2);for(let b=-S*2;b<l+S;b+=S){const C=Math.floor((b+p)/S)%2===0;e.fillStyle=C?"#E65100":"#FFE0B2",e.fillRect(f-T,b+p,T,S),e.fillRect(a-f,b+p,T,S)}e.lineWidth=3,e.strokeStyle="#FFF3E0",e.setLineDash([40,60]),e.lineDashOffset=-n;const h=s/3;[h+f,h*2+f].forEach(b=>{e.beginPath(),e.moveTo(b,0),e.lineTo(b,l),e.stroke()}),e.setLineDash([]),e.fillStyle="rgba(255, 255, 255, 0.05)";const g=i*.005%20;for(let b=0;b<l/4;b+=10){const C=Math.sin(b*.1+g)*5;e.fillRect(0+C,b,a,2)}},me=(e,a,l,o)=>{e.save(),e.beginPath(),e.arc(a,l,o,0,Math.PI*2),e.fillStyle="#FFF",e.fill(),e.beginPath(),e.arc(a,l,o-2,Math.PI,0),e.fillStyle="#C9002B",e.fill(),e.beginPath(),e.arc(a,l,o-2,0,Math.PI),e.fillStyle="#004B93",e.fill(),e.beginPath(),e.moveTo(a-o,l),e.quadraticCurveTo(a,l+o/2,a+o,l-o/3),e.lineTo(a+o,l+o/3),e.quadraticCurveTo(a,l+o,a-o,l+o/3),e.fillStyle="#FFF",e.fill(),e.restore()},fe=(e,a,l,o,i,n,r)=>{e.fillStyle="#0D47A1",e.fillRect(a,l,o,i),e.strokeStyle="#00FFFF",e.lineWidth=1,e.strokeRect(a,l,o,i),e.fillStyle="#42A5F5";for(let t=l+10;t<l+i;t+=20)for(let d=a+5;d<a+o;d+=15)Math.sin(d*t+r)>0&&e.fillRect(d,t,8,12);const u=r%4,f=60,s=l+20;if(e.fillStyle="#000",e.fillRect(a+5,s,o-10,f),u===0)Math.floor(n/500)%2===0&&(e.fillStyle="#FF0000",e.font="bold 20px Arial",e.textAlign="center",e.fillText("PEPSI",a+o/2,s+35));else if(u===1)me(e,a+o/2,s+30,20);else if(u===2){e.save(),e.beginPath(),e.rect(a+5,s,o-10,f),e.clip();const t=n*.1%200;e.fillStyle="#00FFFF",e.font="16px monospace",e.fillText("DRINK! DRINK! DRINK!",a+o-t,s+35),e.restore()}else e.fillStyle="#004B93",e.fillRect(a+10,s+10,o-20,f-20)},we=(e,a,l,o)=>{const i=Date.now(),n=i*o*.1,r=e.createLinearGradient(0,0,0,l);r.addColorStop(0,"#000000"),r.addColorStop(.5,"#0D47A1"),r.addColorStop(1,"#1976D2"),e.fillStyle=r,e.fillRect(0,0,a,l),me(e,a*.8,80,40),e.fillStyle="rgba(255, 255, 255, 0.1)",e.beginPath(),e.arc(a*.8,80,60,0,Math.PI*2),e.fill();const u=10,f=a-u*2;if(e.fillStyle="#37474F",e.fillRect(0,0,a,l),e.fillStyle="#102027",e.fillRect(u,0,f,l),E.ASPHALT){e.globalAlpha=.3;const h=e.createPattern(E.ASPHALT,"repeat");if(h){const g=new DOMMatrix;g.translateSelf(0,n%256),h.setTransform(g),e.fillStyle=h,e.fillRect(u,0,f,l)}e.globalAlpha=1}const s=300,t=i*o*.12%s;for(let h=-s;h<l+s;h+=s)fe(e,-40,h+t,80,250,i,Math.floor(h)),fe(e,a-40,h+t+150,80,280,i,Math.floor(h)+1);const d=40,S=10,T=n%(d*2);for(let h=-d*2;h<l+d;h+=d){const g=Math.floor((h+T)/d)%2===0;e.shadowBlur=10,e.shadowColor=g?"#00FFFF":"#004B93",e.fillStyle=g?"#00FFFF":"#004B93",e.fillRect(u,h+T,S,d),e.fillRect(a-u-S,h+T,S,d)}e.shadowBlur=0,e.lineWidth=4,e.strokeStyle="#00E5FF",e.setLineDash([60,60]),e.lineDashOffset=-n,e.shadowBlur=15,e.shadowColor="#00E5FF";const p=f/3;[p+u,p*2+u].forEach(h=>{e.beginPath(),e.moveTo(h,0),e.lineTo(h,l),e.stroke()}),e.setLineDash([]),e.shadowBlur=0},de=(e,a,l,o,i="URBAN")=>{switch(i){case"CRISIS":ke(e,a,l,o);break;case"METRO":De(e,a,l,o);break;case"DESERT":Me(e,a,l,o);break;case"PEPSI_CITY":we(e,a,l,o);break;case"URBAN":default:Le(e,a,l,o);break}},_e=(e,a)=>{const l=a.x,o=a.y+a.height,i=a.variant,n=E[i];if(n){const r=Date.now(),u=r*.005+a.y*.05,f=Math.sin(u),s=Math.sin(r/200)*5;e.fillStyle="rgba(0,0,0,0.3)",e.beginPath();const t=a.width/2.2*Math.abs(f);e.ellipse(l,o,Math.max(5,t),4,0,0,Math.PI*2),e.fill(),e.save(),e.translate(l,a.y+s),e.scale(f,1),e.drawImage(n,-a.width/2,0,a.width,a.height),e.restore()}else e.fillStyle=i==="CAN_DIET"?"#C0C0C0":"#004B93",e.fillRect(a.x-15,a.y,30,50)},He=(e,a,l)=>{const o=a.variant,i=Date.now(),n=a.width,r=a.height,u=a.x,f=a.y+r/2,s=a.x-n/2;let t=a.y;if(e.save(),o==="CONE"){const d=Math.abs(Math.sin(i*.008))*6;t-=d}else if(o==="BARREL"){const d=Math.sin(i*.005)*.15;e.translate(u,t+r),e.rotate(d),e.translate(-u,-(t+r))}else if(o==="BOX"){const d=1+Math.sin(i*.004)*.03;e.translate(u,f),e.scale(d,d),e.translate(-u,-f)}switch(o){case"CONE":e.fillStyle="#111",e.fillRect(s,t+r-5,n,5),e.fillStyle="#FF5722",e.beginPath(),e.moveTo(a.x,t),e.lineTo(s+5,t+r-5),e.lineTo(s+n-5,t+r-5),e.fill(),e.fillStyle="#FFF",e.fillRect(s+12,t+r/2,n-24,8);break;case"BARRIER":{if(e.fillStyle="#333",e.fillRect(s+5,t,5,r),e.fillRect(s+n-10,t,5,r),E.STRIPES){const S=e.createPattern(E.STRIPES,"repeat");S&&(e.fillStyle=S,e.fillRect(s,t+5,n,25),e.strokeStyle="#000",e.lineWidth=2,e.strokeRect(s,t+5,n,25))}else e.fillStyle="#FFC107",e.fillRect(s,t+5,n,25);const d=Math.floor(i/200)%2===0;e.fillStyle=d?"#FF0000":"#550000",e.beginPath(),e.arc(s+10,t,4,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(s+n-10,t,4,0,Math.PI*2),e.fill();break}case"BARREL":{if(l==="DESERT"){const d=e.createLinearGradient(s,t,s+n,t);d.addColorStop(0,"#5D4037"),d.addColorStop(.5,"#8D6E63"),d.addColorStop(1,"#3E2723"),e.fillStyle=d,e.fillRect(s,t,n,r),e.fillStyle="#111",e.fillRect(s,t+10,n,4),e.fillRect(s,t+r-15,n,4),e.fillStyle="#4E342E",e.beginPath(),e.ellipse(a.x,t,n/2,4,0,0,Math.PI*2),e.fill()}else if(l==="METRO")e.fillStyle="#F9A825",e.beginPath(),e.moveTo(s-5,t),e.lineTo(s+n+5,t),e.lineTo(s+n,t+r),e.lineTo(s,t+r),e.fill(),e.fillStyle="rgba(0,0,0,0.2)",e.fillRect(s+5,t+10,n-10,5),e.fillRect(s+5,t+25,n-10,5),e.fillStyle="#757575",e.beginPath(),e.arc(a.x,t,n/3,0,Math.PI,!0),e.fill();else if(l==="PEPSI_CITY"){const d=e.createLinearGradient(s,t,s+n,t);d.addColorStop(0,"#002244"),d.addColorStop(.5,"#004B93"),d.addColorStop(1,"#002244"),e.fillStyle=d,e.fillRect(s,t,n,r),e.fillStyle="#00FFFF",e.shadowBlur=5,e.shadowColor="#00FFFF",e.fillRect(s,t+r/2-2,n,4),e.shadowBlur=0}else{const d=e.createLinearGradient(s,t,s+n,t);d.addColorStop(0,"#616161"),d.addColorStop(.5,"#BDBDBD"),d.addColorStop(1,"#424242"),e.fillStyle=d,e.fillRect(s,t,n,r),e.fillStyle="rgba(0,0,0,0.2)";for(let S=5;S<n;S+=8)e.fillRect(s+S,t,2,r);if(e.fillStyle="#424242",e.beginPath(),e.ellipse(a.x,t,n/2,4,0,0,Math.PI*2),e.fill(),l==="CRISIS"){e.fillStyle=`rgba(255, ${Math.random()*100+100}, 0, 0.8)`,e.beginPath(),e.moveTo(s+5,t+5);const S=Math.random()*30+10;e.lineTo(a.x,t-S),e.lineTo(s+n-5,t+5),e.fill()}}break}case"BOX":e.fillStyle="#8D6E63",e.fillRect(s,t,n,r),e.strokeStyle="#5D4037",e.lineWidth=3,e.strokeRect(s,t,n,r),e.beginPath(),e.moveTo(s,t),e.lineTo(s+n,t+r),e.moveTo(s+n,t),e.lineTo(s,t+r),e.stroke(),e.lineWidth=1,e.beginPath(),e.moveTo(s,t+r/3),e.lineTo(s+n,t+r/3),e.moveTo(s,t+2*r/3),e.lineTo(s+n,t+2*r/3),e.stroke();break}e.restore()},D=[{name:"PEPSI",cab:"#C9002B",body:"#004B93",detail:"#FFF"},{name:"TRASH",cab:"#2E7D32",body:"#424242",detail:"#81C784"},{name:"PIZZA",cab:"#FFC107",body:"#FFF9C4",detail:"#FF5722"}],z=(e,a,l,o)=>{e.fillStyle="#111",e.beginPath(),e.arc(a,l,o,0,Math.PI*2),e.fill(),e.fillStyle="#555",e.beginPath(),e.arc(a,l,o/2,0,Math.PI*2),e.fill()},U=(e,a,l,o)=>{const i=Date.now();Math.floor(i/200)%2!==0&&(e.fillStyle="#FF0000",e.strokeStyle="#FFFFFF",e.lineWidth=2,e.beginPath(),o==="UP"?(e.moveTo(a,l-20),e.lineTo(a-15,l+10),e.lineTo(a+15,l+10)):(e.moveTo(a,l+20),e.lineTo(a-15,l-10),e.lineTo(a+15,l-10)),e.closePath(),e.fill(),e.stroke(),e.fillStyle="#FFF",e.font="bold 12px Arial",e.textAlign="center",e.fillText("DANGER",a,o==="UP"?l+25:l-15))},Oe=(e,a,l,o,i)=>{o>i?(e.fillStyle="#D32F2F",e.fillRect(a+10,l+i/2-8,o-20,16),e.fillStyle="#111",e.fillRect(a+30,l+i/2-10,20,8),z(e,a+10,l+i/2+5,10),z(e,a+o-10,l+i/2+5,10),e.fillStyle="#FFF",e.beginPath(),e.arc(a+o/2,l+5,8,0,Math.PI*2),e.fill(),e.fillStyle="#333",e.fillRect(a+o/2-5,l+15,10,20)):(e.fillStyle="#111",e.fillRect(a+o/2-3,l,6,10),e.fillStyle="#D32F2F",e.beginPath(),e.moveTo(a+o/2,l+5),e.lineTo(a+o,l+15),e.lineTo(a+o/2,l+25),e.lineTo(a,l+15),e.fill(),e.strokeStyle="#111",e.lineWidth=3,e.beginPath(),e.moveTo(a+5,l+20),e.lineTo(a+o-5,l+20),e.stroke(),e.fillStyle="#333",e.beginPath(),e.arc(a+o/2,l+35,10,0,Math.PI*2),e.fill(),e.fillStyle="#FFF",e.beginPath(),e.arc(a+o/2,l+30,7,0,Math.PI*2),e.fill(),e.fillStyle="#111",e.fillRect(a+o/2-4,l+28,8,3))},ue=(e,a,l,o,i,n,r)=>{e.fillStyle="rgba(0,0,0,0.3)",e.fillRect(a+5,l+5,o,i),n?(e.fillStyle=r.body,e.fillRect(a,l,o,i-15),e.strokeStyle="rgba(0,0,0,0.2)",e.lineWidth=2,e.beginPath(),e.moveTo(a+o/2,l),e.lineTo(a+o/2,l+i-15),e.stroke(),e.fillStyle="#D50000",e.fillRect(a+2,l+i-12,8,5),e.fillRect(a+o-10,l+i-12,8,5),e.fillStyle=r.cab,e.fillRect(a+4,l-5,o-8,5)):(e.fillStyle=r.body,e.fillRect(a,l,o,i-20),e.fillStyle=r.cab,e.fillRect(a+2,l+i-35,o-4,35),e.fillStyle="#81D4FA",e.fillRect(a+4,l+i-25,o-8,12),e.fillStyle="#FFEB3B",e.beginPath(),e.arc(a+6,l+i-5,3,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(a+o-6,l+i-5,3,0,Math.PI*2),e.fill())},Ge=(e,a,l,o,i,n)=>{e.fillStyle="rgba(0,0,0,0.3)",e.fillRect(a+10,l+i-10,o-20,10),z(e,a+o*.15,l+i-5,10),z(e,a+o*.85,l+i-5,10);const r=25,u=l,f=i-r;e.fillStyle=n.cab,e.fillRect(a,u+10,o*.25,f-10),e.fillStyle="#81D4FA",e.fillRect(a+5,u+15,o*.15,15),e.fillStyle=n.body,e.fillRect(a+o*.25,u,o*.75,f),e.fillStyle=n.detail,e.fillRect(a+o*.3,u+f/2-5,o*.6,10),e.fillStyle="rgba(0,0,0,0.2)",e.font="bold 10px Arial",e.fillText(n.name,a+o*.4,u+f/2+4)},Se=(e,a,l,o,i,n)=>{e.fillStyle="#1E88E5",e.beginPath(),e.roundRect(a,l,o,i,6),e.fill(),e.fillStyle="#1565C0",e.fillRect(a+4,l+10,o-8,i-20),e.fillStyle="#81D4FA",n?(e.fillRect(a+6,l+12,o-12,8),e.fillStyle="#FF0000",e.fillRect(a+3,l+i-4,6,3),e.fillRect(a+o-9,l+i-4,6,3)):(e.fillRect(a+6,l+i-20,o-12,8),e.fillStyle="#FFF",e.beginPath(),e.arc(a+6,l+i-3,3,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(a+o-6,l+i-3,3,0,Math.PI*2),e.fill())},je=(e,a,l="URBAN")=>{const o=a.x-a.width/2,i=a.y,n=a.width,r=a.height,u=a.variant;let f=D;l==="METRO"?f=[D[1]]:l==="CRISIS"?f=[D[1],D[2]]:l==="DESERT"?f=[D[0],D[2]]:l==="PEPSI_CITY"&&(f=[D[0]]);const t=a.id.split("").reduce((S,T)=>S+T.charCodeAt(0),0)%f.length,d=f[t];switch(e.save(),u){case"TRUCK_V":ue(e,o,i,n,r,!1,d);break;case"TRUCK_DOWN":ue(e,o,i,n,r,!0,d),a.warning&&a.y>c.CANVAS_HEIGHT&&U(e,a.x,c.CANVAS_HEIGHT-40,"UP");break;case"TRUCK_H":Ge(e,o,i,n,r,d);break;case"CAR":Se(e,o,i,n,r,!1),a.warning&&a.y<-50&&U(e,a.x,60,"DOWN");break;case"CAR_DOWN":Se(e,o,i,n,r,!0),a.warning&&a.y>c.CANVAS_HEIGHT&&U(e,a.x,c.CANVAS_HEIGHT-40,"UP");break;case"MOTO":Oe(e,o,i,n,r),a.warning&&a.y>c.CANVAS_HEIGHT&&U(e,a.x,c.CANVAS_HEIGHT-40,"UP");break}e.restore()},$=(e,a,l,o,i,n)=>{const r=Date.now(),u=Math.sin(r*.02)*10;e.fillStyle=i,e.beginPath(),e.ellipse(a,l,o/3,o/5,0,0,Math.PI*2),e.fill(),e.strokeStyle=i,e.lineWidth=3,e.beginPath(),e.moveTo(a-5,l),e.quadraticCurveTo(a-15,l-10+u,a-25,l+5),e.moveTo(a+5,l),e.quadraticCurveTo(a+15,l-10+u,a+25,l+5),e.stroke(),n&&(e.fillStyle=`rgba(255, ${Math.random()*100}, 0, 0.7)`,e.beginPath(),e.arc(a,l,o/2,0,Math.PI*2),e.fill())},Be=(e,a,l)=>{const o=a.x-a.width/2,i=a.y,n=a.width,r=a.height,u=a.variant;switch(e.save(),u){case"TREE":if(l==="CRISIS")e.fillStyle="#1a1a1a",e.fillRect(o,i+20,n,r-20),e.fillStyle=Math.random()>.5?"#FF5722":"#FFC107",e.beginPath(),e.moveTo(o,i+20),e.lineTo(o+n,i+20),e.lineTo(o+n/2,i-10+Math.random()*10),e.fill(),e.fillStyle="#0D47A1",e.fillRect(o+10,i+40,20,20);else if(l==="METRO"){e.fillStyle="#FBC02D",e.fillRect(o,i+20,n,r-20),e.fillStyle="#000";for(let f=0;f<n;f+=20)e.beginPath(),e.moveTo(o+f,i+20),e.lineTo(o+f+10,i+r),e.lineTo(o+f-5,i+r),e.lineTo(o+f-15,i+20),e.fill();e.fillStyle=Date.now()%500<250?"red":"#330000",e.beginPath(),e.arc(o+10,i+10,5,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(o+n-10,i+10,5,0,Math.PI*2),e.fill()}else l==="DESERT"?(e.fillStyle="#5D4037",e.fillRect(o+10,i+20,n-20,r-30),e.fillStyle="#3E2723",e.beginPath(),e.arc(o+15,i+30,15,0,Math.PI*2),e.fill(),e.strokeStyle="#E0E0E0",e.lineWidth=3,e.beginPath(),e.moveTo(o+15,i+30),e.lineTo(o+5,i+15),e.stroke()):l==="PEPSI_CITY"?(e.fillStyle="#004B93",e.fillRect(o,i+10,n,r-10),e.fillStyle="#00FFFF",e.fillRect(o,i+r-5,n,5),e.fillStyle="rgba(255,255,255,0.3)",e.fillRect(o+10,i-10,15,30),e.fillRect(o+30,i-10,15,30)):(e.fillStyle="#5D4037",e.fillRect(a.x-10,i+40,20,r-40),e.fillStyle="#2E7D32",e.beginPath(),e.arc(a.x,i+20,30,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(a.x-20,i+35,25,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(a.x+15,i+35,25,0,Math.PI*2),e.fill());break;case"HOLE":if(l==="CRISIS")e.fillStyle="#795548",e.fillRect(a.x-5,i+20,10,30),e.fillStyle="#FFCCBC",e.beginPath(),e.arc(a.x,i+15,8,0,Math.PI*2),e.fill(),e.fillStyle="#FFF",e.fillRect(o,i-10,n,30),e.fillStyle="#000",e.font="bold 8px Arial",e.fillText("NEED PEPSI",o+2,i+5);else if(l==="METRO")e.fillStyle="#000",e.fillRect(o,i,n,r),e.strokeStyle="#FFC107",e.lineWidth=2,e.strokeRect(o,i,n,r);else if(l==="DESERT")e.fillStyle="#795548",e.beginPath(),e.moveTo(o,i+r),e.quadraticCurveTo(a.x,i,o+n,i+r),e.fill();else{const f=e.createRadialGradient(a.x,i+r/2,0,a.x,i+r/2,n/2);f.addColorStop(0,"#000"),f.addColorStop(.8,"#222"),f.addColorStop(1,"rgba(0,0,0,0)"),e.fillStyle=f,e.beginPath(),e.ellipse(a.x,i+r/2,n/2,r/2,0,0,Math.PI*2),e.fill()}break;case"FLYING":l==="CRISIS"?$(e,a.x,a.y+20,n,"#3E2723",!0):l==="DESERT"?$(e,a.x,a.y+20,n,"#000",!1):$(e,a.x,a.y+20,n,l==="PEPSI_CITY"?"#00FFFF":"#555",!1);break}e.restore()},We=(e,a,l)=>{a.forEach(o=>{const i=o.x,n=o.y+o.height;o.type==="COLLECTIBLE"?_e(e,o):(o.variant!=="HOLE"&&(e.fillStyle="rgba(0,0,0,0.3)",e.beginPath(),e.ellipse(i,n,o.width/2.2,6,0,0,Math.PI*2),e.fill()),["CONE","BARREL","BOX","BARRIER"].includes(o.variant)?He(e,o,l):["TRUCK_V","TRUCK_H","TRUCK_DOWN","CAR","CAR_DOWN","MOTO"].includes(o.variant)?je(e,o,l):Be(e,o,l))})},F=(e,a,l,o,i)=>{const n=e.createLinearGradient(a-o/2,l,a+o/2,l);return i==="silver"?(n.addColorStop(0,"#555555"),n.addColorStop(.2,"#CCCCCC"),n.addColorStop(.4,"#FFFFFF"),n.addColorStop(.6,"#AAAAAA"),n.addColorStop(1,"#666666")):i==="blue"?(n.addColorStop(0,"#002244"),n.addColorStop(.3,"#004B93"),n.addColorStop(.5,"#007FFF"),n.addColorStop(.8,"#004B93"),n.addColorStop(1,"#002244")):(n.addColorStop(0,"#8B0000"),n.addColorStop(.5,"#FF0000"),n.addColorStop(1,"#8B0000")),n},H=(e,a,l)=>{const o=e.createRadialGradient(a-5,l-5,2,a,l,18);o.addColorStop(0,"#FFFFFF"),o.addColorStop(.5,"#CCCCCC"),o.addColorStop(1,"#777777"),e.fillStyle=o,e.beginPath(),e.arc(a,l,16,0,Math.PI*2),e.fill(),e.fillStyle="#111",e.beginPath(),e.ellipse(a,l+4,8,2,0,0,Math.PI*2),e.fill()},x=(e,a,l,o)=>{e.save(),e.beginPath(),e.arc(a,l,o,0,Math.PI*2),e.fillStyle="#FFF",e.fill(),e.beginPath(),e.arc(a,l,o-1,Math.PI,0),e.fillStyle="#C9002B",e.fill(),e.beginPath(),e.arc(a,l,o-1,0,Math.PI),e.fillStyle="#004B93",e.fill(),e.beginPath(),e.moveTo(a-o,l),e.quadraticCurveTo(a,l+o/2,a+o,l-o/3),e.lineTo(a+o,l+o/3),e.quadraticCurveTo(a,l+o,a-o,l+o/3),e.fillStyle="#FFF",e.fill(),e.restore()},K=(e,a,l)=>{e.fillStyle="rgba(0,0,0,0.5)",e.beginPath();const o=Math.max(.3,1-l/150);e.ellipse(0,c.PLAYER_HEIGHT+10+l,a/1.8*o,6*o,0,0,Math.PI*2),e.fill()},Z=(e,a,l,o,i,n,r,u)=>{e.save(),e.lineWidth=u?n*.9:n,e.strokeStyle=u?"#666":r,e.lineCap="round",e.beginPath(),e.moveTo(a,l),e.lineTo(o,i),e.stroke(),e.restore()},Ye=(e,a)=>{const{frame:l,y:o}=a,i=c.PLAYER_HEIGHT,n=c.PLAYER_WIDTH;K(e,n,o);const r=Math.abs(Math.sin(l*.35))*8;e.translate(0,-r);const u=Math.sin(l*.35),f=25,s=20,t=30,d=25,S=F(e,0,i/2,n,"silver"),T=F(e,0,i/2,n*.4,"blue");e.lineJoin="round",e.lineCap="round";const p=u>0,h=(p?-1:1)*f*u,g=i-Math.abs(u*s);Z(e,p?-10:10,i-45,h,g,16,S,!0);const b=(p?1:-1)*t*u,C=30-Math.abs(u*d);Z(e,p?22:-22,-5,b,C,14,S,!0),e.fillStyle=S,e.beginPath(),e.moveTo(-28,-15),e.lineTo(28,-15),e.lineTo(18,i-50),e.lineTo(-18,i-50),e.closePath(),e.fill(),e.beginPath(),e.ellipse(0,i-50,20,10,0,0,Math.PI),e.fill(),e.fillStyle=T,e.fillRect(-6,-15,12,i-40),x(e,0,5,10);const A=e.createRadialGradient(5,-35,2,0,-30,15);A.addColorStop(0,"#FFFFFF"),A.addColorStop(.6,"#AAAAAA"),A.addColorStop(1,"#555555"),e.fillStyle=A,e.beginPath(),e.arc(0,-30,14,0,Math.PI*2),e.fill(),e.fillStyle=S,e.fillRect(-6,-18,12,8);const I=(p?1:-1)*f*-u,L=i-10-Math.abs(u*5);Z(e,(p?10:-10)+(p?2:-2),i-45,I,L,17,S,!1);const k=(p?-1:1)*t*-u*1.2,v=35+Math.abs(u*10),N=p?-3:3;e.lineWidth=15,e.strokeStyle=S,e.beginPath(),e.moveTo((p?-22:22)+N,-5);const O=k*.6+(p?-15:15),M=v*.5-10;e.lineTo(O,M),e.lineTo(k,v),e.stroke()},q=(e,a,l,o,i,n,r,u)=>{e.save(),e.lineWidth=u?n*.9:n,e.strokeStyle=u?"#666":r,e.lineCap="round",e.lineJoin="round",e.beginPath(),e.moveTo(a,l);const f=(a+o)/2+(u?-5:5),s=(l+i)/2;e.quadraticCurveTo(f,s,o,i),e.stroke(),e.restore()},Ve=(e,a)=>{const{y:l,jumpVelocity:o}=a,i=c.PLAYER_HEIGHT,n=c.PLAYER_WIDTH,r=Math.max(-1,Math.min(1,o/12)),u=1-Math.abs(r);e.save();const f=Math.max(.2,1-l/250),s=Math.max(.5,1-l/300);e.globalAlpha=f,K(e,n*s,l+20),e.restore();const t=F(e,0,i/2,n,"silver"),d=F(e,0,i/2,n*.4,"blue"),S=i-45,T=-15,p=S+50-u*40+(r<0?Math.abs(r)*10:0),h=15;q(e,-12,S,-h,p,16,t,!0),q(e,12,S,h,p,17,t,!1),e.save(),e.translate(0,r*-5),e.fillStyle=t,e.beginPath(),e.moveTo(-30,T),e.lineTo(30,T),e.lineTo(15,S),e.lineTo(-15,S),e.closePath(),e.fill(),e.fillStyle=d,e.fillRect(-7,T,14,S-T+5),e.beginPath(),e.ellipse(0,S,18,8,0,0,Math.PI),e.fill(),x(e,0,T+15,12);const g=30+(r<0?Math.abs(r)*20:0),b=T-50+r*15;q(e,-25,T+5,-g,b,14,t,!0),q(e,25,T+5,g,b,15,t,!1);const C=r*-8;H(e,0,T-25+C),e.restore()},Ue=(e,a)=>{const{isDashing:l}=a,o=c.PLAYER_WIDTH,i=c.PLAYER_HEIGHT/2;e.fillStyle="rgba(255, 255, 255, 0.4)",e.beginPath(),e.moveTo(-o,i),e.lineTo(o,i),e.lineTo(0,-10),e.fill();const n=F(e,0,i/2,o,"silver"),r=F(e,0,i/2,o*.6,"blue");e.fillStyle=l?"#00FFFF":n,e.beginPath(),e.ellipse(0,i/2+10,o/1.6,i/2.8,0,0,Math.PI*2),e.fill(),e.fillStyle=r,e.beginPath(),e.ellipse(0,i/2+10,o/3,i/4,0,0,Math.PI*2),e.fill();const u=e.createRadialGradient(15,0,2,15,0,12);u.addColorStop(0,"#FFF"),u.addColorStop(1,"#888"),e.fillStyle=u,e.beginPath(),e.arc(25,5,12,0,Math.PI*2),e.fill()},qe=(e,a)=>{const{frame:l,y:o}=a,i=c.PLAYER_HEIGHT,n=c.PLAYER_WIDTH;e.save(),K(e,n*1.2,o),e.restore(),e.save(),e.globalAlpha=.3,e.translate(-15,5),e.fillStyle="#00FFFF",e.beginPath(),e.ellipse(0,i/2,n/2,i/2.5,35*Math.PI/180,0,Math.PI*2),e.fill(),e.restore(),e.rotate(45*Math.PI/180);const r=Math.sin(l*1.2)*35,u=F(e,0,i/2,n,"silver"),f="#00FFFF";e.lineCap="round",e.lineJoin="round",e.lineWidth=12,e.strokeStyle="#333",e.beginPath(),e.moveTo(-5,i-35),e.lineTo(-40-r,i+20),e.stroke(),e.lineWidth=4,e.strokeStyle="rgba(0,0,0,0.3)",e.beginPath(),e.moveTo(-5,i-35),e.lineTo(-50-r,i+25),e.stroke(),e.lineWidth=12,e.strokeStyle=u,e.beginPath(),e.moveTo(5,i-35),e.lineTo(40+r,i+20),e.stroke(),e.fillStyle=f,e.beginPath(),e.moveTo(-25,-10),e.lineTo(25,-10),e.lineTo(10,i-35),e.lineTo(-10,i-35),e.fill(),e.fillStyle="rgba(255,255,255,0.6)",e.fillRect(-25,-5,50,5),e.lineWidth=10,e.strokeStyle=u,e.beginPath(),e.moveTo(0,5),e.lineTo(-55,-10),e.stroke(),e.fillStyle="#FFF",e.beginPath(),e.arc(-55,-10,6,0,Math.PI*2),e.fill(),H(e,15,-20),e.fillStyle="rgba(255, 255, 255, 0.2)",e.beginPath(),e.moveTo(30,-20),e.lineTo(10,-40),e.quadraticCurveTo(0,-20,10,0),e.fill(),e.strokeStyle="rgba(255, 255, 255, 0.8)",e.lineWidth=2,e.beginPath(),e.moveTo(-40,-30),e.lineTo(-100,-30),e.moveTo(-40,0),e.lineTo(-120,0),e.moveTo(-30,40),e.lineTo(-90,45),e.stroke()},Xe=(e,a)=>{e.save(),e.fillStyle="#FFEB3B";for(let l=0;l<3;l++){const o=a*.1+l*(Math.PI*2/3),i=Math.cos(o)*30,n=Math.sin(o)*10-40;e.beginPath(),e.arc(i,n,4,0,Math.PI*2),e.fill()}e.restore()},ze=(e,a)=>{const{hitTimer:l,frame:o,crashType:i}=a,n=c.PLAYER_HEIGHT,r=c.PLAYER_WIDTH,u=c.STUN_DURATION,f=1-l/u;if(e.save(),i==="FACEPLANT"){const s=160*(Math.PI/180),t=Math.min(s,f*5*s);e.translate(0,n);const d=Math.sin(f*Math.PI)*20;if(f<.2&&e.translate(0,-d),e.rotate(t),t>=s){e.scale(1,.8);const S=Math.sin(o*.8)*5;e.translate(S,0)}j(e,r,n,"PANIC")}if(i==="TRIP"){const s=-250*Math.sin(f*Math.PI),t=-100*Math.sin(f*Math.PI);e.translate(0,s+t);const d=f*25;e.rotate(d);const S=1-f*.3;e.scale(S,S),j(e,r,n,"PANIC")}if(i==="FALL"){e.translate(0,n);const s=f*15;e.rotate(s);const t=Math.max(0,1-f*1.5);e.scale(t,t),e.globalAlpha=t,j(e,r,n,"PANIC")}else if(i==="SPIN"){const s=Math.sin(f*Math.PI)*-150,t=1+Math.sin(f*Math.PI)*.5;e.translate(0,s),e.scale(t,t),e.rotate(f*20),j(e,r,n,"FLAIL",o)}else{e.translate(0,n);const s=(Math.random()-.5)*5;e.translate(s,0);const t=.15+Math.abs(Math.sin(l*.2))*.05;e.scale(1.5,t),e.translate(0,-n),j(e,r,n,"FLAT"),e.restore(),e.save(),e.translate(0,n),Xe(e,o)}e.restore()},j=(e,a,l,o,i=0)=>{const n=F(e,0,l/2,a,"silver"),r=F(e,0,l/2,a*.6,"blue");if(e.lineCap="round",e.lineJoin="round",o==="FLAT")e.lineWidth=10,e.strokeStyle="#555",e.beginPath(),e.moveTo(0,l-20),e.lineTo(-40,l),e.stroke(),e.strokeStyle=n,e.beginPath(),e.moveTo(0,l-20),e.lineTo(40,l),e.stroke(),e.fillStyle=r,e.beginPath(),e.moveTo(-25,10),e.lineTo(25,10),e.lineTo(15,l-20),e.lineTo(-15,l-20),e.fill(),e.lineWidth=8,e.strokeStyle=n,e.beginPath(),e.moveTo(-20,15),e.lineTo(-50,30),e.stroke(),e.beginPath(),e.moveTo(20,15),e.lineTo(50,30),e.stroke(),H(e,0,5);else if(o==="FLAIL"){const u=Math.sin(i*.8)*20;e.lineWidth=12,e.strokeStyle="#555",e.beginPath(),e.moveTo(-5,l-30),e.lineTo(-25-u,l+10),e.stroke(),e.strokeStyle=n,e.beginPath(),e.moveTo(5,l-30),e.lineTo(25+u,l+10),e.stroke(),e.fillStyle=r,e.fillRect(-15,0,30,l-30),x(e,0,20,10),e.lineWidth=10,e.strokeStyle=n,e.beginPath(),e.moveTo(-15,10),e.lineTo(-40,10-u),e.stroke(),e.beginPath(),e.moveTo(15,10),e.lineTo(40,10+u),e.stroke(),H(e,0,-25)}else e.lineWidth=12,e.strokeStyle="#555",e.beginPath(),e.moveTo(-5,l-30),e.lineTo(-10,l+20),e.stroke(),e.strokeStyle=n,e.beginPath(),e.moveTo(5,l-30),e.lineTo(10,l+20),e.stroke(),e.fillStyle=r,e.fillRect(-15,0,30,l-30),e.lineWidth=10,e.strokeStyle=n,e.beginPath(),e.moveTo(-15,5),e.lineTo(-25,-30),e.stroke(),e.beginPath(),e.moveTo(15,5),e.lineTo(25,-30),e.stroke(),H(e,0,-20)},Ke=(e,a,l)=>{const{frame:o,y:i}=a,n=c.PLAYER_HEIGHT,r=c.PLAYER_WIDTH;K(e,r,i);const u=Math.sin(o*.15)*.4;e.rotate(u);const f=F(e,0,n/2,r,"silver");e.lineWidth=14,e.lineCap="round",e.strokeStyle="#555",e.beginPath(),e.moveTo(-10,n-40),e.lineTo(-20,n),e.stroke(),e.strokeStyle=f,e.beginPath(),e.moveTo(10,n-40),e.lineTo(20,n),e.stroke();const s=-25,t=-10,d=50,S=n-20;if(l==="DESERT"){const h=e.createLinearGradient(s,t,s+d,t);h.addColorStop(0,"#5D4037"),h.addColorStop(.5,"#8D6E63"),h.addColorStop(1,"#3E2723"),e.fillStyle=h,e.fillRect(s,t,d,S),e.fillStyle="#111",e.fillRect(s,t+10,d,5),e.fillRect(s,t+S-15,d,5)}else if(l==="METRO")e.fillStyle="#F9A825",e.beginPath(),e.moveTo(s-5,t),e.lineTo(s+d+5,t),e.lineTo(s+d,t+S),e.lineTo(s,t+S),e.fill(),e.fillStyle="rgba(0,0,0,0.2)",e.fillRect(s+5,t+15,d-10,5);else if(l==="PEPSI_CITY"){const h=e.createLinearGradient(s,t,s+d,t);h.addColorStop(0,"#002244"),h.addColorStop(.5,"#004B93"),e.fillStyle=h,e.fillRect(s,t,d,S),e.fillStyle="#00FFFF",e.fillRect(s,t+S/2,d,4)}else{const h=e.createLinearGradient(s,t,s+d,t);h.addColorStop(0,"#616161"),h.addColorStop(.5,"#BDBDBD"),h.addColorStop(1,"#424242"),e.fillStyle=h,e.fillRect(s,t,d,S),e.fillStyle="rgba(0,0,0,0.3)";for(let g=5;g<d;g+=10)e.fillRect(s+g,t,2,S);l==="CRISIS"&&(e.fillStyle=`rgba(255, ${Math.random()*100+150}, 0, 0.8)`,e.beginPath(),e.moveTo(s,t),e.lineTo(s+d/2,t-20-Math.random()*10),e.lineTo(s+d,t),e.fill())}e.strokeStyle=f,e.lineWidth=10,e.beginPath(),e.moveTo(-25,10),e.lineTo(-35,-25),e.stroke(),e.beginPath(),e.moveTo(25,10),e.lineTo(35,-25),e.stroke(),H(e,0,-35);const T=Math.sin(o*.2)*35,p=Math.cos(o*.2)*12;e.fillStyle="#FFEB3B",e.beginPath(),e.arc(T,-50+p,4,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(-T,-50-p,3,0,Math.PI*2),e.fill()},Je=(e,a,l="URBAN")=>{const{x:o,y:i,isSliding:n,isDashing:r,isHit:u,isJumping:f,isConfused:s,state:t}=a,d=c.CANVAS_HEIGHT-c.PLAYER_HEIGHT-30-i;if(e.save(),e.translate(o,d),t==="CRASHED"){ze(e,a),e.restore();return}if(u){const S=.3+Math.abs(Math.sin(Date.now()/50))*.5;e.globalAlpha=S}n?Ue(e,a):r?qe(e,a):f?Ve(e,a):s?Ke(e,a,l):Ye(e,a),e.globalAlpha=1,e.restore()},$e=()=>m.jsx("svg",{viewBox:"0 0 24 24",className:"w-6 h-6 md:w-10 md:h-10 fill-current text-white drop-shadow-[2px_2px_0_rgba(0,0,0,1)] transition-all duration-300",children:m.jsx("path",{d:"M13.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM9.8 8.9L7 6H2v2h3l1.8 4.3-3.2 6.1 1.6 1.2 5-9.9H13l-1.4 2.9 3.4 3.2-1.3 1.4-4.6-4L7 19l4 4 1.4-1.4-2.8-2.8L11 15l2.6-2.6 3.4 3.6V22h2v-6.5l-3.8-4.2 1.6-3.3c.3-.6.2-1.3-.3-1.8-.6-.5-1.3-.5-1.8 0l-4.9 4.9z"})}),Ze=()=>m.jsxs("svg",{viewBox:"0 0 24 24",className:"w-8 h-8 md:w-12 md:h-12 drop-shadow-[2px_2px_0_rgba(0,0,0,1)] transition-all duration-300",children:[m.jsx("defs",{children:m.jsxs("linearGradient",{id:"canGrad",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[m.jsx("stop",{offset:"0%",stopColor:"#003366"}),m.jsx("stop",{offset:"50%",stopColor:"#0057B8"}),m.jsx("stop",{offset:"100%",stopColor:"#003366"})]})}),m.jsx("path",{d:"M7 4h10v16H7z",fill:"url(#canGrad)",stroke:"white",strokeWidth:"1"}),m.jsx("ellipse",{cx:"12",cy:"4",rx:"5",ry:"2",fill:"#C0C0C0",stroke:"white",strokeWidth:"1"}),m.jsx("path",{d:"M7 20c0 1.1 2.24 2 5 2s5-.9 5-2",fill:"#C0C0C0",stroke:"white",strokeWidth:"1"}),m.jsx("circle",{cx:"12",cy:"12",r:"3",fill:"white"}),m.jsx("path",{d:"M9 12a3 3 0 0 1 6 0",fill:"#C9002B"})]}),Qe=({score:e,lives:a,cans:l,level:o})=>m.jsxs("div",{className:"absolute inset-0 pointer-events-none select-none font-sans overflow-hidden",children:[m.jsxs("div",{className:"absolute top-2 left-2 md:top-6 md:left-6 flex items-center gap-2 animate-in slide-in-from-left-10 duration-500 z-20",children:[m.jsx("div",{className:"transform -rotate-12 hover:scale-110 transition-transform",children:m.jsx(Ze,{})}),m.jsxs("div",{className:"flex flex-col",children:[m.jsxs("span",{className:"text-2xl md:text-5xl font-black italic text-white tracking-tighter leading-none",style:{textShadow:"2px 2px 0 #000, -1px -1px 0 #000, 1px -1px 0 #000",fontFamily:"Arial, sans-serif"},children:[l,"/100"]}),m.jsx("span",{className:"text-[10px] md:text-sm text-blue-200 font-bold tracking-widest hidden md:block",children:"COLLECTED"})]})]}),m.jsxs("div",{className:"absolute top-2 left-1/2 transform -translate-x-1/2 flex flex-col items-center z-20",children:[m.jsx("div",{className:"bg-black/60 px-2 py-0.5 md:px-4 md:py-1 rounded-sm transform -skew-x-12 border-b-2 border-white/30 mb-0 md:mb-1",children:m.jsx("span",{className:"text-yellow-400 text-[10px] md:text-xs font-bold tracking-[0.2em] transform skew-x-12 block",children:"SCORE"})}),m.jsx("span",{className:"text-4xl md:text-7xl font-black italic text-white tracking-tighter",style:{textShadow:"3px 3px 0 #000, 0 0 15px rgba(255,255,255,0.4)",fontFamily:"Impact, sans-serif"},children:e.toString().padStart(6,"0")})]}),m.jsxs("div",{className:"absolute top-2 right-2 md:bottom-8 md:top-auto md:right-6 flex flex-col items-end animate-in slide-in-from-right-10 duration-500 z-20",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx($e,{}),m.jsx("span",{className:"text-xl md:text-3xl font-black text-white",style:{textShadow:"2px 2px 0 #000"},children:"x"}),m.jsx("span",{className:"text-4xl md:text-6xl font-black italic text-yellow-400",style:{textShadow:"3px 3px 0 #B71C1C, 4px 4px 0 #000",fontFamily:"Arial, sans-serif"},children:Math.max(0,a)})]}),m.jsx("div",{className:"mt-1 md:mt-2 bg-blue-900/90 px-2 py-1 md:px-4 md:py-2 rounded border border-white/30 transform skew-x-12 shadow-lg",children:m.jsxs("span",{className:"text-[10px] md:text-sm text-cyan-300 font-mono font-bold transform -skew-x-12 block tracking-widest",children:["SPEED LVL ",o]})})]})]}),xe=({actions:e})=>{const a=R.useRef(0),l=R.useRef(0),o=R.useRef(!1),i=R.useRef(null),n=f=>{a.current=f.touches[0].clientX,l.current=f.touches[0].clientY,o.current=!1,i.current=setTimeout(()=>{o.current=!0,e.slide()},250)},r=f=>{if(o.current)return;const s=f.touches[0].clientX,t=f.touches[0].clientY;(Math.abs(s-a.current)>20||Math.abs(t-l.current)>20)&&i.current&&(clearTimeout(i.current),i.current=null)},u=f=>{if(i.current&&(clearTimeout(i.current),i.current=null),o.current)return;const s=f.changedTouches[0].clientX,t=f.changedTouches[0].clientY,d=a.current-s,S=l.current-t;if(Math.abs(d)>40||Math.abs(S)>40)Math.abs(d)>Math.abs(S)?d>0?e.moveLeft():e.moveRight():S>0?e.dash():e.slide();else{const T=window.innerWidth;a.current<T*.25?e.moveLeft():a.current>T*.75?e.moveRight():e.jump()}};return m.jsx("div",{className:"absolute inset-0 z-50 touch-none select-none",onTouchStart:n,onTouchMove:r,onTouchEnd:u})},el=()=>m.jsxs("div",{className:"relative w-24 h-36 mx-auto mb-4 animate-in zoom-in duration-500",children:[m.jsxs("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-900 via-blue-600 to-blue-800 transform -skew-y-6 scale-x-90 rounded-lg shadow-2xl border-x-2 border-blue-400/30 overflow-hidden",children:[m.jsx("div",{className:"absolute top-1/4 left-[-10%] w-[120%] h-24 bg-white transform rotate-6 flex items-center justify-center",children:m.jsx("div",{className:"w-12 h-12 rounded-full border-4 border-white shadow-inner bg-gradient-to-b from-red-600 via-white to-blue-600 relative overflow-hidden",children:m.jsx("div",{className:"absolute top-[40%] w-full h-[20%] bg-white transform -skew-x-12 scale-110"})})}),m.jsx("div",{className:"absolute top-10 left-2 w-full h-4 bg-black/20 blur-md transform rotate-3"}),m.jsx("div",{className:"absolute bottom-10 right-2 w-20 h-8 bg-black/30 blur-md transform -rotate-6"})]}),m.jsx("div",{className:"absolute -top-4 left-2 w-[90%] h-6 bg-gray-300 rounded-[100%] border-b-4 border-gray-400 transform scale-y-50"}),m.jsx("div",{className:"absolute -bottom-4 left-2 w-[90%] h-6 bg-gray-300 rounded-[100%] border-t-4 border-gray-400 transform scale-y-50"})]}),ll=({score:e,cans:a,level:l,onRestart:o,onExit:i})=>m.jsxs("div",{className:"absolute inset-0 z-30 bg-blue-900/90 backdrop-blur-md flex flex-col items-center justify-center text-white animate-in zoom-in duration-300 border-8 border-white m-4 shadow-[0_0_50px_rgba(0,0,0,0.8)] font-mono select-none",children:[m.jsxs("div",{className:"flex items-center gap-6 mb-6",children:[m.jsx(el,{}),m.jsxs("div",{className:"flex flex-col items-start",children:[m.jsx("h2",{className:"text-6xl font-black text-red-500 italic tracking-widest drop-shadow-[4px_4px_0_#fff]",style:{WebkitTextStroke:"2px white"},children:"CRASH!"}),m.jsx("span",{className:"text-sm bg-yellow-400 text-black px-3 py-1 font-black tracking-[0.3em] transform -skew-x-12 border-2 border-white shadow-lg",children:"GAME OVER"})]})]}),m.jsxs("div",{className:"w-80 bg-black/40 p-6 rounded-xl border-2 border-white/20 mb-8 shadow-inner space-y-4",children:[m.jsxs("div",{className:"flex justify-between items-center border-b border-white/10 pb-2",children:[m.jsx("span",{className:"text-blue-300 text-sm tracking-wider font-bold",children:"CANS COLLECTED"}),m.jsx("span",{className:"text-2xl font-bold text-white",children:a})]}),m.jsxs("div",{className:"flex justify-between items-center border-b border-white/10 pb-2",children:[m.jsx("span",{className:"text-green-400 text-sm tracking-wider font-bold",children:"SPEED LEVEL"}),m.jsx("span",{className:"text-2xl font-bold text-green-400",children:l})]}),m.jsxs("div",{className:"flex justify-between items-end pt-2 border-t-2 border-white",children:[m.jsx("span",{className:"text-yellow-400 text-xl font-black italic tracking-widest",children:"SCORE"}),m.jsx("span",{className:"text-4xl font-black text-yellow-400 drop-shadow-md",children:e.toString().padStart(6,"0")})]})]}),m.jsxs("div",{className:"flex flex-col gap-3 w-72",children:[m.jsxs("button",{onClick:o,className:"group relative py-4 bg-red-600 hover:bg-red-500 text-white font-black text-xl rounded shadow-[0_6px_0_#7F1D1D] active:translate-y-1 active:shadow-none transition-all uppercase tracking-widest overflow-hidden border-2 border-white/20",children:[m.jsx("span",{className:"relative z-10 drop-shadow-md",children:"TRY AGAIN"}),m.jsx("div",{className:"absolute inset-0 bg-white/20 transform -translate-x-full group-hover:animate-shine"})]}),m.jsx("button",{onClick:i,className:"py-3 bg-gray-800 hover:bg-gray-700 text-gray-400 hover:text-white font-bold text-sm rounded border border-gray-600 hover:border-white transition-all uppercase tracking-widest",children:"EXIT"})]})]}),al=({onExit:e})=>{const{status:a,startGame:l,player:o,entitiesRef:i,stats:n,actions:r}=Ie(),u=R.useRef(null),f=R.useRef(0),[s,t]=R.useState(0),[d,S]=R.useState(!1);ye(a,r),R.useEffect(()=>{const p=setInterval(()=>{t(h=>h>=100?(clearInterval(p),Ne(),S(!0),100):h+Math.floor(Math.random()*15)+5)},100);return()=>clearInterval(p)},[]);const T=R.useCallback(()=>{const p=A=>A>=10?"PEPSI_CITY":A>=7?"DESERT":A>=5?"METRO":A>=3?"CRISIS":"URBAN",h=u.current,g=p(n.level);if(!h)return;const b=h.getContext("2d");if(!b)return;if(a==="MENU"){de(b,h.width,h.height,3),f.current=requestAnimationFrame(T);return}b.clearRect(0,0,h.width,h.height);const C=c.INITIAL_SPEED+n.level*.5;de(b,h.width,h.height,C,g),We(b,i.current,g),Je(b,o),a==="PLAYING"&&(f.current=requestAnimationFrame(T))},[a,o,i,n.level]);return R.useEffect(()=>(f.current=requestAnimationFrame(T),()=>cancelAnimationFrame(f.current)),[T]),m.jsxs("div",{className:"fixed inset-0 z-[10000] bg-black flex items-center justify-center overflow-hidden font-sans select-none",children:[a==="PLAYING"&&m.jsxs(m.Fragment,{children:[m.jsx(Qe,{score:n.score,highScore:n.highScore,lives:n.lives,cans:n.cans,level:n.level}),m.jsx(xe,{actions:r})]}),m.jsx("canvas",{ref:u,width:c.CANVAS_WIDTH,height:c.CANVAS_HEIGHT,className:"bg-[#222] max-h-full max-w-full shadow-2xl border-x-8 border-blue-900",style:{imageRendering:"pixelated"}}),a==="MENU"&&m.jsxs("div",{className:"absolute inset-0 z-30 bg-black/60 backdrop-blur-sm flex flex-col items-center justify-center animate-in fade-in duration-500",children:[m.jsxs("div",{className:"relative mb-12 transform -rotate-3 hover:scale-105 transition-transform duration-500",children:[m.jsx("h1",{className:"text-7xl md:text-9xl font-black italic tracking-tighter text-white drop-shadow-[6px_6px_0_#004B93]",style:{WebkitTextStroke:"2px #C0C0C0"},children:"PEPSIMAN"}),m.jsx("div",{className:"absolute -bottom-2 right-4 bg-red-600 text-white text-xs md:text-sm font-bold px-3 py-1 transform rotate-3 shadow-lg border-2 border-white",children:"RUNNER"})]}),d?m.jsxs("div",{className:"flex flex-col gap-8 items-center animate-in slide-in-from-bottom-10 fade-in duration-500",children:[m.jsx("button",{onClick:l,className:"text-4xl md:text-6xl font-black text-yellow-400 tracking-widest uppercase hover:scale-110 transition-transform duration-100 filter drop-shadow-[0_0_15px_rgba(255,215,0,0.6)] animate-pulse",style:{textShadow:"4px 4px 0 #B71C1C"},children:"PRESS START"}),m.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white font-mono text-sm border-b border-transparent hover:border-white transition-all tracking-widest",children:"EXIT TO SYSTEM"}),m.jsxs("div",{className:"mt-8 text-[10px] text-gray-500 font-mono flex flex-col items-center gap-1",children:[m.jsx("p",{children:"INSERT COIN TO PLAY"}),m.jsx("p",{children:"Â© 1999 KIND OF PEPSI INC."})]})]}):m.jsxs("div",{className:"w-64 flex flex-col items-center gap-3",children:[m.jsx("div",{className:"text-blue-300 font-mono text-xs tracking-[0.3em] animate-pulse",children:"LOADING RESOURCES..."}),m.jsx("div",{className:"w-full h-6 bg-black border-2 border-white p-1 shadow-lg",children:m.jsx("div",{className:"h-full bg-gradient-to-r from-blue-600 via-blue-400 to-blue-600 bg-[length:20px_100%]",style:{width:`${s}%`}})})]})]}),a==="GAME_OVER"&&m.jsx(ll,{score:n.score,cans:n.cans,level:n.level,onRestart:l,onExit:e})]})},sl=({onExit:e})=>m.jsx(R.Suspense,{fallback:m.jsx("div",{className:"fixed inset-0 z-[10000] bg-black flex items-center justify-center text-blue-500",children:"LOADING ASSETS..."}),children:m.jsx(al,{onExit:e})});export{sl as GameLauncher};
