import{r as m,j as E}from"./index-CGil9ck0.js";const b={CANVAS_WIDTH:360,CANVAS_HEIGHT:640,LANE_COUNT:3,PLAYER_WIDTH:50,PLAYER_HEIGHT:80,PLAYER_HITBOX_PADDING:20,GRAVITY:.6,JUMP_FORCE:12,LANE_SWITCH_SPEED:.25,INITIAL_SPEED:8,DASH_MULTIPLIER:2.5,DASH_DURATION:60,DASH_COOLDOWN:180,SLIDE_DURATION:60,SLIDE_COOLDOWN:60,DIET_PEPSI_DURATION:240,STUN_DURATION:180,SPAWN_RATE_INITIAL:90,SPAWN_RATE_MIN:25,INITIAL_LIVES:3,CANS_FOR_LIFE:100},B=b.CANVAS_WIDTH/b.LANE_COUNT,G=B,_=[B*.5,B*1.5,B*2.5];let j=null;const te=()=>{if(!j){const e=window.AudioContext||window.webkitAudioContext;if(!e)throw new Error("Tu navegador no soporta Web Audio API");j=new e}return j},fe=e=>{const n=te();n.state==="suspended"&&n.resume();const l=n.createOscillator(),o=n.createGain();l.connect(o),o.connect(n.destination);const s=n.currentTime;switch(e){case"JUMP":l.type="square",l.frequency.setValueAtTime(150,s),l.frequency.exponentialRampToValueAtTime(600,s+.2),o.gain.setValueAtTime(.1,s),o.gain.exponentialRampToValueAtTime(.01,s+.2),l.start(s),l.stop(s+.2);break;case"SLIDE":l.type="sine",l.frequency.setValueAtTime(400,s),l.frequency.exponentialRampToValueAtTime(100,s+.3),o.gain.setValueAtTime(.1,s),o.gain.linearRampToValueAtTime(0,s+.3),l.start(s),l.stop(s+.3);break;case"COLLECT":l.type="sine",l.frequency.setValueAtTime(1200,s),l.frequency.setValueAtTime(1600,s+.1),o.gain.setValueAtTime(.1,s),o.gain.exponentialRampToValueAtTime(.01,s+.2),l.start(s),l.stop(s+.2);break;case"POWERUP":l.type="triangle",l.frequency.setValueAtTime(440,s),l.frequency.setValueAtTime(554,s+.1),l.frequency.setValueAtTime(659,s+.2),o.gain.setValueAtTime(.1,s),o.gain.linearRampToValueAtTime(0,s+.4),l.start(s),l.stop(s+.4);break;case"CRASH":l.type="sawtooth",l.frequency.setValueAtTime(100,s),l.frequency.exponentialRampToValueAtTime(10,s+.3),o.gain.setValueAtTime(.2,s),o.gain.exponentialRampToValueAtTime(.01,s+.3),l.start(s),l.stop(s+.3);break}},oe=()=>({play:m.useCallback(n=>{try{fe(n)}catch(l){console.warn("Audio error:",l)}},[])}),ue=()=>{const{play:e}=oe(),n=_?.[1],l=m.useRef({lane:1,x:n,y:0,state:"RUNNING",isJumping:!1,jumpVelocity:0,isSliding:!1,slideTimer:0,isDashing:!1,dashTimer:0,isHit:!1,hitTimer:0,isConfused:!1,confusionTimer:0,frame:0,cooldowns:{slide:0,dash:0}}),o=m.useCallback(()=>{const a=l.current;if(a.state==="CRASHED")return;const f=a.isConfused?1:-1,h=a.lane+f;h>=0&&h<=2&&(a.lane=h)},[]),s=m.useCallback(()=>{const a=l.current;if(a.state==="CRASHED")return;const f=a.isConfused?-1:1,h=a.lane+f;h>=0&&h<=2&&(a.lane=h)},[]),i=m.useCallback(()=>{const a=l.current;a.state!=="CRASHED"&&!a.isJumping&&!a.isSliding&&(a.isJumping=!0,a.jumpVelocity=b.JUMP_FORCE,a.state="RUNNING",e("JUMP"))},[e]),u=m.useCallback(()=>{const a=l.current;a.state!=="CRASHED"&&!a.isJumping&&!a.isSliding&&a.cooldowns.slide<=0&&(a.isSliding=!0,a.slideTimer=b.SLIDE_DURATION,a.cooldowns.slide=b.SLIDE_COOLDOWN+a.slideTimer,a.state="RUNNING",e("SLIDE"))},[e]),t=m.useCallback(()=>{const a=l.current;a.state!=="CRASHED"&&!a.isDashing&&a.cooldowns.dash<=0&&(a.isDashing=!0,a.dashTimer=b.DASH_DURATION,a.cooldowns.dash=b.DASH_COOLDOWN+a.dashTimer,a.isJumping=!1,a.y=0,a.isSliding=!1,a.state="RUNNING",e("POWERUP"))},[e]),r=m.useCallback(()=>{const a=l.current;a.frame++;const f=_?.[a.lane]??120*a.lane+60,h=b.LANE_SWITCH_SPEED;a.x+=(f-a.x)*h,a.isJumping&&(a.y+=a.jumpVelocity,a.jumpVelocity-=b.GRAVITY,a.y<=0&&(a.y=0,a.isJumping=!1,a.jumpVelocity=0,!a.isSliding&&!a.isDashing&&a.state!=="CRASHED"&&(a.state="RUNNING"))),a.isSliding&&(a.slideTimer--,a.slideTimer<=0&&(a.isSliding=!1,a.state!=="CRASHED"&&(a.state="RUNNING"))),a.isDashing&&(a.dashTimer--,a.dashTimer<=0&&(a.isDashing=!1,a.state!=="CRASHED"&&(a.state="RUNNING"))),a.isHit&&(a.hitTimer--,a.hitTimer<=0&&(a.isHit=!1,a.state==="CRASHED"&&(a.state="RUNNING"))),a.isConfused&&(a.confusionTimer--,a.confusionTimer<=0&&(a.isConfused=!1)),a.cooldowns.slide>0&&a.cooldowns.slide--,a.cooldowns.dash>0&&a.cooldowns.dash--},[]);return{playerRef:l,updatePlayer:r,actions:{moveLeft:o,moveRight:s,jump:i,slide:u,dash:t}}},de=()=>{const e=m.useRef([]),n=m.useRef(0),l=m.useRef(0),o=m.useCallback(()=>{e.current=[],n.current=0,l.current=0},[]),s=()=>{const u=Math.floor(Math.random()*3),t=`ent-${l.current++}`,r=Math.random()>.35;let a,f,h=50,T=50,c=_[u],R=0,d=!1;if(r){a="OBSTACLE";const S=Math.random();if(S<.2)f="CONE";else if(S<.4)f="BARRIER",h=70;else if(S<.55){f="TREE",h=G*1.8,T=80;const C=u===2?-G/2:G/2;c+=C}else if(S<.7)f="TRUCK_H",h=G*2.5,T=90,c=_[1];else if(S<.85){f="CAR",R=8,d=!0,T=90,h=45;const C=Math.random()>.5?0:2;c=_[C]}else f="HOLE",h=60}else a="COLLECTIBLE",f=Math.random()>.9?"CAN_DIET":"CAN_NORMAL",h=35,T=55;const p={id:t,type:a,variant:f,lane:u,x:c,y:-200,width:h,height:T,speedY:R,warning:d,warningTimer:d?60:0};e.current.push(p)},i=m.useCallback((u,t)=>{n.current++;const r=Math.max(b.SPAWN_RATE_MIN,b.SPAWN_RATE_INITIAL-t*5);n.current>=r&&(s(),n.current=0),e.current=e.current.filter(a=>a.warning&&a.warningTimer&&a.warningTimer>0?(a.warningTimer--,!0):(a.y+=u+(a.speedY||0),a.y<b.CANVAS_HEIGHT+100))},[]);return{entitiesRef:e,updateEntities:i,resetSpawner:o}},Se=()=>{const[e,n]=m.useState(0),[l,o]=m.useState(0),[s,i]=m.useState(b.INITIAL_LIVES),[u,t]=m.useState(0),[r,a]=m.useState(1),f=m.useRef(0),h=m.useRef(0),T=m.useRef(b.INITIAL_LIVES);m.useEffect(()=>{const S=localStorage.getItem("pepsiman_highscore");S&&o(parseInt(S,10))},[]);const c=m.useCallback(()=>{n(0),i(b.INITIAL_LIVES),t(0),a(1),f.current=0,h.current=0,T.current=b.INITIAL_LIVES},[]),R=m.useCallback(S=>{h.current+=S*.1;const C=Math.floor(h.current);if(C>f.current){f.current=C,n(C);const A=Math.floor(C/1e3)+1;A!==r&&a(A)}},[r]),d=m.useCallback(S=>{const C=S==="CAN_DIET"?50:10;f.current+=C,n(A=>A+C),S==="CAN_NORMAL"&&t(A=>{const L=A+1;return L>=b.CANS_FOR_LIFE?(T.current+=1,i(T.current),0):L})},[]),p=m.useCallback((S=1)=>{T.current-=S;const C=Math.max(0,T.current);return i(C),C<=0?(f.current>l&&(o(f.current),localStorage.setItem("pepsiman_highscore",f.current.toString())),!0):!1},[l]);return{score:e,highScore:l,lives:s,cans:u,level:r,resetScore:c,updateDistance:R,collectCan:d,takeDamage:p}},ce=()=>({checkCollision:m.useCallback((n,l)=>{const o=b.CANVAS_HEIGHT-b.PLAYER_HEIGHT-20,s=n.x-b.PLAYER_WIDTH/2+b.PLAYER_HITBOX_PADDING,i=n.x+b.PLAYER_WIDTH/2-b.PLAYER_HITBOX_PADDING,u=o+b.PLAYER_HITBOX_PADDING,t=o+b.PLAYER_HEIGHT-b.PLAYER_HITBOX_PADDING,r=l.x-l.width/2,a=l.x+l.width/2,f=l.y,h=l.y+l.height,T=s<a&&i>r,c=u<h&&t>f;return!T||!c||["HOLE","CAR","MOTO","BOX","WORKER","BARREL","CONE","BARRIER"].includes(l.variant)&&n.isJumping&&n.y>5||(l.variant==="TRUCK_H"||l.variant==="POLE")&&n.isSliding?!1:(["BOX","BARREL","CONE"].includes(l.variant)&&(n.isDashing||n.isSliding&&(l.variant==="BARREL"||l.variant==="BOX"||l.variant==="CONE")),!0)},[])}),he=e=>{const{checkCollision:n}=ce(),{playerRef:l,entitiesRef:o,dietTimerRef:s,stunTimerRef:i,speedRef:u,setStatus:t,play:r,collectCan:a,takeDamage:f}=e;return{resolveCollisions:m.useCallback(()=>{const T=l.current;for(let c=o.current.length-1;c>=0;c--){const R=o.current[c];if(n(T,R)){if(R.type==="COLLECTIBLE"){const d=R.variant;a(d),d==="CAN_DIET"?(r("POWERUP"),s.current=b.DIET_PEPSI_DURATION):r("COLLECT"),o.current.splice(c,1)}else if(!T.isHit){const d=["BOX","BARREL","CONE"].includes(R.variant);if(T.isDashing&&d||T.isDashing&&["BARRIER"].includes(R.variant)||T.isSliding&&["BOX","BARREL","CONE"].includes(R.variant))r("CRASH"),o.current.splice(c,1);else{r("CRASH"),T.isHit=!0,T.hitTimer=300,T.state="CRASHED",i.current=b.STUN_DURATION,R.variant==="BARREL"&&(T.isConfused=!0,T.confusionTimer=600);let S=1;if(["TRUCK_V","TRUCK_H"].includes(R.variant)&&(S=2),R.variant==="HOLE"&&(S=999),f(S))return t("GAME_OVER"),!0;o.current.splice(c,1),u.current=Math.max(b.INITIAL_SPEED,u.current-2)}}}}return!1},[n,a,f,o,l,r,t,s,i,u])}},z=1e3/60,Te=()=>{const{playerRef:e,updatePlayer:n,actions:l}=ue(),{moveLeft:o,moveRight:s,jump:i,slide:u,dash:t}=l,{entitiesRef:r,updateEntities:a,resetSpawner:f}=de(),{play:h}=oe(),{score:T,highScore:c,lives:R,cans:d,level:p,resetScore:S,updateDistance:C,collectCan:A,takeDamage:L}=Se(),[I,v]=m.useState("MENU"),y=m.useRef(0),D=m.useRef(0),W=m.useRef(b.INITIAL_SPEED),O=m.useRef(0),F=m.useRef(0),se=m.useMemo(()=>({moveLeft:o,moveRight:s,jump:i,slide:u,dash:t}),[o,s,i,u,t]),{resolveCollisions:V}=he({playerRef:e,entitiesRef:r,dietTimerRef:O,stunTimerRef:F,speedRef:W,setStatus:v,play:h,collectCan:A,takeDamage:L}),H=m.useCallback(g=>{if(I!=="PLAYING")return;D.current||(D.current=g);const q=g-D.current;if(q>z){D.current=g-q%z;let k=W.current+p*.5;if(F.current>0?(k=0,F.current--,F.current<=0&&e.current.state==="CRASHED"&&(e.current.state="RUNNING",e.current.isHit=!1)):(e.current.isDashing&&(k*=b.DASH_MULTIPLIER),O.current>0&&(k+=5,O.current--)),n(),k>0&&(a(k,p),C(k)),V())return}y.current=requestAnimationFrame(H)},[I,p,n,a,C,V,e]),X=m.useRef(H);m.useEffect(()=>{X.current=H},[H]);const N=m.useCallback(g=>{X.current(g)},[]);m.useEffect(()=>(I==="PLAYING"&&(y.current=requestAnimationFrame(N)),()=>cancelAnimationFrame(y.current)),[I,N]);const ie=m.useCallback(()=>{S(),f(),W.current=b.INITIAL_SPEED,O.current=0,F.current=0;const g=e.current;g.lane=1,g.x=180,g.y=0,g.state="RUNNING",g.isHit=!1,g.isJumping=!1,g.isSliding=!1,g.isDashing=!1,g.isConfused=!1,g.slideTimer=0,g.dashTimer=0,g.hitTimer=0,v("PLAYING"),D.current=0,y.current&&cancelAnimationFrame(y.current),y.current=requestAnimationFrame(N)},[S,f,e,N]),re=m.useCallback(()=>{I==="PLAYING"?(v("PAUSED"),cancelAnimationFrame(y.current)):I==="PAUSED"&&(v("PLAYING"),D.current=0,y.current=requestAnimationFrame(N))},[I,N]);return m.useEffect(()=>()=>{y.current&&cancelAnimationFrame(y.current)},[]),{status:I,startGame:ie,pauseGame:re,player:e.current,entitiesRef:r,stats:{score:T,highScore:c,lives:R,cans:d,level:p},actions:se}},me=(e,n)=>{const l=m.useRef(0),o=m.useRef(!1),s=m.useRef(null);m.useEffect(()=>{const i=t=>{if(e==="PLAYING")switch(t.key){case"ArrowLeft":case"a":n.moveLeft();break;case"ArrowRight":case"d":n.moveRight();break;case"ArrowUp":case"w":n.dash();break;case"ArrowDown":case"s":n.slide();break;case" ":case"Shift":!t.repeat&&l.current===0&&(t.preventDefault(),l.current=Date.now(),o.current=!1,s.current=setTimeout(()=>{l.current!==0&&(o.current=!0,n.slide())},250));break}},u=t=>{if(t.key===" "||t.key==="Shift"){s.current&&(clearTimeout(s.current),s.current=null);const r=Date.now()-l.current;l.current=0,r<250&&!o.current&&n.jump(),o.current=!1}};return window.addEventListener("keydown",i),window.addEventListener("keyup",u),()=>{window.removeEventListener("keydown",i),window.removeEventListener("keyup",u),s.current&&clearTimeout(s.current)}},[e,n])},P={},w={PEPSI_BLUE:"#004B93",PEPSI_RED:"#C9002B",SILVER:"#E0E0E0",ASPHALT:"#2D2D2D"},U=(e,n)=>{const l=document.createElement("canvas");return l.width=e,l.height=n,{canvas:l,ctx:l.getContext("2d")}},J=e=>{const{canvas:o,ctx:s}=U(30,50),i=e==="diet"?w.SILVER:w.PEPSI_BLUE,u=s.createLinearGradient(0,0,30,0);u.addColorStop(0,"rgba(0,0,0,0.3)"),u.addColorStop(.2,i),u.addColorStop(.5,e==="diet"?"#FFFFFF":"#0072CE"),u.addColorStop(.8,i),u.addColorStop(1,"rgba(0,0,0,0.3)"),s.fillStyle=u,s.fillRect(0,0,30,50),s.fillStyle="#999",s.fillRect(0,0,30,3),s.fillRect(0,47,30,3);const t=30/2,r=50/2,a=8;return s.beginPath(),s.arc(t,r,a,0,Math.PI*2),s.fillStyle="#FFF",s.fill(),s.beginPath(),s.arc(t,r,a-2,0,Math.PI*2),s.fillStyle=w.PEPSI_RED,s.fill(),s.beginPath(),s.arc(t,r,a-2,0,Math.PI,!1),s.fillStyle=w.PEPSI_BLUE,s.fill(),o},Re=()=>{const{canvas:n,ctx:l}=U(200,200);l.fillStyle=w.ASPHALT,l.fillRect(0,0,200,200);for(let o=0;o<400;o++){const s=Math.random()*200,i=Math.random()*200,u=Math.random()*2;l.fillStyle=Math.random()>.5?"#383838":"#222",l.fillRect(s,i,u,u)}return n},be=()=>{const{canvas:n,ctx:l}=U(50,50);return l.fillStyle="#FBC02D",l.fillRect(0,0,50,50),l.fillStyle="#000",l.beginPath(),l.moveTo(0,50),l.lineTo(50,0),l.lineTo(50,10),l.lineTo(10,50),l.fill(),l.beginPath(),l.moveTo(0,10),l.lineTo(10,0),l.lineTo(0,0),l.fill(),n},Ce=()=>{P.CAN_NORMAL||(console.log("ðŸŽ¨ Generando texturas en memoria..."),P.CAN_NORMAL=J("normal"),P.CAN_DIET=J("diet"),P.ASPHALT=Re(),P.STRIPES=be())},K=(e,n,l,o,s,i)=>{e.fillStyle=i,e.fillRect(n,l,o,s),e.beginPath(),e.moveTo(n-5,l),e.lineTo(n+o/2,l-20),e.lineTo(n+o+5,l),e.fillStyle="#5D4037",e.fill(),e.fillStyle="#81D4FA",e.fillRect(n+10,l+10,15,15),e.fillStyle="#3E2723",e.fillRect(n+o-20,l+20,15,s-20)},Ee=(e,n,l,o)=>{const s=Date.now(),i=s*o*.1,u=e.createLinearGradient(0,0,0,l);u.addColorStop(0,"#42A5F5"),u.addColorStop(1,"#90CAF9"),e.fillStyle=u,e.fillRect(0,0,n,l);const t=20,r=n-t*2;e.fillStyle="#4CAF50",e.fillRect(0,0,n,l);const a=300,f=s*o*.08%a;for(let S=-a;S<l+a;S+=a)K(e,5,S+f,40,40,"#E0E0E0"),K(e,n-45,S+f+150,40,40,"#FFE082");if(P.ASPHALT){const S=e.createPattern(P.ASPHALT,"repeat");if(S){const C=new DOMMatrix;C.translateSelf(0,i%256),S.setTransform(C),e.fillStyle=S,e.fillRect(t,0,r,l)}}else e.fillStyle="#333",e.fillRect(t,0,r,l);const h=50,T=10,c=i%(h*2);for(let S=-h*2;S<l+h;S+=h){const C=Math.floor((S+c)/h)%2===0;e.fillStyle=C?"#D32F2F":"#EEEEEE",e.fillRect(t,S+c,T,h),e.fillRect(n-t-T,S+c,T,h)}e.lineWidth=4,e.strokeStyle="#FFFFFF",e.setLineDash([40,40]),e.lineDashOffset=-i;const R=r/3;e.beginPath(),e.moveTo(t+R,0),e.lineTo(t+R,l),e.stroke(),e.beginPath(),e.moveTo(t+R*2,0),e.lineTo(t+R*2,l),e.stroke(),e.setLineDash([]);const d=e.createLinearGradient(t,0,t+15,0);d.addColorStop(0,"rgba(0,0,0,0.3)"),d.addColorStop(1,"rgba(0,0,0,0)"),e.fillStyle=d,e.fillRect(t,0,15,l);const p=e.createLinearGradient(n-t-15,0,n-t,0);p.addColorStop(0,"rgba(0,0,0,0)"),p.addColorStop(1,"rgba(0,0,0,0.3)"),e.fillStyle=p,e.fillRect(n-t-15,0,15,l)},$=(e,n,l,o,s)=>{e.fillStyle="#1a1a1a",e.fillRect(n,l,o,s);for(let i=l+10;i<l+s;i+=30)for(let u=n+5;u<n+o-5;u+=20)Math.random()>.7?(e.fillStyle="#FF5722",e.fillRect(u,i,10,20)):(e.fillStyle="#000",e.fillRect(u,i,10,20))},pe=(e,n,l,o)=>{const s=Date.now(),i=s*o*.1,u=e.createLinearGradient(0,0,0,l);u.addColorStop(0,"#B71C1C"),u.addColorStop(.5,"#E65100"),u.addColorStop(1,"#3E2723"),e.fillStyle=u,e.fillRect(0,0,n,l);const t=15,r=n-t*2;e.fillStyle="#3E2723",e.fillRect(0,0,n,l);const a=400,f=s*o*.05%a;for(let d=-a;d<l+a;d+=a)$(e,-20,d+f,40,120),$(e,n-30,d+f+200,50,150);if(P.ASPHALT){const d=e.createPattern(P.ASPHALT,"repeat");if(d){const p=new DOMMatrix;p.translateSelf(0,i%256),d.setTransform(p),e.fillStyle=d,e.fillRect(t,0,r,l)}}e.fillStyle="rgba(183, 28, 28, 0.2)",e.fillRect(t,0,r,l);const h=60,T=i%(h*2);for(let d=-h*2;d<l+h;d+=h){const p=Math.floor((d+T)/h)%2===0;e.fillStyle=p?"#3E2723":"#5D4037",e.fillRect(0,d+T,15,h),e.fillRect(n-15,d+T,15,h)}e.lineWidth=3,e.strokeStyle="#FFC107",e.setLineDash([30,80]),e.lineDashOffset=-i;const c=r/3;[c+t,c*2+t].forEach(d=>{e.beginPath(),e.moveTo(d,0),e.lineTo(d,l),e.stroke()}),e.setLineDash([]),e.fillStyle="rgba(0, 0, 0, 0.1)";const R=s*.1%l;for(let d=0;d<5;d++){const p=Math.sin(s*.001+d)*n/2+n/2,S=(R+d*150)%l;e.beginPath(),e.arc(p,l-S,20+d*5,0,Math.PI*2),e.fill()}},Ae=(e,n,l,o)=>{const s=Date.now(),i=s*o*.15;e.fillStyle="#1a1a1a",e.fillRect(0,0,n,l);const u=10,t=n-u*2,r=e.createLinearGradient(0,0,n,0);r.addColorStop(0,"#000000"),r.addColorStop(.2,"#263238"),r.addColorStop(.5,"#37474F"),r.addColorStop(.8,"#263238"),r.addColorStop(1,"#000000"),e.fillStyle=r,e.fillRect(0,0,n,l);const a=40,f=i%(a*2),h=20;for(let A=-a*2;A<l+a;A+=a){const L=Math.floor((A+f)/a)%2===0;e.fillStyle=L?"#FFEB3B":"#000000",e.fillRect(u,A+f,h,a),e.fillRect(n-u-h,A+f,h,a)}const T=15,c=100,R=i%c;e.fillStyle="#424242",e.fillRect(0,0,T,l),e.fillRect(n-T,0,T,l),e.fillStyle="#212121";for(let A=-c;A<l+c;A+=c)e.fillRect(0,A+R,T+5,20),e.fillRect(n-T-5,A+R,T+5,20);e.lineWidth=3,e.strokeStyle="rgba(0, 255, 255, 0.3)",e.setLineDash([80,80]),e.lineDashOffset=-i;const d=t/3,p=u+h;e.beginPath(),e.moveTo(p+d,0),e.lineTo(p+d,l),e.stroke(),e.beginPath(),e.moveTo(p+d*2,0),e.lineTo(p+d*2,l),e.stroke(),e.setLineDash([]);const S=400,C=s*o*.2%S;e.fillStyle="rgba(255, 255, 255, 0.05)";for(let A=-S;A<l+S;A+=S)e.fillRect(0,A+C,n,30)},Q=(e,n,l,o)=>{e.fillStyle="#2E7D32",e.fillRect(n,l,10*o,40*o),e.fillRect(n-10*o,l+10*o,10*o,5*o),e.fillRect(n-10*o,l-5*o,5*o,20*o),e.fillRect(n+10*o,l+15*o,10*o,5*o),e.fillRect(n+15*o,l+5*o,5*o,15*o)},Z=(e,n,l,o)=>{e.fillStyle="#8D6E63",e.beginPath(),e.arc(n,l,o,0,Math.PI*2),e.fill(),e.fillStyle="rgba(0,0,0,0.1)",e.beginPath(),e.arc(n+2,l+2,o*.8,0,Math.PI*2),e.fill()},ge=(e,n,l,o)=>{const s=Date.now(),i=s*o*.1,u=e.createLinearGradient(0,0,0,l);u.addColorStop(0,"#0288D1"),u.addColorStop(1,"#B3E5FC"),e.fillStyle=u,e.fillRect(0,0,n,l);const t=s*o*.02%n;e.fillStyle="#E65100",e.beginPath(),e.moveTo(0,l);for(let S=-1;S<2;S++){const C=S*n-t;e.lineTo(C+100,l-150),e.lineTo(C+200,l-80),e.lineTo(C+250,l-120),e.lineTo(C+350,l-120),e.lineTo(C+400,l)}e.lineTo(n,l),e.fill();const r=20,a=n-r*2;e.fillStyle="#FF9800",e.fillRect(0,0,n,l);const f=400,h=s*o*.08%f;for(let S=-f;S<l+f;S+=f)Q(e,15,S+h,.8),Z(e,40,S+h+200,8),Q(e,n-25,S+h+150,1),Z(e,n-45,S+h-50,12);if(P.ASPHALT){const S=e.createPattern(P.ASPHALT,"repeat");if(S){const C=new DOMMatrix;C.translateSelf(0,i%256),S.setTransform(C),e.fillStyle=S,e.fillRect(r,0,a,l)}}else e.fillStyle="#5D4037",e.fillRect(r,0,a,l);e.fillStyle="rgba(255, 152, 0, 0.15)",e.fillRect(r,0,a,l);const T=80,c=8,R=i%(T*2);for(let S=-T*2;S<l+T;S+=T){const C=Math.floor((S+R)/T)%2===0;e.fillStyle=C?"#E65100":"#FFE0B2",e.fillRect(r-c,S+R,c,T),e.fillRect(n-r,S+R,c,T)}e.lineWidth=3,e.strokeStyle="#FFF3E0",e.setLineDash([40,60]),e.lineDashOffset=-i;const d=a/3;[d+r,d*2+r].forEach(S=>{e.beginPath(),e.moveTo(S,0),e.lineTo(S,l),e.stroke()}),e.setLineDash([]),e.fillStyle="rgba(255, 255, 255, 0.05)";const p=s*.005%20;for(let S=0;S<l/4;S+=10){const C=Math.sin(S*.1+p)*5;e.fillRect(0+C,S,n,2)}},ae=(e,n,l,o)=>{e.save(),e.beginPath(),e.arc(n,l,o,0,Math.PI*2),e.fillStyle="#FFF",e.fill(),e.beginPath(),e.arc(n,l,o-2,Math.PI,0),e.fillStyle="#C9002B",e.fill(),e.beginPath(),e.arc(n,l,o-2,0,Math.PI),e.fillStyle="#004B93",e.fill(),e.beginPath(),e.moveTo(n-o,l),e.quadraticCurveTo(n,l+o/2,n+o,l-o/3),e.lineTo(n+o,l+o/3),e.quadraticCurveTo(n,l+o,n-o,l+o/3),e.fillStyle="#FFF",e.fill(),e.restore()},x=(e,n,l,o,s,i,u)=>{e.fillStyle="#0D47A1",e.fillRect(n,l,o,s),e.strokeStyle="#00FFFF",e.lineWidth=1,e.strokeRect(n,l,o,s),e.fillStyle="#42A5F5";for(let f=l+10;f<l+s;f+=20)for(let h=n+5;h<n+o;h+=15)Math.sin(h*f+u)>0&&e.fillRect(h,f,8,12);const t=u%4,r=60,a=l+20;if(e.fillStyle="#000",e.fillRect(n+5,a,o-10,r),t===0)Math.floor(i/500)%2===0&&(e.fillStyle="#FF0000",e.font="bold 20px Arial",e.textAlign="center",e.fillText("PEPSI",n+o/2,a+35));else if(t===1)ae(e,n+o/2,a+30,20);else if(t===2){e.save(),e.beginPath(),e.rect(n+5,a,o-10,r),e.clip();const f=i*.1%200;e.fillStyle="#00FFFF",e.font="16px monospace",e.fillText("DRINK! DRINK! DRINK!",n+o-f,a+35),e.restore()}else e.fillStyle="#004B93",e.fillRect(n+10,a+10,o-20,r-20)},Pe=(e,n,l,o)=>{const s=Date.now(),i=s*o*.1,u=e.createLinearGradient(0,0,0,l);u.addColorStop(0,"#000000"),u.addColorStop(.5,"#0D47A1"),u.addColorStop(1,"#1976D2"),e.fillStyle=u,e.fillRect(0,0,n,l),ae(e,n*.8,80,40),e.fillStyle="rgba(255, 255, 255, 0.1)",e.beginPath(),e.arc(n*.8,80,60,0,Math.PI*2),e.fill();const t=10,r=n-t*2;if(e.fillStyle="#37474F",e.fillRect(0,0,n,l),e.fillStyle="#102027",e.fillRect(t,0,r,l),P.ASPHALT){e.globalAlpha=.3;const d=e.createPattern(P.ASPHALT,"repeat");if(d){const p=new DOMMatrix;p.translateSelf(0,i%256),d.setTransform(p),e.fillStyle=d,e.fillRect(t,0,r,l)}e.globalAlpha=1}const a=300,f=s*o*.12%a;for(let d=-a;d<l+a;d+=a)x(e,-40,d+f,80,250,s,Math.floor(d)),x(e,n-40,d+f+150,80,280,s,Math.floor(d)+1);const h=40,T=10,c=i%(h*2);for(let d=-h*2;d<l+h;d+=h){const p=Math.floor((d+c)/h)%2===0;e.shadowBlur=10,e.shadowColor=p?"#00FFFF":"#004B93",e.fillStyle=p?"#00FFFF":"#004B93",e.fillRect(t,d+c,T,h),e.fillRect(n-t-T,d+c,T,h)}e.shadowBlur=0,e.lineWidth=4,e.strokeStyle="#00E5FF",e.setLineDash([60,60]),e.lineDashOffset=-i,e.shadowBlur=15,e.shadowColor="#00E5FF";const R=r/3;[R+t,R*2+t].forEach(d=>{e.beginPath(),e.moveTo(d,0),e.lineTo(d,l),e.stroke()}),e.setLineDash([]),e.shadowBlur=0},ee=(e,n,l,o,s="URBAN")=>{switch(s){case"CRISIS":pe(e,n,l,o);break;case"METRO":Ae(e,n,l,o);break;case"DESERT":ge(e,n,l,o);break;case"PEPSI_CITY":Pe(e,n,l,o);break;case"URBAN":default:Ee(e,n,l,o);break}},M=(e,n,l,o)=>{e.fillStyle="#111",e.beginPath(),e.arc(n,l,o,0,Math.PI*2),e.fill(),e.fillStyle="#555",e.beginPath(),e.arc(n,l,o/2,0,Math.PI*2),e.fill()},Ie=(e,n)=>{const l=n.x-n.width/2,o=n.y,s=n.width,i=n.height;switch(n.variant){case"BARRIER":if(e.fillStyle="#333",e.fillRect(l+5,o,5,i),e.fillRect(l+s-10,o,5,i),P.STRIPES){const t=e.createPattern(P.STRIPES,"repeat");t&&(e.fillStyle=t,e.fillRect(l,o+5,s,25),e.strokeStyle="#000",e.lineWidth=2,e.strokeRect(l,o+5,s,25))}else e.fillStyle="#FFC107",e.fillRect(l,o+5,s,25);e.fillStyle=Date.now()%500<250?"#FF0000":"#550000",e.beginPath(),e.arc(l+10,o,3,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(l+s-10,o,3,0,Math.PI*2),e.fill();break;case"TRUCK_V":e.fillStyle="#B71C1C",e.fillRect(l,o,s,i),e.strokeStyle="#7F0000",e.lineWidth=2,e.beginPath(),e.moveTo(n.x,o),e.lineTo(n.x,o+i),e.stroke(),e.fillStyle="#FF0000",e.fillRect(l+5,o+i-10,10,5),e.fillRect(l+s-15,o+i-10,10,5),M(e,l-2,o+i-5,6),M(e,l+s+2,o+i-5,6);break;case"TRUCK_H":e.fillStyle="#EEE",e.fillRect(l,o+15,s*.2,i-15),e.fillStyle="#81D4FA",e.fillRect(l+5,o+20,s*.15,15),e.fillStyle="#D32F2F",e.fillRect(l+s*.22,o,s*.78,i),e.fillStyle="white",e.beginPath(),e.ellipse(l+s*.6,o+i/2,s*.2,10,0,0,Math.PI*2),e.fill(),M(e,l+s*.1,o+i,8),M(e,l+s*.3,o+i,8),M(e,l+s*.8,o+i,8);break;case"CAR":e.fillStyle="#1565C0",e.beginPath(),e.moveTo(l,o+20),e.lineTo(l+s,o+20),e.lineTo(l+s,o+i),e.lineTo(l,o+i),e.fill(),e.fillStyle="#81D4FA",e.beginPath(),e.moveTo(l+5,o+20),e.lineTo(l+s-5,o+20),e.lineTo(l+s-10,o+50),e.lineTo(l+10,o+50),e.fill(),e.fillStyle="#FFF59D",e.beginPath(),e.arc(l+8,o+i-5,5,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(l+s-8,o+i-5,5,0,Math.PI*2),e.fill(),n.warning&&n.y<-50&&(e.fillStyle="red",e.font="bold 40px Arial",e.textAlign="center",e.fillText("!",n.x,80));break;case"HOLE":{const t=e.createRadialGradient(n.x,o+i/2,0,n.x,o+i/2,s/2);t.addColorStop(0,"#000"),t.addColorStop(1,"#333"),e.fillStyle=t,e.beginPath(),e.ellipse(n.x,o+i/2,s/2,i/2,0,0,Math.PI*2),e.fill();break}case"TREE":e.fillStyle="#5D4037",e.fillRect(n.x-10,o+40,20,i-40),e.fillStyle="#2E7D32",e.beginPath(),e.arc(n.x,o+20,30,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(n.x-20,o+40,25,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(n.x+20,o+40,25,0,Math.PI*2),e.fill();break;case"POLE":e.fillStyle="#90A4AE",e.fillRect(n.x-5,o,10,i),e.fillStyle="#CFD8DC",e.fillRect(l-20,o,s+20,10),e.fillStyle="#FFEB3B",e.beginPath(),e.moveTo(l-10,o+10),e.lineTo(l+s+10,o+10),e.lineTo(n.x,o+i),e.fillStyle="rgba(255, 235, 59, 0.1)",e.fill();break;default:e.fillStyle="red",e.fillRect(l,o,s,i)}},ye=(e,n)=>{const l=n.x,o=n.y+n.height,s=n.variant,i=P[s];if(i){const u=Date.now(),t=u*.005+n.y*.05,r=Math.sin(t),a=Math.sin(u/200)*5;e.fillStyle="rgba(0,0,0,0.3)",e.beginPath();const f=n.width/2.2*Math.abs(r);e.ellipse(l,o,Math.max(5,f),4,0,0,Math.PI*2),e.fill(),e.save(),e.translate(l,n.y+a),e.scale(r,1),e.drawImage(i,-n.width/2,0,n.width,n.height),e.restore()}else e.fillStyle=s==="CAN_DIET"?"#C0C0C0":"#004B93",e.fillRect(n.x-15,n.y,30,50)},Le=(e,n)=>{const l=n.variant,o=Date.now(),s=n.width,i=n.height,u=n.x,t=n.y+i/2,r=n.x-s/2;let a=n.y;if(e.save(),l==="CONE"){const f=Math.abs(Math.sin(o*.008))*6;a-=f}else if(l==="BARREL"){const f=Math.sin(o*.005)*.15;e.translate(u,a+i),e.rotate(f),e.translate(-u,-(a+i))}else if(l==="BOX"){const f=1+Math.sin(o*.004)*.03;e.translate(u,t),e.scale(f,f),e.translate(-u,-t)}switch(l){case"CONE":e.fillStyle="#111",e.fillRect(r,a+i-5,s,5),e.fillStyle="#FF5722",e.beginPath(),e.moveTo(n.x,a),e.lineTo(r+5,a+i-5),e.lineTo(r+s-5,a+i-5),e.fill(),e.fillStyle="#FFF",e.fillRect(r+12,a+i/2,s-24,8);break;case"BARREL":{const f=e.createLinearGradient(r,a,r+s,a);f.addColorStop(0,"#5D4037"),f.addColorStop(.5,"#8D6E63"),f.addColorStop(1,"#3E2723"),e.fillStyle=f,e.fillRect(r,a,s,i),e.fillStyle="#222",e.fillRect(r,a+10,s,4),e.fillRect(r,a+i/2,s,4),e.fillRect(r,a+i-15,s,4),e.fillStyle="#4E342E",e.beginPath(),e.ellipse(n.x,a,s/2,4,0,0,Math.PI*2),e.fill(),e.fillStyle="rgba(0,0,0,0.4)",e.beginPath(),e.arc(u,t,6,0,Math.PI*2),e.fill(),e.fillRect(u-4,t+4,8,4);break}case"BOX":e.fillStyle="#8D6E63",e.fillRect(r,a,s,i),e.strokeStyle="#5D4037",e.lineWidth=3,e.strokeRect(r,a,s,i),e.beginPath(),e.moveTo(r,a),e.lineTo(r+s,a+i),e.moveTo(r+s,a),e.lineTo(r,a+i),e.stroke(),e.lineWidth=1,e.beginPath(),e.moveTo(r,a+i/3),e.lineTo(r+s,a+i/3),e.moveTo(r,a+2*i/3),e.lineTo(r+s,a+2*i/3),e.stroke();break}e.restore()},ve=(e,n)=>{n.forEach(l=>{const o=l.x,s=l.y+l.height;l.type==="COLLECTIBLE"?ye(e,l):(l.variant!=="HOLE"&&(e.fillStyle="rgba(0,0,0,0.3)",e.beginPath(),e.ellipse(o,s,l.width/2.2,6,0,0,Math.PI*2),e.fill()),["BOX","BARREL","CONE"].includes(l.variant)?Le(e,l):Ie(e,l))})},De=(e,n)=>{const{x:l,y:o}=n,i=b.CANVAS_HEIGHT-b.PLAYER_HEIGHT-30-o+b.PLAYER_HEIGHT;e.save(),e.translate(l,i);const u=8,t=(Math.random()-.5)*u,r=(Math.random()-.5)*u;e.translate(t,r),e.scale(1.5,.3),e.translate(0,-80);const a=b.PLAYER_WIDTH,f=b.PLAYER_HEIGHT;e.fillStyle="rgba(0,0,0,0.5)",e.beginPath(),e.ellipse(0,f,a/1.5,10,0,0,Math.PI*2),e.fill(),e.strokeStyle="#555",e.lineWidth=10,e.lineCap="round",e.beginPath(),e.moveTo(-10,f-30),e.lineTo(-25,f),e.stroke(),e.strokeStyle="#C0C0C0",e.beginPath(),e.moveTo(10,f-30),e.lineTo(25,f),e.stroke(),e.fillStyle="#004B93",e.beginPath(),e.moveTo(-25,10),e.lineTo(25,10),e.lineTo(15,f-30),e.lineTo(-15,f-30),e.fill(),e.beginPath(),e.arc(0,35,12,0,Math.PI*2),e.fillStyle="white",e.fill(),e.beginPath(),e.arc(0,35,10,Math.PI,0),e.fillStyle="#C9002B",e.fill(),e.beginPath(),e.arc(0,35,10,0,Math.PI),e.fillStyle="#004B93",e.fill(),e.strokeStyle="#C0C0C0",e.lineWidth=8,e.beginPath(),e.moveTo(-25,15),e.lineTo(-45,40),e.stroke(),e.beginPath(),e.moveTo(25,15),e.lineTo(45,40),e.stroke(),e.fillStyle="#C0C0C0",e.beginPath(),e.arc(0,0,16,0,Math.PI*2),e.fill(),e.strokeStyle="#111",e.lineWidth=2,e.beginPath(),e.moveTo(-5,-2),e.lineTo(5,2),e.moveTo(5,-2),e.lineTo(-5,2),e.stroke(),e.fillStyle="#FFD700";const h=Math.sin(Date.now()/100)*30;e.fillRect(h,-20,5,5),e.restore()},le=(e,n,l,o,s)=>{const i=e.createLinearGradient(n-o/2,l,n+o/2,l);return s==="silver"?(i.addColorStop(0,"#555555"),i.addColorStop(.2,"#CCCCCC"),i.addColorStop(.4,"#FFFFFF"),i.addColorStop(.6,"#AAAAAA"),i.addColorStop(1,"#666666")):s==="blue"?(i.addColorStop(0,"#002244"),i.addColorStop(.3,"#004B93"),i.addColorStop(.5,"#007FFF"),i.addColorStop(.8,"#004B93"),i.addColorStop(1,"#002244")):(i.addColorStop(0,"#8B0000"),i.addColorStop(.5,"#FF0000"),i.addColorStop(1,"#8B0000")),i},Ne=(e,n)=>{const{x:l,y:o,isSliding:s,isDashing:i,isHit:u,isJumping:t,isConfused:r,frame:a,state:f}=n;if(f==="CRASHED"){De(e,n);return}const h=b.CANVAS_HEIGHT-b.PLAYER_HEIGHT-30-o,T=b.PLAYER_WIDTH,c=s?b.PLAYER_HEIGHT/2:b.PLAYER_HEIGHT;if(u&&Math.floor(Date.now()/100)%2===0)return;e.save(),e.translate(l,h),r&&e.rotate(Math.sin(a*.2)*.2);const R=le(e,0,c/2,T,"silver"),d=le(e,0,c/2,T*.6,"blue"),p="#00FFFF";e.fillStyle="rgba(0,0,0,0.5)",e.beginPath();const S=o+c+8,C=Math.max(.4,1-o/120);if(e.ellipse(0,S,T/1.8*C,5*C,0,0,Math.PI*2),e.fill(),e.lineCap="round",e.lineJoin="round",s){e.fillStyle="rgba(255, 255, 255, 0.5)",e.beginPath(),e.moveTo(-T,c),e.lineTo(T,c),e.lineTo(0,-10),e.fill(),e.fillStyle=i?p:R,e.beginPath(),e.ellipse(0,c/2+10,T/1.6,c/2.8,0,0,Math.PI*2),e.fill(),e.fillStyle=d,e.beginPath(),e.ellipse(0,c/2+10,T/3,c/4,0,0,Math.PI*2),e.fill();const A=e.createRadialGradient(15,0,2,15,0,12);A.addColorStop(0,"#FFF"),A.addColorStop(1,"#888"),e.fillStyle=A,e.beginPath(),e.arc(25,5,12,0,Math.PI*2),e.fill()}else if(t){const A=R;e.lineWidth=16,e.strokeStyle="#444",e.beginPath(),e.moveTo(-10,c-30),e.lineTo(-25,c-10),e.stroke(),e.strokeStyle=A,e.beginPath(),e.moveTo(10,c-30),e.lineTo(25,c-10),e.stroke(),e.fillStyle=i?p:"#004B93",e.beginPath(),e.moveTo(-24,-10),e.lineTo(24,-10),e.lineTo(14,c-35),e.lineTo(-14,c-35),e.fill(),e.fillStyle="rgba(255,255,255,0.3)",e.fillRect(-5,-10,10,c-25),ne(e,0,15,11),e.lineWidth=13,e.strokeStyle=R,e.beginPath(),e.moveTo(22,0),e.lineTo(40,-25),e.stroke(),e.beginPath(),e.moveTo(-22,0),e.lineTo(-40,-25),e.stroke(),Y(e,0,-28)}else if(i){e.rotate(35*Math.PI/180);const A=Math.sin(a*.8)*30;e.lineWidth=14,e.strokeStyle="#333",e.beginPath(),e.moveTo(-5,c-30),e.lineTo(-35-A,c+15),e.stroke(),e.strokeStyle=R,e.beginPath(),e.moveTo(5,c-30),e.lineTo(35+A,c+15),e.stroke(),e.fillStyle=p,e.beginPath(),e.moveTo(-22,-5),e.lineTo(22,-5),e.lineTo(12,c-30),e.lineTo(-12,c-30),e.fill(),e.strokeStyle=R,e.lineWidth=12,e.beginPath(),e.moveTo(0,5),e.lineTo(-50,-5),e.stroke(),Y(e,10,-15)}else{const A=Math.abs(Math.sin(a*.35))*5;e.translate(0,-A);const L=Math.sin(a*.35)*25,I=Math.sin(a*.35)*25;e.lineWidth=15,e.lineCap="round",e.strokeStyle="#444",e.beginPath(),e.moveTo(0,c-40),e.quadraticCurveTo(-5,c-20,-L,c+5),e.stroke(),e.strokeStyle=R,e.beginPath(),e.moveTo(0,c-40),e.quadraticCurveTo(5,c-20,L,c+5),e.stroke();const v=e.createLinearGradient(-20,0,20,0);v.addColorStop(0,"#002244"),v.addColorStop(.5,"#004B93"),v.addColorStop(1,"#002244"),e.fillStyle=v,e.beginPath(),e.moveTo(-24,-8),e.lineTo(24,-8),e.lineTo(14,c-40),e.lineTo(-14,c-40),e.fill(),e.fillStyle="rgba(255,255,255,0.2)",e.fillRect(-6,-8,12,c-32),ne(e,0,15,12),e.lineWidth=13,e.strokeStyle="#555",e.beginPath(),e.moveTo(20,0),e.lineTo(30,35-I),e.stroke(),e.strokeStyle=R,e.beginPath(),e.moveTo(-20,0),e.lineTo(-30,35+I),e.stroke(),Y(e,0,-30)}e.restore()},Y=(e,n,l)=>{const o=e.createRadialGradient(n-5,l-5,2,n,l,18);o.addColorStop(0,"#FFFFFF"),o.addColorStop(.5,"#CCCCCC"),o.addColorStop(1,"#777777"),e.fillStyle=o,e.beginPath(),e.arc(n,l,16,0,Math.PI*2),e.fill(),e.fillStyle="#111",e.beginPath(),e.ellipse(n,l+4,8,2,0,0,Math.PI*2),e.fill()},ne=(e,n,l,o)=>{e.save(),e.beginPath(),e.arc(n,l,o,0,Math.PI*2),e.fillStyle="#FFF",e.fill(),e.beginPath(),e.arc(n,l,o-1,Math.PI,0),e.fillStyle="#C9002B",e.fill(),e.beginPath(),e.arc(n,l,o-1,0,Math.PI),e.fillStyle="#004B93",e.fill(),e.beginPath(),e.moveTo(n-o,l),e.quadraticCurveTo(n,l+o/2,n+o,l-o/3),e.lineTo(n+o,l+o/3),e.quadraticCurveTo(n,l+o,n-o,l+o/3),e.fillStyle="#FFF",e.fill(),e.restore()},ke=({score:e,highScore:n,lives:l,cans:o,level:s})=>E.jsxs(E.Fragment,{children:[E.jsxs("div",{className:"absolute top-4 left-4 text-white font-mono z-20 drop-shadow-md pointer-events-none",children:[E.jsxs("div",{className:"text-3xl font-black italic text-yellow-400 tracking-tighter",style:{textShadow:"2px 2px 0 #004B93"},children:["SCORE: ",e]}),E.jsxs("div",{className:"text-sm text-gray-400 font-bold",children:["HI: ",n]})]}),E.jsxs("div",{className:"absolute top-4 right-4 text-white font-mono z-20 text-right drop-shadow-md pointer-events-none",children:[E.jsx("div",{className:"text-2xl font-bold text-red-500 mb-1",children:"â¤ï¸".repeat(Math.max(0,l))}),E.jsxs("div",{className:"flex items-center justify-end gap-2 text-blue-300 font-bold",children:[E.jsx("span",{children:"CANS:"}),E.jsxs("span",{className:"text-xl text-white",children:[o,"/100"]})]}),E.jsxs("div",{className:"text-xs text-gray-500 font-bold mt-1",children:["SPEED LVL: ",s]})]})]}),Fe=({actions:e})=>{const n=m.useRef(0),l=m.useRef(0),o=m.useRef(!1),s=m.useRef(null),i=r=>{n.current=r.touches[0].clientX,l.current=r.touches[0].clientY,o.current=!1,s.current=setTimeout(()=>{o.current=!0,e.slide()},250)},u=r=>{if(o.current)return;const a=r.touches[0].clientX,f=r.touches[0].clientY;(Math.abs(a-n.current)>20||Math.abs(f-l.current)>20)&&s.current&&(clearTimeout(s.current),s.current=null)},t=r=>{if(s.current&&(clearTimeout(s.current),s.current=null),o.current)return;const a=r.changedTouches[0].clientX,f=r.changedTouches[0].clientY,h=n.current-a,T=l.current-f;if(Math.abs(h)>40||Math.abs(T)>40)Math.abs(h)>Math.abs(T)?h>0?e.moveLeft():e.moveRight():T>0?e.dash():e.slide();else{const c=window.innerWidth;n.current<c*.25?e.moveLeft():n.current>c*.75?e.moveRight():e.jump()}};return E.jsx("div",{className:"absolute inset-0 z-50 touch-none select-none",onTouchStart:i,onTouchMove:u,onTouchEnd:t})},Me=({score:e,onRestart:n,onExit:l})=>E.jsxs("div",{className:"absolute inset-0 z-30 bg-black/80 backdrop-blur-sm flex flex-col items-center justify-center text-white animate-in zoom-in duration-300",children:[E.jsx("h2",{className:"text-6xl font-black text-red-600 mb-2 italic tracking-tighter transform -rotate-3",style:{textShadow:"4px 4px 0 #000"},children:"CRASHED!"}),E.jsxs("p",{className:"text-2xl mb-8 font-mono text-yellow-400",children:["FINAL SCORE: ",e]}),E.jsxs("div",{className:"flex flex-col gap-4 w-64",children:[E.jsx("button",{onClick:n,className:"px-8 py-4 bg-blue-600 hover:bg-blue-500 text-white font-black rounded-xl shadow-[0_6px_0_rgb(0,40,100)] active:shadow-none active:translate-y-1 transition-all uppercase tracking-widest",children:"TRY AGAIN"}),E.jsx("button",{onClick:l,className:"px-8 py-4 bg-gray-700 hover:bg-gray-600 text-gray-300 font-bold rounded-xl shadow-[0_6px_0_rgb(30,30,30)] active:shadow-none active:translate-y-1 transition-all uppercase tracking-widest",children:"EXIT"})]})]}),we=({onExit:e})=>{const{status:n,startGame:l,player:o,entitiesRef:s,stats:i,actions:u}=Te(),t=m.useRef(null),r=m.useRef(0),[a,f]=m.useState(0),[h,T]=m.useState(!1);me(n,u),m.useEffect(()=>{const R=setInterval(()=>{f(d=>d>=100?(clearInterval(R),Ce(),T(!0),100):d+Math.floor(Math.random()*15)+5)},100);return()=>clearInterval(R)},[]);const c=m.useCallback(()=>{const R=A=>A>=10?"PEPSI_CITY":A>=7?"DESERT":A>=5?"METRO":A>=3?"CRISIS":"URBAN",d=t.current,p=R(i.level);if(!d)return;const S=d.getContext("2d");if(!S)return;if(n==="MENU"){ee(S,d.width,d.height,3),r.current=requestAnimationFrame(c);return}S.clearRect(0,0,d.width,d.height);const C=b.INITIAL_SPEED+i.level*.5;ee(S,d.width,d.height,C,p),ve(S,s.current),Ne(S,o),n==="PLAYING"&&(r.current=requestAnimationFrame(c))},[n,o,s,i.level]);return m.useEffect(()=>(r.current=requestAnimationFrame(c),()=>cancelAnimationFrame(r.current)),[c]),E.jsxs("div",{className:"fixed inset-0 z-[10000] bg-black flex items-center justify-center overflow-hidden font-sans select-none",children:[n==="PLAYING"&&E.jsxs(E.Fragment,{children:[E.jsx(ke,{score:i.score,highScore:i.highScore,lives:i.lives,cans:i.cans,level:i.level}),E.jsx(Fe,{actions:u})]}),E.jsx("canvas",{ref:t,width:b.CANVAS_WIDTH,height:b.CANVAS_HEIGHT,className:"bg-[#222] max-h-full max-w-full shadow-2xl border-x-8 border-blue-900",style:{imageRendering:"pixelated"}}),n==="MENU"&&E.jsxs("div",{className:"absolute inset-0 z-30 bg-black/60 backdrop-blur-sm flex flex-col items-center justify-center animate-in fade-in duration-500",children:[E.jsxs("div",{className:"relative mb-12 transform -rotate-3 hover:scale-105 transition-transform duration-500",children:[E.jsx("h1",{className:"text-7xl md:text-9xl font-black italic tracking-tighter text-white drop-shadow-[6px_6px_0_#004B93]",style:{WebkitTextStroke:"2px #C0C0C0"},children:"PEPSIMAN"}),E.jsx("div",{className:"absolute -bottom-2 right-4 bg-red-600 text-white text-xs md:text-sm font-bold px-3 py-1 transform rotate-3 shadow-lg border-2 border-white",children:"RUNNER"})]}),h?E.jsxs("div",{className:"flex flex-col gap-8 items-center animate-in slide-in-from-bottom-10 fade-in duration-500",children:[E.jsx("button",{onClick:l,className:"text-4xl md:text-6xl font-black text-yellow-400 tracking-widest uppercase hover:scale-110 transition-transform duration-100 filter drop-shadow-[0_0_15px_rgba(255,215,0,0.6)] animate-pulse",style:{textShadow:"4px 4px 0 #B71C1C"},children:"PRESS START"}),E.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white font-mono text-sm border-b border-transparent hover:border-white transition-all tracking-widest",children:"EXIT TO SYSTEM"}),E.jsxs("div",{className:"mt-8 text-[10px] text-gray-500 font-mono flex flex-col items-center gap-1",children:[E.jsx("p",{children:"INSERT COIN TO PLAY"}),E.jsx("p",{children:"Â© 1999 KIND OF PEPSI INC."})]})]}):E.jsxs("div",{className:"w-64 flex flex-col items-center gap-3",children:[E.jsx("div",{className:"text-blue-300 font-mono text-xs tracking-[0.3em] animate-pulse",children:"LOADING RESOURCES..."}),E.jsx("div",{className:"w-full h-6 bg-black border-2 border-white p-1 shadow-lg",children:E.jsx("div",{className:"h-full bg-gradient-to-r from-blue-600 via-blue-400 to-blue-600 bg-[length:20px_100%]",style:{width:`${a}%`}})})]})]}),n==="GAME_OVER"&&E.jsx(Me,{score:i.score,onRestart:l,onExit:e})]})},He=({onExit:e})=>E.jsx(m.Suspense,{fallback:E.jsx("div",{className:"fixed inset-0 z-[10000] bg-black flex items-center justify-center text-blue-500",children:"LOADING ASSETS..."}),children:E.jsx(we,{onExit:e})});export{He as GameLauncher};
