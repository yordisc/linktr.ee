import{r as c,j as T}from"./index-snNX0keb.js";const R={CANVAS_WIDTH:360,CANVAS_HEIGHT:640,LANE_COUNT:3,PLAYER_WIDTH:50,PLAYER_HEIGHT:80,PLAYER_HITBOX_PADDING:15,INITIAL_SPEED:8,DASH_MULTIPLIER:2.5,DIET_PEPSI_DURATION:240,STUN_DURATION:180,SPAWN_RATE_INITIAL:90,SPAWN_RATE_MIN:25,INITIAL_LIVES:3,CANS_FOR_LIFE:100},O=R.CANVAS_WIDTH/R.LANE_COUNT,v=O,G=[O*.5,O*1.5,O*2.5];let B=null;const Z=()=>{if(!B){const e=window.AudioContext||window.webkitAudioContext;if(!e)throw new Error("Tu navegador no soporta Web Audio API");B=new e}return B},x=e=>{const r=Z();r.state==="suspended"&&r.resume();const t=r.createOscillator(),i=r.createGain();t.connect(i),i.connect(r.destination);const s=r.currentTime;switch(e){case"JUMP":t.type="square",t.frequency.setValueAtTime(150,s),t.frequency.exponentialRampToValueAtTime(600,s+.2),i.gain.setValueAtTime(.1,s),i.gain.exponentialRampToValueAtTime(.01,s+.2),t.start(s),t.stop(s+.2);break;case"SLIDE":t.type="sine",t.frequency.setValueAtTime(400,s),t.frequency.exponentialRampToValueAtTime(100,s+.3),i.gain.setValueAtTime(.1,s),i.gain.linearRampToValueAtTime(0,s+.3),t.start(s),t.stop(s+.3);break;case"COLLECT":t.type="sine",t.frequency.setValueAtTime(1200,s),t.frequency.setValueAtTime(1600,s+.1),i.gain.setValueAtTime(.1,s),i.gain.exponentialRampToValueAtTime(.01,s+.2),t.start(s),t.stop(s+.2);break;case"POWERUP":t.type="triangle",t.frequency.setValueAtTime(440,s),t.frequency.setValueAtTime(554,s+.1),t.frequency.setValueAtTime(659,s+.2),i.gain.setValueAtTime(.1,s),i.gain.linearRampToValueAtTime(0,s+.4),t.start(s),t.stop(s+.4);break;case"CRASH":t.type="sawtooth",t.frequency.setValueAtTime(100,s),t.frequency.exponentialRampToValueAtTime(10,s+.3),i.gain.setValueAtTime(.2,s),i.gain.exponentialRampToValueAtTime(.01,s+.3),t.start(s),t.stop(s+.3);break}},J=()=>({play:c.useCallback(r=>{try{x(r)}catch(t){console.warn("Audio error:",t)}},[])}),ee=()=>{const{play:e}=J(),r=180,t=120,i=.6,s=15,l=.25,a=c.useRef({lane:1,x:r,y:0,state:"RUNNING",isJumping:!1,jumpVelocity:0,isSliding:!1,slideTimer:0,isDashing:!1,dashTimer:0,isHit:!1,hitTimer:0,isConfused:!1,confusionTimer:0,frame:0,cooldowns:{slide:0,dash:0}}),h=c.useCallback(()=>{const n=a.current;if(n.isHit)return;const g=n.isConfused?1:-1,u=n.lane+g;u>=0&&u<=2&&(n.lane=u,console.log("â¬…ï¸ MOVER IZQ: Nueva Lane =",n.lane))},[]),o=c.useCallback(()=>{const n=a.current;if(n.isHit)return;const g=n.isConfused?-1:1,u=n.lane+g;u>=0&&u<=2&&(n.lane=u,console.log("âž¡ï¸ MOVER DER: Nueva Lane =",n.lane))},[]),f=c.useCallback(()=>{const n=a.current;n.isHit||!n.isJumping&&!n.isSliding&&(console.log("ðŸ¦˜ SALTO INICIADO"),n.isJumping=!0,n.jumpVelocity=s,n.state="RUNNING",e("JUMP"))},[e]),d=c.useCallback(()=>{const n=a.current;n.isHit||!n.isJumping&&!n.isSliding&&n.cooldowns.slide<=0&&(console.log("â¬‡ï¸ SLIDE INICIADO"),n.isSliding=!0,n.slideTimer=60,n.cooldowns.slide=120,n.state="RUNNING",e("SLIDE"))},[e]),b=c.useCallback(()=>{const n=a.current;n.isHit||!n.isDashing&&n.cooldowns.dash<=0&&(console.log("ðŸ”¥ DASH INICIADO"),n.isDashing=!0,n.dashTimer=60,n.cooldowns.dash=240,n.isJumping=!1,n.y=0,n.isSliding=!1,n.state="RUNNING",e("POWERUP"))},[e]),S=c.useCallback(()=>{const n=a.current;n.frame++,n.frame%60;const g=n.lane*t+t/2;n.x+=(g-n.x)*l,n.isJumping&&(n.y+=n.jumpVelocity,n.jumpVelocity-=i,n.y<=0&&(n.y=0,n.isJumping=!1,n.jumpVelocity=0,!n.isSliding&&!n.isDashing&&(n.state="RUNNING"))),n.isSliding&&(n.slideTimer--,n.slideTimer<=0&&(console.log("â¬†ï¸ Slide Terminado"),n.isSliding=!1,n.state="RUNNING")),n.isDashing&&(n.dashTimer--,n.dashTimer<=0&&(console.log("â„ï¸ Dash Terminado"),n.isDashing=!1,n.state="RUNNING")),n.isHit&&(n.hitTimer--,n.hitTimer<=0&&(n.isHit=!1,n.state="RUNNING")),n.isConfused&&(n.confusionTimer--,n.confusionTimer<=0&&(n.isConfused=!1)),n.cooldowns.slide>0&&n.cooldowns.slide--,n.cooldowns.dash>0&&n.cooldowns.dash--},[]);return{playerRef:a,updatePlayer:S,actions:{moveLeft:h,moveRight:o,jump:f,slide:d,dash:b}}},te=()=>{const e=c.useRef([]),r=c.useRef(0),t=c.useRef(0),i=c.useCallback(()=>{e.current=[],r.current=0,t.current=0},[]),s=()=>{const a=Math.floor(Math.random()*3),h=`ent-${t.current++}`,o=Math.random()>.35;let f,d,b=50,S=50,n=G[a],g=0,u=!1;if(o){f="OBSTACLE";const m=Math.random();if(m<.2)d="CONE";else if(m<.4)d="BARRIER",b=70;else if(m<.55){d="TREE",b=v*1.8,S=80;const E=a===2?-v/2:v/2;n+=E}else if(m<.7)d="TRUCK_H",b=v*2.5,S=90,n=G[1];else if(m<.85){d="CAR",g=8,u=!0,S=90,b=45;const E=Math.random()>.5?0:2;n=G[E]}else d="HOLE",b=60}else f="COLLECTIBLE",d=Math.random()>.9?"CAN_DIET":"CAN_NORMAL",b=35,S=55;const p={id:h,type:f,variant:d,lane:a,x:n,y:-200,width:b,height:S,speedY:g,warning:u,warningTimer:u?60:0};e.current.push(p)},l=c.useCallback((a,h)=>{r.current++;const o=Math.max(R.SPAWN_RATE_MIN,R.SPAWN_RATE_INITIAL-h*5);r.current>=o&&(s(),r.current=0),e.current=e.current.filter(f=>f.warning&&f.warningTimer&&f.warningTimer>0?(f.warningTimer--,!0):(f.y+=a+(f.speedY||0),f.y<R.CANVAS_HEIGHT+100))},[]);return{entitiesRef:e,updateEntities:l,resetSpawner:i}},ne=()=>{const[e,r]=c.useState(0),[t,i]=c.useState(0),[s,l]=c.useState(R.INITIAL_LIVES),[a,h]=c.useState(0),[o,f]=c.useState(1),d=c.useRef(0),b=c.useRef(0);c.useEffect(()=>{const p=localStorage.getItem("pepsiman_highscore");p&&i(parseInt(p,10))},[]);const S=c.useCallback(()=>{r(0),l(R.INITIAL_LIVES),h(0),f(1),d.current=0,b.current=0},[]),n=c.useCallback(p=>{b.current+=p*.1;const m=Math.floor(b.current);if(m>d.current){d.current=m,r(m);const E=Math.floor(m/1e3)+1;E!==o&&f(E)}},[o]),g=c.useCallback(p=>{const m=p==="CAN_DIET"?50:10;d.current+=m,r(E=>E+m),p==="CAN_NORMAL"&&h(E=>{const I=E+1;return I>=R.CANS_FOR_LIFE?(l(N=>N+1),0):I})},[]),u=c.useCallback((p=1)=>{let m=!1;return l(E=>{const I=E-p;return I<=0?(m=!0,d.current>t&&(i(d.current),localStorage.setItem("pepsiman_highscore",d.current.toString())),0):I}),m},[t]);return{score:e,highScore:t,lives:s,cans:a,level:o,resetScore:S,updateDistance:n,collectCan:g,takeDamage:u}},se=()=>({checkCollision:c.useCallback((r,t)=>{const i=R.CANVAS_HEIGHT-R.PLAYER_HEIGHT-20,s=r.x-R.PLAYER_WIDTH/2+R.PLAYER_HITBOX_PADDING,l=r.x+R.PLAYER_WIDTH/2-R.PLAYER_HITBOX_PADDING,a=i+R.PLAYER_HITBOX_PADDING,h=i+R.PLAYER_HEIGHT-R.PLAYER_HITBOX_PADDING,o=t.x-t.width/2,f=t.x+t.width/2,d=t.y,b=t.y+t.height,S=s<f&&l>o,n=a<b&&h>d;return!S||!n||["HOLE","CAR","MOTO","BOX","WORKER","BARREL","CONE"].includes(t.variant)&&r.isJumping&&r.y>30||(t.variant==="TRUCK_H"||t.variant==="POLE")&&r.isSliding?!1:(["BOX","BARREL","CONE"].includes(t.variant)&&(r.isDashing||r.isSliding&&(t.variant==="BARREL"||t.variant==="BOX")),!0)},[])}),re=e=>{const{checkCollision:r}=se(),{playerRef:t,entitiesRef:i,dietTimerRef:s,stunTimerRef:l,speedRef:a,setStatus:h,play:o,collectCan:f,takeDamage:d}=e;return{resolveCollisions:c.useCallback(()=>{const S=t.current;for(let n=i.current.length-1;n>=0;n--){const g=i.current[n];if(r(S,g)){if(g.type==="COLLECTIBLE"){const u=g.variant;f(u),u==="CAN_DIET"?(o("POWERUP"),s.current=R.DIET_PEPSI_DURATION):o("COLLECT"),i.current.splice(n,1)}else if(!S.isHit){const u=["BOX","BARREL","CONE"].includes(g.variant);if((S.isDashing||S.isSliding&&["BOX","BARREL"].includes(g.variant))&&u)o("CRASH"),i.current.splice(n,1);else{o("CRASH");const m=R.STUN_DURATION;S.isHit=!0,S.hitTimer=m,S.state="CRASHED",l.current=m,g.variant==="BARREL"&&(S.isConfused=!0,S.confusionTimer=300);const E=["TRUCK_V","TRUCK_H","HOLE"].includes(g.variant)?999:1;if(d(E))return h("GAME_OVER"),!0;a.current=Math.max(R.INITIAL_SPEED,a.current-2)}}}}return!1},[r,f,d,i,t,o,h,s,l,a])}},Y=1e3/60,ie=()=>{const{playerRef:e,updatePlayer:r,actions:t}=ee(),{moveLeft:i,moveRight:s,jump:l,slide:a,dash:h}=t,{entitiesRef:o,updateEntities:f,resetSpawner:d}=te(),{play:b}=J(),{score:S,highScore:n,lives:g,cans:u,level:p,resetScore:m,updateDistance:E,collectCan:I,takeDamage:N}=ne(),[y,M]=c.useState("MENU"),P=c.useRef(0),w=c.useRef(0),H=c.useRef(R.INITIAL_SPEED),F=c.useRef(0),k=c.useRef(0),K=c.useMemo(()=>({moveLeft:i,moveRight:s,jump:l,slide:a,dash:h}),[i,s,l,a,h]),{resolveCollisions:V}=re({playerRef:e,entitiesRef:o,dietTimerRef:F,stunTimerRef:k,speedRef:H,setStatus:M,play:b,collectCan:I,takeDamage:N}),D=c.useCallback(A=>{if(y!=="PLAYING")return;w.current||(w.current=A);const U=A-w.current;if(U>Y){w.current=A-U%Y;let L=H.current+p*.5;if(k.current>0?(L=0,k.current--,k.current<=0&&e.current.state==="CRASHED"&&(e.current.state="RUNNING",e.current.isHit=!1)):(e.current.isDashing&&(L*=R.DASH_MULTIPLIER),F.current>0&&(L+=5,F.current--)),r(),L>0&&(f(L,p),E(L)),V())return}P.current=requestAnimationFrame(D)},[y,p,r,f,E,V,e]),$=c.useCallback(()=>{console.log("ðŸ INICIANDO NUEVA PARTIDA"),m(),d(),H.current=R.INITIAL_SPEED,F.current=0,k.current=0;const A=e.current;A.lane=1,A.x=180,A.y=0,A.state="RUNNING",A.isHit=!1,A.isJumping=!1,A.isSliding=!1,A.isDashing=!1,A.isConfused=!1,A.slideTimer=0,A.dashTimer=0,A.hitTimer=0,A.confusionTimer=0,M("PLAYING"),w.current=0,P.current&&cancelAnimationFrame(P.current),P.current=requestAnimationFrame(D)},[D,m,d,e]),Q=c.useCallback(()=>{y==="PLAYING"?M("PAUSED"):y==="PAUSED"&&(M("PLAYING"),w.current=0,P.current=requestAnimationFrame(D))},[y,D]);return c.useEffect(()=>()=>{P.current&&cancelAnimationFrame(P.current)},[]),{status:y,startGame:$,pauseGame:Q,player:e.current,entitiesRef:o,stats:{score:S,highScore:n,lives:g,cans:u,level:p},actions:K}},le=(e,r)=>{const t=c.useRef(0),i=c.useRef(!1),s=c.useRef(null);c.useEffect(()=>{const l=h=>{if(e==="PLAYING")switch(h.key){case"ArrowLeft":case"a":r.moveLeft();break;case"ArrowRight":case"d":r.moveRight();break;case"ArrowUp":case"w":r.dash();break;case"ArrowDown":case"s":r.slide();break;case" ":case"Shift":!h.repeat&&t.current===0&&(h.preventDefault(),t.current=Date.now(),i.current=!1,s.current=setTimeout(()=>{t.current!==0&&(i.current=!0,r.slide())},250));break}},a=h=>{if(h.key===" "||h.key==="Shift"){s.current&&(clearTimeout(s.current),s.current=null);const o=Date.now()-t.current;t.current=0,o<250&&!i.current&&r.jump(),i.current=!1}};return window.addEventListener("keydown",l),window.addEventListener("keyup",a),()=>{window.removeEventListener("keydown",l),window.removeEventListener("keyup",a),s.current&&clearTimeout(s.current)}},[e,r])},C={},_={PEPSI_BLUE:"#004B93",PEPSI_RED:"#C9002B",SILVER:"#E0E0E0",ASPHALT:"#2D2D2D"},j=(e,r)=>{const t=document.createElement("canvas");return t.width=e,t.height=r,{canvas:t,ctx:t.getContext("2d")}},W=e=>{const{canvas:i,ctx:s}=j(30,50),l=e==="diet"?_.SILVER:_.PEPSI_BLUE,a=s.createLinearGradient(0,0,30,0);a.addColorStop(0,"rgba(0,0,0,0.3)"),a.addColorStop(.2,l),a.addColorStop(.5,e==="diet"?"#FFFFFF":"#0072CE"),a.addColorStop(.8,l),a.addColorStop(1,"rgba(0,0,0,0.3)"),s.fillStyle=a,s.fillRect(0,0,30,50),s.fillStyle="#999",s.fillRect(0,0,30,3),s.fillRect(0,47,30,3);const h=30/2,o=50/2,f=8;return s.beginPath(),s.arc(h,o,f,0,Math.PI*2),s.fillStyle="#FFF",s.fill(),s.beginPath(),s.arc(h,o,f-2,0,Math.PI*2),s.fillStyle=_.PEPSI_RED,s.fill(),s.beginPath(),s.arc(h,o,f-2,0,Math.PI,!1),s.fillStyle=_.PEPSI_BLUE,s.fill(),i},ae=()=>{const{canvas:r,ctx:t}=j(200,200);t.fillStyle=_.ASPHALT,t.fillRect(0,0,200,200);for(let i=0;i<400;i++){const s=Math.random()*200,l=Math.random()*200,a=Math.random()*2;t.fillStyle=Math.random()>.5?"#383838":"#222",t.fillRect(s,l,a,a)}return r},oe=()=>{const{canvas:r,ctx:t}=j(50,50);return t.fillStyle="#FBC02D",t.fillRect(0,0,50,50),t.fillStyle="#000",t.beginPath(),t.moveTo(0,50),t.lineTo(50,0),t.lineTo(50,10),t.lineTo(10,50),t.fill(),t.beginPath(),t.moveTo(0,10),t.lineTo(10,0),t.lineTo(0,0),t.fill(),r},ce=()=>{C.CAN_NORMAL||(console.log("ðŸŽ¨ Generando texturas en memoria..."),C.CAN_NORMAL=W("normal"),C.CAN_DIET=W("diet"),C.ASPHALT=ae(),C.STRIPES=oe())},z={URBAN:{ground:"#4CAF50",roadTint:"rgba(0, 0, 0, 0)",curbA:"#D32F2F",curbB:"#EEEEEE",line:"#FFFFFF",shadow:"rgba(0,0,0,0.3)"},CRISIS:{ground:"#3E2723",roadTint:"rgba(62, 39, 35, 0.4)",curbA:"#B71C1C",curbB:"#212121",line:"#FF5252",shadow:"rgba(183, 28, 28, 0.2)"},METRO:{ground:"#212121",roadTint:"rgba(0, 0, 0, 0.5)",curbA:"#FFEB3B",curbB:"#000000",line:"#607D8B",shadow:"rgba(0,0,0,0.8)"},DESERT:{ground:"#FF9800",roadTint:"rgba(121, 85, 72, 0.3)",curbA:"#E65100",curbB:"#FFE0B2",line:"#FFF3E0",shadow:"rgba(62, 39, 35, 0.3)"},PEPSI_CITY:{ground:"#004B93",roadTint:"rgba(0, 75, 147, 0.4)",curbA:"#FFFFFF",curbB:"#C9002B",line:"#00FFFF",shadow:"rgba(0, 255, 255, 0.2)"}},X=(e,r,t,i,s="URBAN")=>{const l=Date.now(),a=z[s]||z.URBAN,h=l*i*.1;e.fillStyle=a.ground,e.fillRect(0,0,r,t);const o=15,f=r-o*2;if(C.ASPHALT){const u=e.createPattern(C.ASPHALT,"repeat");if(u){const p=new DOMMatrix;p.translateSelf(0,h%256),u.setTransform(p),e.fillStyle=u,e.fillRect(o,0,f,t)}}else e.fillStyle="#2d2d2d",e.fillRect(o,0,f,t);a.roadTint!=="rgba(0, 0, 0, 0)"&&(e.fillStyle=a.roadTint,e.fillRect(o,0,f,t));const d=60,b=15,S=h%(d*2);for(let u=-d*2;u<t+d;u+=d){const p=Math.floor((u+S)/d)%2===0;e.fillStyle=p?a.curbA:a.curbB,e.fillRect(0,u+S,b,d),e.fillRect(r-b,u+S,b,d)}e.lineWidth=4,e.strokeStyle=a.line,e.setLineDash([50,50]),e.lineDashOffset=-h,[v,v*2].forEach(u=>{e.beginPath(),e.moveTo(u,0),e.lineTo(u,t),e.stroke()}),e.setLineDash([]);const n=e.createLinearGradient(o,0,o+20,0);n.addColorStop(0,a.shadow),n.addColorStop(1,"rgba(0,0,0,0)"),e.fillStyle=n,e.fillRect(o,0,20,t);const g=e.createLinearGradient(r-o-20,0,r-o,0);if(g.addColorStop(0,"rgba(0,0,0,0)"),g.addColorStop(1,a.shadow),e.fillStyle=g,e.fillRect(r-o-20,0,20,t),i>12){e.fillStyle="rgba(255, 255, 255, 0.1)";const u=Date.now()*2%t;e.fillRect(5,u,2,100),e.fillRect(r-7,(u+200)%t,2,150)}},ue=(e,r)=>{r.forEach(t=>{const i=t.x,s=t.y+t.height;if(e.fillStyle="rgba(0,0,0,0.3)",e.beginPath(),e.ellipse(i,s,t.width/2.2,6,0,0,Math.PI*2),e.fill(),t.type==="COLLECTIBLE"){const l=t.variant,a=C[l];if(a){const h=Math.sin(Date.now()/200)*5,o=1+Math.sin(Date.now()/150)*.05,f=t.width*o,d=t.height*o;e.drawImage(a,i-f/2,t.y+h,f,d)}else e.fillStyle="blue",e.fillRect(t.x-15,t.y,30,50)}else fe(e,t)})},fe=(e,r)=>{const t=r.x-r.width/2,i=r.y,s=r.width,l=r.height;switch(r.variant){case"BARRIER":if(C.STRIPES){const h=e.createPattern(C.STRIPES,"repeat");h&&(e.fillStyle=h,e.fillRect(t,i,s,20),e.strokeStyle="#000",e.lineWidth=2,e.strokeRect(t,i,s,20))}else e.fillStyle="#FFC107",e.fillRect(t,i,s,20);e.fillStyle="#333",e.fillRect(t+5,i+20,10,l-20),e.fillRect(t+s-15,i+20,10,l-20);break;case"CONE":e.fillStyle="#FF5722",e.beginPath(),e.moveTo(r.x,i),e.lineTo(t,i+l),e.lineTo(t+s,i+l),e.fill(),e.fillStyle="#333",e.fillRect(t-5,i+l-5,s+10,5);break;case"TRUCK_H":case"TRUCK_V":e.fillStyle="#D32F2F",e.fillRect(t,i,s,l),e.fillStyle="#B71C1C",e.fillRect(t,i+l-10,s,10),e.fillStyle="white",e.beginPath(),e.ellipse(r.x,i+l/2,s/3,10,.2,0,Math.PI*2),e.fill();break;case"HOLE":e.fillStyle="#000",e.beginPath(),e.ellipse(r.x,i+l/2,s/2,l/2,0,0,Math.PI*2),e.fill(),e.strokeStyle="#333",e.lineWidth=2,e.stroke();break;case"CAR":e.fillStyle="#3F51B5",e.fillRect(t,i,s,l),e.fillStyle="#81D4FA",e.fillRect(t+2,i+2,s-4,15),e.fillStyle="red",e.fillRect(t+2,i+l-5,10,5),e.fillRect(t+s-12,i+l-5,10,5),r.warning&&r.y<0&&(e.fillStyle="red",e.font="bold 40px Arial",e.textAlign="center",e.fillText("!",r.x,100),e.strokeStyle="yellow",e.lineWidth=2,e.strokeText("!",r.x,100));break;default:e.fillStyle="#795548",e.fillRect(t,i,s,l),e.strokeStyle="#3E2723",e.lineWidth=3,e.strokeRect(t,i,s,l),e.beginPath(),e.moveTo(t,i),e.lineTo(t+s,i+l),e.moveTo(t+s,i),e.lineTo(t,i+l),e.stroke()}},q=(e,r,t,i,s)=>{const l=e.createLinearGradient(r-i/2,t,r+i/2,t);return s==="silver"?(l.addColorStop(0,"#999999"),l.addColorStop(.5,"#FFFFFF"),l.addColorStop(1,"#999999")):(l.addColorStop(0,"#003366"),l.addColorStop(.5,"#0066CC"),l.addColorStop(1,"#003366")),l},de=(e,r)=>{const{x:t,y:i,isSliding:s,isDashing:l,isHit:a,isJumping:h,isConfused:o,frame:f,state:d}=r,b=R.CANVAS_HEIGHT-R.PLAYER_HEIGHT-30-i,S=R.PLAYER_WIDTH,n=s?R.PLAYER_HEIGHT/2:R.PLAYER_HEIGHT;if(a&&Math.floor(Date.now()/100)%2===0)return;e.save(),e.translate(t,b),o&&e.rotate(Math.sin(f*.2)*.2),d==="CRASHED"&&(e.translate(0,n),e.scale(1.4,.1),e.translate(0,-n),e.translate(Math.random()*10-5,0));const g=q(e,0,n/2,S,"silver"),u=q(e,0,n/2,S*.6,"blue"),p="#00FFFF";if(d!=="CRASHED"){e.fillStyle="rgba(0,0,0,0.4)",e.beginPath();const m=i+n+10,E=Math.max(.3,1-i/150);e.ellipse(0,m,S/2*E,6*E,0,0,Math.PI*2),e.fill()}if(e.lineCap="round",e.lineJoin="round",s)e.fillStyle="rgba(255, 255, 255, 0.3)",e.beginPath(),e.moveTo(-S/1.5,n),e.lineTo(S/1.5,n),e.lineTo(0,0),e.fill(),e.fillStyle=l?p:g,e.beginPath(),e.ellipse(0,n/2+10,S/1.8,n/2.5,0,0,Math.PI*2),e.fill(),e.fillStyle=u,e.beginPath(),e.ellipse(0,n/2+10,S/3,n/4,0,0,Math.PI*2),e.fill(),e.fillStyle="#C0C0C0",e.beginPath(),e.arc(20,0,12,0,Math.PI*2),e.fill();else if(h){e.lineWidth=14,e.strokeStyle=g,e.beginPath(),e.moveTo(-10,n-35),e.lineTo(-20,n-15),e.stroke(),e.beginPath(),e.moveTo(10,n-35),e.lineTo(20,n-15),e.stroke(),e.fillStyle=l?p:"#0057B8",e.beginPath(),e.moveTo(-22,-5),e.lineTo(22,-5),e.lineTo(12,n-35),e.lineTo(-12,n-35),e.fill(),e.beginPath(),e.arc(0,20,9,0,Math.PI*2),e.fillStyle="white",e.fill(),e.beginPath(),e.arc(0,20,8,Math.PI,0),e.fillStyle="#C9002B",e.fill(),e.beginPath(),e.arc(0,20,8,0,Math.PI),e.fillStyle="#004B93",e.fill(),e.strokeStyle=g,e.lineWidth=12,e.beginPath(),e.moveTo(18,5),e.lineTo(35,-15),e.stroke(),e.beginPath(),e.moveTo(-18,5),e.lineTo(-35,-15),e.stroke();const m=e.createRadialGradient(-5,-25,2,0,-25,15);m.addColorStop(0,"#FFF"),m.addColorStop(1,"#999"),e.fillStyle=m,e.beginPath(),e.arc(0,-25,16,0,Math.PI*2),e.fill()}else if(l){e.rotate(30*Math.PI/180);const m=Math.sin(f*.9)*25;e.lineWidth=12,e.strokeStyle="#555",e.beginPath(),e.moveTo(-5,n-30),e.lineTo(-25-m,n+10),e.stroke(),e.strokeStyle=g,e.beginPath(),e.moveTo(5,n-30),e.lineTo(25+m,n+10),e.stroke(),e.fillStyle=p,e.beginPath(),e.moveTo(-20,0),e.lineTo(20,0),e.lineTo(10,n-25),e.lineTo(-10,n-25),e.fill(),e.strokeStyle=g,e.lineWidth=10,e.beginPath(),e.moveTo(0,10),e.lineTo(-50,0),e.stroke(),e.fillStyle="#FFF",e.beginPath(),e.arc(10,-10,14,0,Math.PI*2),e.fill()}else{const m=Math.abs(Math.sin(f*.4))*6;e.translate(0,-m);const E=Math.sin(f*.4)*22,I=Math.sin(f*.4)*22;e.lineWidth=14,e.strokeStyle="#555",e.beginPath(),e.moveTo(0,n-35),e.lineTo(-E,n+m),e.stroke(),e.strokeStyle=g,e.beginPath(),e.moveTo(0,n-35),e.lineTo(E,n+m),e.stroke(),e.fillStyle="#0057B8",e.beginPath(),e.moveTo(-22,-5),e.lineTo(22,-5),e.lineTo(12,n-35),e.lineTo(-12,n-35),e.fill(),e.beginPath(),e.arc(0,20,9,0,Math.PI*2),e.fillStyle="white",e.fill(),e.beginPath(),e.arc(0,20,8,Math.PI,0),e.fillStyle="#C9002B",e.fill(),e.beginPath(),e.arc(0,20,8,0,Math.PI),e.fillStyle="#004B93",e.fill(),e.lineWidth=12,e.strokeStyle="#777",e.beginPath(),e.moveTo(18,5),e.lineTo(28,35-I),e.stroke(),e.strokeStyle=g,e.beginPath(),e.moveTo(-18,5),e.lineTo(-28,35+I),e.stroke();const N=e.createRadialGradient(-5,-25,2,0,-25,15);N.addColorStop(0,"#FFF"),N.addColorStop(1,"#999"),e.fillStyle=N,e.beginPath(),e.arc(0,-25,16,0,Math.PI*2),e.fill(),e.fillStyle="#111",e.beginPath(),e.ellipse(0,-22,6,2,0,0,Math.PI*2),e.fill()}e.restore()},he=({score:e,highScore:r,lives:t,cans:i,level:s})=>T.jsxs(T.Fragment,{children:[T.jsxs("div",{className:"absolute top-4 left-4 text-white font-mono z-20 drop-shadow-md pointer-events-none",children:[T.jsxs("div",{className:"text-3xl font-black italic text-yellow-400 tracking-tighter",style:{textShadow:"2px 2px 0 #004B93"},children:["SCORE: ",e]}),T.jsxs("div",{className:"text-sm text-gray-400 font-bold",children:["HI: ",r]})]}),T.jsxs("div",{className:"absolute top-4 right-4 text-white font-mono z-20 text-right drop-shadow-md pointer-events-none",children:[T.jsx("div",{className:"text-2xl font-bold text-red-500 mb-1",children:"â¤ï¸".repeat(Math.max(0,t))}),T.jsxs("div",{className:"flex items-center justify-end gap-2 text-blue-300 font-bold",children:[T.jsx("span",{children:"CANS:"}),T.jsxs("span",{className:"text-xl text-white",children:[i,"/100"]})]}),T.jsxs("div",{className:"text-xs text-gray-500 font-bold mt-1",children:["SPEED LVL: ",s]})]})]}),me=({actions:e})=>{const r=c.useRef(0),t=c.useRef(0),i=c.useRef(!1),s=c.useRef(null),l=o=>{r.current=o.touches[0].clientX,t.current=o.touches[0].clientY,i.current=!1,s.current=setTimeout(()=>{i.current=!0,e.slide()},250)},a=o=>{if(i.current)return;const f=o.touches[0].clientX,d=o.touches[0].clientY;(Math.abs(f-r.current)>20||Math.abs(d-t.current)>20)&&s.current&&(clearTimeout(s.current),s.current=null)},h=o=>{if(s.current&&(clearTimeout(s.current),s.current=null),i.current)return;const f=o.changedTouches[0].clientX,d=o.changedTouches[0].clientY,b=r.current-f,S=t.current-d;if(Math.abs(b)>40||Math.abs(S)>40)Math.abs(b)>Math.abs(S)?b>0?e.moveLeft():e.moveRight():S>0?e.dash():e.slide();else{const n=window.innerWidth;r.current<n*.25?e.moveLeft():r.current>n*.75?e.moveRight():e.jump()}};return T.jsx("div",{className:"absolute inset-0 z-50 touch-none select-none",onTouchStart:l,onTouchMove:a,onTouchEnd:h})},Te=({score:e,onRestart:r,onExit:t})=>T.jsxs("div",{className:"absolute inset-0 z-30 bg-black/80 backdrop-blur-sm flex flex-col items-center justify-center text-white animate-in zoom-in duration-300",children:[T.jsx("h2",{className:"text-6xl font-black text-red-600 mb-2 italic tracking-tighter transform -rotate-3",style:{textShadow:"4px 4px 0 #000"},children:"CRASHED!"}),T.jsxs("p",{className:"text-2xl mb-8 font-mono text-yellow-400",children:["FINAL SCORE: ",e]}),T.jsxs("div",{className:"flex flex-col gap-4 w-64",children:[T.jsx("button",{onClick:r,className:"px-8 py-4 bg-blue-600 hover:bg-blue-500 text-white font-black rounded-xl shadow-[0_6px_0_rgb(0,40,100)] active:shadow-none active:translate-y-1 transition-all uppercase tracking-widest",children:"TRY AGAIN"}),T.jsx("button",{onClick:t,className:"px-8 py-4 bg-gray-700 hover:bg-gray-600 text-gray-300 font-bold rounded-xl shadow-[0_6px_0_rgb(30,30,30)] active:shadow-none active:translate-y-1 transition-all uppercase tracking-widest",children:"EXIT"})]})]}),Se=({onExit:e})=>{const{status:r,startGame:t,player:i,entitiesRef:s,stats:l,actions:a}=ie(),h=c.useRef(null),o=c.useRef(0),[f,d]=c.useState(0),[b,S]=c.useState(!1);le(r,a),c.useEffect(()=>{const g=setInterval(()=>{d(u=>u>=100?(clearInterval(g),ce(),S(!0),100):u+Math.floor(Math.random()*15)+5)},100);return()=>clearInterval(g)},[]);const n=c.useCallback(()=>{const g=I=>I>=10?"PEPSI_CITY":I>=7?"DESERT":I>=5?"METRO":I>=3?"CRISIS":"URBAN",u=h.current,p=g(l.level);if(!u)return;const m=u.getContext("2d");if(!m)return;if(r==="MENU"){X(m,u.width,u.height,3),o.current=requestAnimationFrame(n);return}m.clearRect(0,0,u.width,u.height);const E=R.INITIAL_SPEED+l.level*.5;X(m,u.width,u.height,E,p),ue(m,s.current),de(m,i),r==="PLAYING"&&(o.current=requestAnimationFrame(n))},[r,i,s,l.level]);return c.useEffect(()=>(o.current=requestAnimationFrame(n),()=>cancelAnimationFrame(o.current)),[n]),T.jsxs("div",{className:"fixed inset-0 z-[10000] bg-black flex items-center justify-center overflow-hidden font-sans select-none",children:[r==="PLAYING"&&T.jsxs(T.Fragment,{children:[T.jsx(he,{score:l.score,highScore:l.highScore,lives:l.lives,cans:l.cans,level:l.level}),T.jsx(me,{actions:a})]}),T.jsx("canvas",{ref:h,width:R.CANVAS_WIDTH,height:R.CANVAS_HEIGHT,className:"bg-[#222] max-h-full max-w-full shadow-2xl border-x-8 border-blue-900",style:{imageRendering:"pixelated"}}),r==="MENU"&&T.jsxs("div",{className:"absolute inset-0 z-30 bg-black/60 backdrop-blur-sm flex flex-col items-center justify-center animate-in fade-in duration-500",children:[T.jsxs("div",{className:"relative mb-12 transform -rotate-3 hover:scale-105 transition-transform duration-500",children:[T.jsx("h1",{className:"text-7xl md:text-9xl font-black italic tracking-tighter text-white drop-shadow-[6px_6px_0_#004B93]",style:{WebkitTextStroke:"2px #C0C0C0"},children:"PEPSIMAN"}),T.jsx("div",{className:"absolute -bottom-2 right-4 bg-red-600 text-white text-xs md:text-sm font-bold px-3 py-1 transform rotate-3 shadow-lg border-2 border-white",children:"RUNNER"})]}),b?T.jsxs("div",{className:"flex flex-col gap-8 items-center animate-in slide-in-from-bottom-10 fade-in duration-500",children:[T.jsx("button",{onClick:t,className:"text-4xl md:text-6xl font-black text-yellow-400 tracking-widest uppercase hover:scale-110 transition-transform duration-100 filter drop-shadow-[0_0_15px_rgba(255,215,0,0.6)] animate-pulse",style:{textShadow:"4px 4px 0 #B71C1C"},children:"PRESS START"}),T.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white font-mono text-sm border-b border-transparent hover:border-white transition-all tracking-widest",children:"EXIT TO SYSTEM"}),T.jsxs("div",{className:"mt-8 text-[10px] text-gray-500 font-mono flex flex-col items-center gap-1",children:[T.jsx("p",{children:"INSERT COIN TO PLAY"}),T.jsx("p",{children:"Â© 1999 KIND OF PEPSI INC."})]})]}):T.jsxs("div",{className:"w-64 flex flex-col items-center gap-3",children:[T.jsx("div",{className:"text-blue-300 font-mono text-xs tracking-[0.3em] animate-pulse",children:"LOADING RESOURCES..."}),T.jsx("div",{className:"w-full h-6 bg-black border-2 border-white p-1 shadow-lg",children:T.jsx("div",{className:"h-full bg-gradient-to-r from-blue-600 via-blue-400 to-blue-600 bg-[length:20px_100%]",style:{width:`${f}%`}})})]})]}),r==="GAME_OVER"&&T.jsx(Te,{score:l.score,onRestart:t,onExit:e})]})},be=({onExit:e})=>T.jsx(c.Suspense,{fallback:T.jsx("div",{className:"fixed inset-0 z-[10000] bg-black flex items-center justify-center text-blue-500",children:"LOADING ASSETS..."}),children:T.jsx(Se,{onExit:e})});export{be as GameLauncher};
