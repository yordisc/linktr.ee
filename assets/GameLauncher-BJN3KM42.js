import{r as o,j as d}from"./index-DCZycWrg.js";const T={CANVAS_WIDTH:360,CANVAS_HEIGHT:640,LANE_COUNT:3,PLAYER_WIDTH:50,PLAYER_HEIGHT:80,GRAVITY:.8,JUMP_FORCE:-14,LANE_SWITCH_SPEED:.2,INITIAL_SPEED:6,DASH_MULTIPLIER:2.5,DASH_DURATION:90,DASH_COOLDOWN:180,SLIDE_DURATION:60,SLIDE_COOLDOWN:60,DIET_PEPSI_DURATION:240,SPAWN_RATE_INITIAL:100,SPAWN_RATE_MIN:30,INITIAL_LIVES:3,CANS_FOR_LIFE:100},k=T.CANVAS_WIDTH/T.LANE_COUNT,M=[k*.5,k*1.5,k*2.5];let F=null;const J=()=>{if(!F){const e=window.AudioContext||window.webkitAudioContext;if(!e)throw new Error("Tu navegador no soporta Web Audio API");F=new e}return F},X=e=>{const i=J();i.state==="suspended"&&i.resume();const t=i.createOscillator(),r=i.createGain();t.connect(r),r.connect(i.destination);const s=i.currentTime;switch(e){case"JUMP":t.type="square",t.frequency.setValueAtTime(150,s),t.frequency.exponentialRampToValueAtTime(600,s+.2),r.gain.setValueAtTime(.1,s),r.gain.exponentialRampToValueAtTime(.01,s+.2),t.start(s),t.stop(s+.2);break;case"SLIDE":t.type="sine",t.frequency.setValueAtTime(400,s),t.frequency.exponentialRampToValueAtTime(100,s+.3),r.gain.setValueAtTime(.1,s),r.gain.linearRampToValueAtTime(0,s+.3),t.start(s),t.stop(s+.3);break;case"COLLECT":t.type="sine",t.frequency.setValueAtTime(1200,s),t.frequency.setValueAtTime(1600,s+.1),r.gain.setValueAtTime(.1,s),r.gain.exponentialRampToValueAtTime(.01,s+.2),t.start(s),t.stop(s+.2);break;case"POWERUP":t.type="triangle",t.frequency.setValueAtTime(440,s),t.frequency.setValueAtTime(554,s+.1),t.frequency.setValueAtTime(659,s+.2),r.gain.setValueAtTime(.1,s),r.gain.linearRampToValueAtTime(0,s+.4),t.start(s),t.stop(s+.4);break;case"CRASH":t.type="sawtooth",t.frequency.setValueAtTime(100,s),t.frequency.exponentialRampToValueAtTime(10,s+.3),r.gain.setValueAtTime(.2,s),r.gain.exponentialRampToValueAtTime(.01,s+.3),t.start(s),t.stop(s+.3);break}},Y=()=>({play:o.useCallback(i=>{try{X(i)}catch(t){console.warn("Audio error:",t)}},[])}),K=()=>{const{play:e}=Y(),i=o.useRef({lane:1,x:M[1],y:0,state:"RUNNING",isJumping:!1,jumpVelocity:0,isSliding:!1,slideTimer:0,isDashing:!1,dashTimer:0,isHit:!1,hitTimer:0,isConfused:!1,confusionTimer:0,frame:0,cooldowns:{slide:0,dash:0}}),t=o.useCallback(()=>{const n=i.current,u=n.isConfused?1:-1,f=n.lane+u;f>=0&&f<=2&&(n.lane=f)},[]),r=o.useCallback(()=>{const n=i.current,u=n.isConfused?-1:1,f=n.lane+u;f>=0&&f<=2&&(n.lane=f)},[]),s=o.useCallback(()=>{const n=i.current;!n.isJumping&&(!n.isSliding||n.isDashing)&&(n.isJumping=!0,n.jumpVelocity=T.JUMP_FORCE,n.isSliding=!1,e("JUMP"))},[e]),l=o.useCallback(()=>{const n=i.current;!n.isJumping&&!n.isSliding&&n.cooldowns.slide<=0&&(n.isSliding=!0,n.slideTimer=T.SLIDE_DURATION,n.cooldowns.slide=T.SLIDE_COOLDOWN+T.SLIDE_DURATION,e("SLIDE"))},[e]),a=o.useCallback(()=>{const n=i.current;!n.isDashing&&n.cooldowns.dash<=0&&(n.isDashing=!0,n.dashTimer=T.DASH_DURATION,n.cooldowns.dash=T.DASH_COOLDOWN+T.DASH_DURATION,n.isJumping=!1,n.y=0,n.isSliding=!1,e("POWERUP"))},[e]),S=o.useCallback(()=>{const n=i.current;n.frame++;const u=M[n.lane];n.x+=(u-n.x)*T.LANE_SWITCH_SPEED,n.isJumping&&(n.y+=n.jumpVelocity,n.jumpVelocity+=T.GRAVITY,n.y<=0&&(n.y=0,n.isJumping=!1,n.jumpVelocity=0)),n.isSliding&&(n.slideTimer--,n.slideTimer<=0&&(n.isSliding=!1)),n.isDashing&&(n.dashTimer--,n.dashTimer<=0&&(n.isDashing=!1)),n.isHit&&(n.hitTimer--,n.hitTimer<=0&&(n.isHit=!1)),n.isConfused&&(n.confusionTimer--,n.confusionTimer<=0&&(n.isConfused=!1)),n.cooldowns.slide>0&&n.cooldowns.slide--,n.cooldowns.dash>0&&n.cooldowns.dash--},[]);return{playerRef:i,updatePlayer:S,actions:{moveLeft:t,moveRight:r,jump:s,slide:l,dash:a}}},$=()=>{const e=o.useRef([]),i=o.useRef(0),t=o.useRef(0),r=o.useCallback(()=>{e.current=[],i.current=0,t.current=0},[]),s=()=>{const a=Math.floor(Math.random()*3),S=`ent-${t.current++}`,n=Math.random()>.3;let u,f,p=50,g=50,c=0,E=!1;if(n){u="OBSTACLE";const b=Math.random();b<.4?f="CONE":b<.7?(f="BARRIER",p=70):b<.85?(f="TRUCK_H",p=90,g=60):b<.95?(f="CAR",c=5,E=!0,p=45,g=80):f="HOLE"}else u="COLLECTIBLE",f=Math.random()>.9?"CAN_DIET":"CAN_NORMAL",p=30,g=45;const m={id:S,type:u,variant:f,lane:a,x:M[a],y:-100,width:p,height:g,speedY:c,warning:E,warningTimer:E?60:0};e.current.push(m)},l=o.useCallback((a,S)=>{i.current++;const n=Math.max(T.SPAWN_RATE_MIN,T.SPAWN_RATE_INITIAL-S*5);i.current>=n&&(s(),i.current=0),e.current=e.current.filter(u=>u.warning&&u.warningTimer&&u.warningTimer>0?(u.warningTimer--,!0):(u.y+=a+(u.speedY||0),u.y<T.CANVAS_HEIGHT+100))},[]);return{entitiesRef:e,updateEntities:l,resetSpawner:r}},Q=()=>({checkCollision:o.useCallback((i,t)=>{if(Math.abs(i.x-t.x)>40)return!1;const s=T.CANVAS_HEIGHT-T.PLAYER_HEIGHT-20,l=t.y+t.height,a=t.y,S=s+T.PLAYER_HEIGHT,n=s-i.y;return!(!(l>n&&a<S)||(t.variant==="HOLE"||t.variant==="CAR")&&i.y>t.height||(t.variant==="TRUCK_H"||t.variant==="POLE")&&i.isSliding||i.isDashing&&(t.variant==="BOX"||t.variant==="BARREL"||t.variant==="CONE"))},[])}),Z=()=>{const[e,i]=o.useState(0),[t,r]=o.useState(0),[s,l]=o.useState(T.INITIAL_LIVES),[a,S]=o.useState(0),[n,u]=o.useState(1),f=o.useRef(0),p=o.useRef(0);o.useEffect(()=>{const b=localStorage.getItem("pepsiman_highscore");b&&r(parseInt(b,10))},[]);const g=o.useCallback(()=>{i(0),l(T.INITIAL_LIVES),S(0),u(1),f.current=0,p.current=0},[]),c=o.useCallback(b=>{p.current+=b*.1;const h=Math.floor(p.current);if(h>f.current){f.current=h,i(h);const R=Math.floor(h/1e3)+1;R!==n&&u(R)}},[n]),E=o.useCallback(b=>{const h=b==="CAN_DIET"?50:10;f.current+=h,i(R=>R+h),b==="CAN_NORMAL"&&S(R=>{const C=R+1;return C>=T.CANS_FOR_LIFE?(l(I=>I+1),0):C})},[]),m=o.useCallback((b=1)=>{let h=!1;return l(R=>{const C=R-b;return C<=0?(h=!0,f.current>t&&(r(f.current),localStorage.setItem("pepsiman_highscore",f.current.toString())),0):C}),h},[t]);return{score:e,highScore:t,lives:s,cans:a,level:n,resetScore:g,updateDistance:c,collectCan:E,takeDamage:m}},j=1e3/60,x=()=>{const{playerRef:e,updatePlayer:i,actions:t}=K(),{entitiesRef:r,updateEntities:s,resetSpawner:l}=$(),{play:a}=Y(),{checkCollision:S}=Q(),{score:n,highScore:u,lives:f,cans:p,level:g,resetScore:c,updateDistance:E,collectCan:m,takeDamage:b}=Z(),[h,R]=o.useState("MENU"),C=o.useRef(0),I=o.useRef(0),D=o.useRef(T.INITIAL_SPEED),_=o.useRef(0),H=o.useCallback(()=>{const A=e.current;for(let w=r.current.length-1;w>=0;w--){const y=r.current[w];if(S(A,y)){if(y.type==="COLLECTIBLE"){const v=y.variant;m(v),v==="CAN_DIET"?(a("POWERUP"),_.current=T.DIET_PEPSI_DURATION):a("COLLECT"),r.current.splice(w,1)}else if(!A.isHit){const v=["BOX","BARREL","CONE"].includes(y.variant);if(A.isDashing&&v)a("CRASH"),r.current.splice(w,1);else{a("CRASH"),A.isHit=!0,A.hitTimer=60,y.variant==="BARREL"&&(A.isConfused=!0,A.confusionTimer=300);const q=["TRUCK_V","TRUCK_H","HOLE"].includes(y.variant)?999:1;if(b(q))return A.state="CRASHED",R("GAME_OVER"),!0;D.current=Math.max(T.INITIAL_SPEED,D.current-2)}}}}return!1},[S,m,b,r,e,a]),N=o.useCallback(A=>{if(h!=="PLAYING")return;I.current||(I.current=A);const w=A-I.current;if(w>j){I.current=A-w%j;let y=D.current+g*.5;if(e.current.isDashing&&(y*=T.DASH_MULTIPLIER),_.current>0&&(y+=5,_.current--),i(),s(y,g),E(y),H())return}C.current=requestAnimationFrame(N)},[h,g,i,s,E,H,e]),W=o.useCallback(()=>{c(),l(),D.current=T.INITIAL_SPEED,_.current=0;const A=e.current;A.lane=1,A.x=T.CANVAS_WIDTH/3*1.5,A.y=0,A.state="RUNNING",A.isHit=!1,A.isJumping=!1,A.isSliding=!1,A.isDashing=!1,A.isConfused=!1,R("PLAYING"),I.current=0,C.current=requestAnimationFrame(N)},[N,c,l,e]),z=o.useCallback(()=>{h==="PLAYING"?R("PAUSED"):h==="PAUSED"&&(R("PLAYING"),I.current=0,C.current=requestAnimationFrame(N))},[h,N]);return o.useEffect(()=>()=>cancelAnimationFrame(C.current),[]),{status:h,startGame:W,pauseGame:z,player:e.current,entitiesRef:r,stats:{score:n,highScore:u,lives:f,cans:p,level:g},actions:t}},ee=(e,i)=>{const t=o.useRef(0),r=o.useRef(!1);o.useEffect(()=>{const s=a=>{if(e==="PLAYING")switch(a.key){case"ArrowLeft":case"a":i.moveLeft();break;case"ArrowRight":case"d":i.moveRight();break;case"ArrowUp":case"w":i.dash();break;case"ArrowDown":case"s":i.slide();break;case" ":case"Shift":!a.repeat&&t.current===0&&(t.current=Date.now(),r.current=!1,setTimeout(()=>{t.current!==0&&(r.current=!0,i.slide())},200));break}},l=a=>{if(a.key===" "||a.key==="Shift"){const S=Date.now()-t.current;t.current=0,S<200&&!r.current&&i.jump(),r.current=!1}};return window.addEventListener("keydown",s),window.addEventListener("keyup",l),()=>{window.removeEventListener("keydown",s),window.removeEventListener("keyup",l)}},[e,i])},P={},L={PEPSI_BLUE:"#004B93",PEPSI_RED:"#C9002B",SILVER:"#E0E0E0",ASPHALT:"#2D2D2D"},O=(e,i)=>{const t=document.createElement("canvas");return t.width=e,t.height=i,{canvas:t,ctx:t.getContext("2d")}},G=e=>{const{canvas:r,ctx:s}=O(30,50),l=e==="diet"?L.SILVER:L.PEPSI_BLUE,a=s.createLinearGradient(0,0,30,0);a.addColorStop(0,"rgba(0,0,0,0.3)"),a.addColorStop(.2,l),a.addColorStop(.5,e==="diet"?"#FFFFFF":"#0072CE"),a.addColorStop(.8,l),a.addColorStop(1,"rgba(0,0,0,0.3)"),s.fillStyle=a,s.fillRect(0,0,30,50),s.fillStyle="#999",s.fillRect(0,0,30,3),s.fillRect(0,47,30,3);const S=30/2,n=50/2,u=8;return s.beginPath(),s.arc(S,n,u,0,Math.PI*2),s.fillStyle="#FFF",s.fill(),s.beginPath(),s.arc(S,n,u-2,0,Math.PI*2),s.fillStyle=L.PEPSI_RED,s.fill(),s.beginPath(),s.arc(S,n,u-2,0,Math.PI,!1),s.fillStyle=L.PEPSI_BLUE,s.fill(),r},te=()=>{const{canvas:i,ctx:t}=O(200,200);t.fillStyle=L.ASPHALT,t.fillRect(0,0,200,200);for(let r=0;r<400;r++){const s=Math.random()*200,l=Math.random()*200,a=Math.random()*2;t.fillStyle=Math.random()>.5?"#383838":"#222",t.fillRect(s,l,a,a)}return i},ne=()=>{const{canvas:i,ctx:t}=O(50,50);return t.fillStyle="#FBC02D",t.fillRect(0,0,50,50),t.fillStyle="#000",t.beginPath(),t.moveTo(0,50),t.lineTo(50,0),t.lineTo(50,10),t.lineTo(10,50),t.fill(),t.beginPath(),t.moveTo(0,10),t.lineTo(10,0),t.lineTo(0,0),t.fill(),i},se=()=>{P.CAN_NORMAL||(console.log("ðŸŽ¨ Generando texturas en memoria..."),P.CAN_NORMAL=G("normal"),P.CAN_DIET=G("diet"),P.ASPHALT=te(),P.STRIPES=ne())},V={URBAN:{ground:"#4CAF50",roadTint:"rgba(0, 0, 0, 0)",curbA:"#D32F2F",curbB:"#EEEEEE",line:"#FFFFFF",shadow:"rgba(0,0,0,0.3)"},CRISIS:{ground:"#3E2723",roadTint:"rgba(62, 39, 35, 0.4)",curbA:"#B71C1C",curbB:"#212121",line:"#FF5252",shadow:"rgba(183, 28, 28, 0.2)"},METRO:{ground:"#212121",roadTint:"rgba(0, 0, 0, 0.5)",curbA:"#FFEB3B",curbB:"#000000",line:"#607D8B",shadow:"rgba(0,0,0,0.8)"},DESERT:{ground:"#FF9800",roadTint:"rgba(121, 85, 72, 0.3)",curbA:"#E65100",curbB:"#FFE0B2",line:"#FFF3E0",shadow:"rgba(62, 39, 35, 0.3)"},PEPSI_CITY:{ground:"#004B93",roadTint:"rgba(0, 75, 147, 0.4)",curbA:"#FFFFFF",curbB:"#C9002B",line:"#00FFFF",shadow:"rgba(0, 255, 255, 0.2)"}},B=(e,i,t,r,s="URBAN")=>{const l=Date.now(),a=V[s]||V.URBAN,S=l*r*.1;e.fillStyle=a.ground,e.fillRect(0,0,i,t);const n=15,u=i-n*2;if(P.ASPHALT){const m=e.createPattern(P.ASPHALT,"repeat");if(m){const b=new DOMMatrix;b.translateSelf(0,S%256),m.setTransform(b),e.fillStyle=m,e.fillRect(n,0,u,t)}}else e.fillStyle="#2d2d2d",e.fillRect(n,0,u,t);a.roadTint!=="rgba(0, 0, 0, 0)"&&(e.fillStyle=a.roadTint,e.fillRect(n,0,u,t));const f=60,p=15,g=S%(f*2);for(let m=-f*2;m<t+f;m+=f){const b=Math.floor((m+g)/f)%2===0;e.fillStyle=b?a.curbA:a.curbB,e.fillRect(0,m+g,p,f),e.fillRect(i-p,m+g,p,f)}e.lineWidth=4,e.strokeStyle=a.line,e.setLineDash([50,50]),e.lineDashOffset=-S,[k,k*2].forEach(m=>{e.beginPath(),e.moveTo(m,0),e.lineTo(m,t),e.stroke()}),e.setLineDash([]);const c=e.createLinearGradient(n,0,n+20,0);c.addColorStop(0,a.shadow),c.addColorStop(1,"rgba(0,0,0,0)"),e.fillStyle=c,e.fillRect(n,0,20,t);const E=e.createLinearGradient(i-n-20,0,i-n,0);if(E.addColorStop(0,"rgba(0,0,0,0)"),E.addColorStop(1,a.shadow),e.fillStyle=E,e.fillRect(i-n-20,0,20,t),r>12){e.fillStyle="rgba(255, 255, 255, 0.1)";const m=Date.now()*2%t;e.fillRect(5,m,2,100),e.fillRect(i-7,(m+200)%t,2,150)}},ie=(e,i)=>{i.forEach(t=>{const r=t.x,s=t.y+t.height;if(e.fillStyle="rgba(0,0,0,0.3)",e.beginPath(),e.ellipse(r,s,t.width/2.2,6,0,0,Math.PI*2),e.fill(),t.type==="COLLECTIBLE"){const l=t.variant,a=P[l];if(a){const S=Math.sin(Date.now()/200)*5,n=1+Math.sin(Date.now()/150)*.05,u=t.width*n,f=t.height*n;e.drawImage(a,r-u/2,t.y+S,u,f)}else e.fillStyle="blue",e.fillRect(t.x-15,t.y,30,50)}else re(e,t)})},re=(e,i)=>{const t=i.x-i.width/2,r=i.y,s=i.width,l=i.height;switch(i.variant){case"BARRIER":if(P.STRIPES){const S=e.createPattern(P.STRIPES,"repeat");S&&(e.fillStyle=S,e.fillRect(t,r,s,20),e.strokeStyle="#000",e.lineWidth=2,e.strokeRect(t,r,s,20))}else e.fillStyle="#FFC107",e.fillRect(t,r,s,20);e.fillStyle="#333",e.fillRect(t+5,r+20,10,l-20),e.fillRect(t+s-15,r+20,10,l-20);break;case"CONE":e.fillStyle="#FF5722",e.beginPath(),e.moveTo(i.x,r),e.lineTo(t,r+l),e.lineTo(t+s,r+l),e.fill(),e.fillStyle="#333",e.fillRect(t-5,r+l-5,s+10,5);break;case"TRUCK_H":case"TRUCK_V":e.fillStyle="#D32F2F",e.fillRect(t,r,s,l),e.fillStyle="#B71C1C",e.fillRect(t,r+l-10,s,10),e.fillStyle="white",e.beginPath(),e.ellipse(i.x,r+l/2,s/3,10,.2,0,Math.PI*2),e.fill();break;case"HOLE":e.fillStyle="#000",e.beginPath(),e.ellipse(i.x,r+l/2,s/2,l/2,0,0,Math.PI*2),e.fill(),e.strokeStyle="#333",e.lineWidth=2,e.stroke();break;case"CAR":e.fillStyle="#3F51B5",e.fillRect(t,r,s,l),e.fillStyle="#81D4FA",e.fillRect(t+2,r+2,s-4,15),e.fillStyle="red",e.fillRect(t+2,r+l-5,10,5),e.fillRect(t+s-12,r+l-5,10,5),i.warning&&i.y<0&&(e.fillStyle="red",e.font="bold 40px Arial",e.textAlign="center",e.fillText("!",i.x,100),e.strokeStyle="yellow",e.lineWidth=2,e.strokeText("!",i.x,100));break;default:e.fillStyle="#795548",e.fillRect(t,r,s,l),e.strokeStyle="#3E2723",e.lineWidth=3,e.strokeRect(t,r,s,l),e.beginPath(),e.moveTo(t,r),e.lineTo(t+s,r+l),e.moveTo(t+s,r),e.lineTo(t,r+l),e.stroke()}},U=(e,i,t,r,s)=>{const l=e.createLinearGradient(i-r/2,t,i+r/2,t);return s==="silver"?(l.addColorStop(0,"#999999"),l.addColorStop(.5,"#FFFFFF"),l.addColorStop(1,"#999999")):(l.addColorStop(0,"#003366"),l.addColorStop(.5,"#0066CC"),l.addColorStop(1,"#003366")),l},le=(e,i)=>{const{x:t,y:r,isSliding:s,isDashing:l,isHit:a,isJumping:S,isConfused:n,frame:u,state:f}=i,p=T.CANVAS_HEIGHT-T.PLAYER_HEIGHT-30-r,g=T.PLAYER_WIDTH,c=s?T.PLAYER_HEIGHT/2:T.PLAYER_HEIGHT;if(a&&Math.floor(Date.now()/100)%2===0)return;e.save(),e.translate(t,p),n&&e.rotate(Math.sin(u*.2)*.2),f==="CRASHED"&&(e.translate(0,c),e.scale(1.4,.1),e.translate(0,-c),e.translate(Math.random()*10-5,0));const E=U(e,0,c/2,g,"silver"),m=U(e,0,c/2,g*.6,"blue"),b="#00FFFF";if(f!=="CRASHED"){e.fillStyle="rgba(0,0,0,0.4)",e.beginPath();const h=r+c+10,R=Math.max(.3,1-r/150);e.ellipse(0,h,g/2*R,6*R,0,0,Math.PI*2),e.fill()}if(e.lineCap="round",e.lineJoin="round",s)e.fillStyle="rgba(255, 255, 255, 0.3)",e.beginPath(),e.moveTo(-g/1.5,c),e.lineTo(g/1.5,c),e.lineTo(0,0),e.fill(),e.fillStyle=l?b:E,e.beginPath(),e.ellipse(0,c/2+10,g/1.8,c/2.5,0,0,Math.PI*2),e.fill(),e.fillStyle=m,e.beginPath(),e.ellipse(0,c/2+10,g/3,c/4,0,0,Math.PI*2),e.fill(),e.fillStyle="#C0C0C0",e.beginPath(),e.arc(20,0,12,0,Math.PI*2),e.fill();else if(S){e.lineWidth=14,e.strokeStyle=E,e.beginPath(),e.moveTo(-10,c-35),e.lineTo(-20,c-15),e.stroke(),e.beginPath(),e.moveTo(10,c-35),e.lineTo(20,c-15),e.stroke(),e.fillStyle=l?b:"#0057B8",e.beginPath(),e.moveTo(-22,-5),e.lineTo(22,-5),e.lineTo(12,c-35),e.lineTo(-12,c-35),e.fill(),e.beginPath(),e.arc(0,20,9,0,Math.PI*2),e.fillStyle="white",e.fill(),e.beginPath(),e.arc(0,20,8,Math.PI,0),e.fillStyle="#C9002B",e.fill(),e.beginPath(),e.arc(0,20,8,0,Math.PI),e.fillStyle="#004B93",e.fill(),e.strokeStyle=E,e.lineWidth=12,e.beginPath(),e.moveTo(18,5),e.lineTo(35,-15),e.stroke(),e.beginPath(),e.moveTo(-18,5),e.lineTo(-35,-15),e.stroke();const h=e.createRadialGradient(-5,-25,2,0,-25,15);h.addColorStop(0,"#FFF"),h.addColorStop(1,"#999"),e.fillStyle=h,e.beginPath(),e.arc(0,-25,16,0,Math.PI*2),e.fill()}else if(l){e.rotate(30*Math.PI/180);const h=Math.sin(u*.9)*25;e.lineWidth=12,e.strokeStyle="#555",e.beginPath(),e.moveTo(-5,c-30),e.lineTo(-25-h,c+10),e.stroke(),e.strokeStyle=E,e.beginPath(),e.moveTo(5,c-30),e.lineTo(25+h,c+10),e.stroke(),e.fillStyle=b,e.beginPath(),e.moveTo(-20,0),e.lineTo(20,0),e.lineTo(10,c-25),e.lineTo(-10,c-25),e.fill(),e.strokeStyle=E,e.lineWidth=10,e.beginPath(),e.moveTo(0,10),e.lineTo(-50,0),e.stroke(),e.fillStyle="#FFF",e.beginPath(),e.arc(10,-10,14,0,Math.PI*2),e.fill()}else{const h=Math.abs(Math.sin(u*.4))*6;e.translate(0,-h);const R=Math.sin(u*.4)*22,C=Math.sin(u*.4)*22;e.lineWidth=14,e.strokeStyle="#555",e.beginPath(),e.moveTo(0,c-35),e.lineTo(-R,c+h),e.stroke(),e.strokeStyle=E,e.beginPath(),e.moveTo(0,c-35),e.lineTo(R,c+h),e.stroke(),e.fillStyle="#0057B8",e.beginPath(),e.moveTo(-22,-5),e.lineTo(22,-5),e.lineTo(12,c-35),e.lineTo(-12,c-35),e.fill(),e.beginPath(),e.arc(0,20,9,0,Math.PI*2),e.fillStyle="white",e.fill(),e.beginPath(),e.arc(0,20,8,Math.PI,0),e.fillStyle="#C9002B",e.fill(),e.beginPath(),e.arc(0,20,8,0,Math.PI),e.fillStyle="#004B93",e.fill(),e.lineWidth=12,e.strokeStyle="#777",e.beginPath(),e.moveTo(18,5),e.lineTo(28,35-C),e.stroke(),e.strokeStyle=E,e.beginPath(),e.moveTo(-18,5),e.lineTo(-28,35+C),e.stroke();const I=e.createRadialGradient(-5,-25,2,0,-25,15);I.addColorStop(0,"#FFF"),I.addColorStop(1,"#999"),e.fillStyle=I,e.beginPath(),e.arc(0,-25,16,0,Math.PI*2),e.fill(),e.fillStyle="#111",e.beginPath(),e.ellipse(0,-22,6,2,0,0,Math.PI*2),e.fill()}e.restore()},ae=({score:e,highScore:i,lives:t,cans:r,level:s})=>d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"absolute top-4 left-4 text-white font-mono z-20 drop-shadow-md pointer-events-none",children:[d.jsxs("div",{className:"text-3xl font-black italic text-yellow-400 tracking-tighter",style:{textShadow:"2px 2px 0 #004B93"},children:["SCORE: ",e]}),d.jsxs("div",{className:"text-sm text-gray-400 font-bold",children:["HI: ",i]})]}),d.jsxs("div",{className:"absolute top-4 right-4 text-white font-mono z-20 text-right drop-shadow-md pointer-events-none",children:[d.jsx("div",{className:"text-2xl font-bold text-red-500 mb-1",children:"â¤ï¸".repeat(Math.max(0,t))}),d.jsxs("div",{className:"flex items-center justify-end gap-2 text-blue-300 font-bold",children:[d.jsx("span",{children:"CANS:"}),d.jsxs("span",{className:"text-xl text-white",children:[r,"/100"]})]}),d.jsxs("div",{className:"text-xs text-gray-500 font-bold mt-1",children:["SPEED LVL: ",s]})]})]}),oe=({actions:e})=>{const i=o.useRef(0),t=o.useRef(0),r=o.useRef(!1),s=o.useRef(null),l=n=>{i.current=n.touches[0].clientX,t.current=n.touches[0].clientY,r.current=!1,s.current=setTimeout(()=>{r.current=!0,e.slide()},250)},a=n=>{if(r.current)return;const u=n.touches[0].clientX,f=n.touches[0].clientY,p=Math.abs(u-i.current),g=Math.abs(f-t.current);(p>10||g>10)&&s.current&&(clearTimeout(s.current),s.current=null)},S=n=>{if(s.current&&(clearTimeout(s.current),s.current=null),r.current)return;n.cancelable&&n.preventDefault();const u=n.changedTouches[0].clientX,f=n.changedTouches[0].clientY,p=i.current-u,g=t.current-f;if(Math.abs(p)>30||Math.abs(g)>30)Math.abs(p)>Math.abs(g)?p>0?e.moveLeft():e.moveRight():g>0?e.dash():e.slide();else{const c=window.innerWidth;i.current<c*.3?e.moveLeft():i.current>c*.7?e.moveRight():e.jump()}};return d.jsx("div",{className:"absolute inset-0 z-50 touch-none select-none",onTouchStart:l,onTouchMove:a,onTouchEnd:S})},ce=({score:e,onRestart:i,onExit:t})=>d.jsxs("div",{className:"absolute inset-0 z-30 bg-black/80 backdrop-blur-sm flex flex-col items-center justify-center text-white animate-in zoom-in duration-300",children:[d.jsx("h2",{className:"text-6xl font-black text-red-600 mb-2 italic tracking-tighter transform -rotate-3",style:{textShadow:"4px 4px 0 #000"},children:"CRASHED!"}),d.jsxs("p",{className:"text-2xl mb-8 font-mono text-yellow-400",children:["FINAL SCORE: ",e]}),d.jsxs("div",{className:"flex flex-col gap-4 w-64",children:[d.jsx("button",{onClick:i,className:"px-8 py-4 bg-blue-600 hover:bg-blue-500 text-white font-black rounded-xl shadow-[0_6px_0_rgb(0,40,100)] active:shadow-none active:translate-y-1 transition-all uppercase tracking-widest",children:"TRY AGAIN"}),d.jsx("button",{onClick:t,className:"px-8 py-4 bg-gray-700 hover:bg-gray-600 text-gray-300 font-bold rounded-xl shadow-[0_6px_0_rgb(30,30,30)] active:shadow-none active:translate-y-1 transition-all uppercase tracking-widest",children:"EXIT"})]})]}),ue=({onExit:e})=>{const{status:i,startGame:t,player:r,entitiesRef:s,stats:l,actions:a}=x(),S=o.useRef(null),n=o.useRef(0),[u,f]=o.useState(0),[p,g]=o.useState(!1);ee(i,a),o.useEffect(()=>{const E=setInterval(()=>{f(m=>m>=100?(clearInterval(E),se(),g(!0),100):m+Math.floor(Math.random()*15)+5)},100);return()=>clearInterval(E)},[]);const c=o.useCallback(()=>{const E=C=>C>=10?"PEPSI_CITY":C>=7?"DESERT":C>=5?"METRO":C>=3?"CRISIS":"URBAN",m=S.current,b=E(l.level);if(!m)return;const h=m.getContext("2d");if(!h)return;if(i==="MENU"){B(h,m.width,m.height,3),n.current=requestAnimationFrame(c);return}h.clearRect(0,0,m.width,m.height);const R=T.INITIAL_SPEED+l.level*.5;B(h,m.width,m.height,R,b),ie(h,s.current),le(h,r),i==="PLAYING"&&(n.current=requestAnimationFrame(c))},[i,r,s,l.level]);return o.useEffect(()=>(n.current=requestAnimationFrame(c),()=>cancelAnimationFrame(n.current)),[c]),d.jsxs("div",{className:"fixed inset-0 z-[10000] bg-black flex items-center justify-center overflow-hidden font-sans select-none",children:[i==="PLAYING"&&d.jsxs(d.Fragment,{children:[d.jsx(ae,{score:l.score,highScore:l.highScore,lives:l.lives,cans:l.cans,level:l.level}),d.jsx(oe,{actions:a})]}),d.jsx("canvas",{ref:S,width:T.CANVAS_WIDTH,height:T.CANVAS_HEIGHT,className:"bg-[#222] max-h-full max-w-full shadow-2xl border-x-8 border-blue-900",style:{imageRendering:"pixelated"}}),i==="MENU"&&d.jsxs("div",{className:"absolute inset-0 z-30 bg-black/60 backdrop-blur-sm flex flex-col items-center justify-center animate-in fade-in duration-500",children:[d.jsxs("div",{className:"relative mb-12 transform -rotate-3 hover:scale-105 transition-transform duration-500",children:[d.jsx("h1",{className:"text-7xl md:text-9xl font-black italic tracking-tighter text-white drop-shadow-[6px_6px_0_#004B93]",style:{WebkitTextStroke:"2px #C0C0C0"},children:"PEPSIMAN"}),d.jsx("div",{className:"absolute -bottom-2 right-4 bg-red-600 text-white text-xs md:text-sm font-bold px-3 py-1 transform rotate-3 shadow-lg border-2 border-white",children:"RUNNER"})]}),p?d.jsxs("div",{className:"flex flex-col gap-8 items-center animate-in slide-in-from-bottom-10 fade-in duration-500",children:[d.jsx("button",{onClick:t,className:"text-4xl md:text-6xl font-black text-yellow-400 tracking-widest uppercase hover:scale-110 transition-transform duration-100 filter drop-shadow-[0_0_15px_rgba(255,215,0,0.6)] animate-pulse",style:{textShadow:"4px 4px 0 #B71C1C"},children:"PRESS START"}),d.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white font-mono text-sm border-b border-transparent hover:border-white transition-all tracking-widest",children:"EXIT TO SYSTEM"}),d.jsxs("div",{className:"mt-8 text-[10px] text-gray-500 font-mono flex flex-col items-center gap-1",children:[d.jsx("p",{children:"INSERT COIN TO PLAY"}),d.jsx("p",{children:"Â© 1999 KIND OF PEPSI INC."})]})]}):d.jsxs("div",{className:"w-64 flex flex-col items-center gap-3",children:[d.jsx("div",{className:"text-blue-300 font-mono text-xs tracking-[0.3em] animate-pulse",children:"LOADING RESOURCES..."}),d.jsx("div",{className:"w-full h-6 bg-black border-2 border-white p-1 shadow-lg",children:d.jsx("div",{className:"h-full bg-gradient-to-r from-blue-600 via-blue-400 to-blue-600 bg-[length:20px_100%]",style:{width:`${u}%`}})})]})]}),i==="GAME_OVER"&&d.jsx(ce,{score:l.score,onRestart:t,onExit:e})]})},he=({onExit:e})=>d.jsx(o.Suspense,{fallback:d.jsx("div",{className:"fixed inset-0 z-[10000] bg-black flex items-center justify-center text-blue-500",children:"LOADING ASSETS..."}),children:d.jsx(ue,{onExit:e})});export{he as GameLauncher};
